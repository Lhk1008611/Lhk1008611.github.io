<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-MySql/advanced/mysql-advance-2">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">MySQL 高级第二篇 | HankLay 的个人主页</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://lhk1008611.github.io/docs/MySql/advanced/mysql-advance-2"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MySQL 高级第二篇 | HankLay 的个人主页"><meta data-rh="true" name="description" content="一、索引的创建与设计原则"><meta data-rh="true" property="og:description" content="一、索引的创建与设计原则"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://lhk1008611.github.io/docs/MySql/advanced/mysql-advance-2"><link data-rh="true" rel="alternate" href="https://lhk1008611.github.io/docs/MySql/advanced/mysql-advance-2" hreflang="zh"><link data-rh="true" rel="alternate" href="https://lhk1008611.github.io/docs/MySql/advanced/mysql-advance-2" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.db39acd3.css">
<link rel="preload" href="/assets/js/runtime~main.11a1e1e4.js" as="script">
<link rel="preload" href="/assets/js/main.2c7bbae3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">首页</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">文档</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Lhk1008611" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">个人简历</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/java">Java</a><button aria-label="打开/收起侧边栏菜单「Java」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/mq">MQ</a><button aria-label="打开/收起侧边栏菜单「MQ」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mysql">MySQL</a><button aria-label="打开/收起侧边栏菜单「MySQL」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/category/mysql-基础">MySQL 基础</a><button aria-label="打开/收起侧边栏菜单「MySQL 基础」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/category/mysql-高级">MySQL 高级</a><button aria-label="打开/收起侧边栏菜单「MySQL 高级」" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-1">MySQL 高级第一篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/MySql/advanced/mysql-advance-2">MySQL 高级第二篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-3">MySQL 高级第三篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-4">MySQL 高级第四篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-5">MySQL 高级第五篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-6">MySQL 高级第六篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-7">MySQL 高级第七篇</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/MySql/advanced/mysql-advance-8">MySQL 高级第八篇</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux">Linux</a><button aria-label="打开/收起侧边栏菜单「Linux」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/ssm">SSM</a><button aria-label="打开/收起侧边栏菜单「SSM」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/redis">Redis</a><button aria-label="打开/收起侧边栏菜单「Redis」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/dubbo">Dubbo</a><button aria-label="打开/收起侧边栏菜单「Dubbo」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/docker">Docker</a><button aria-label="打开/收起侧边栏菜单「Docker」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/spring-cloud">Spring Cloud</a><button aria-label="打开/收起侧边栏菜单「Spring Cloud」" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/cloud-native">Cloud Native</a><button aria-label="打开/收起侧边栏菜单「Cloud Native」" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql"><span itemprop="name">MySQL</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mysql-高级"><span itemprop="name">MySQL 高级</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MySQL 高级第二篇</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>MySQL 高级第二篇</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="一索引的创建与设计原则">一、索引的创建与设计原则<a class="hash-link" href="#一索引的创建与设计原则" title="标题的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-索引的分类">1. 索引的分类<a class="hash-link" href="#1-索引的分类" title="标题的直接链接">​</a></h3><ul><li><p>MySQL的索引包括<code>普通索引</code>、<code>唯一性索引</code>、<code>全文索引</code>、<code>单列索引</code>、<code>多列索引</code>和<code>空间索引</code>等。</p><blockquote><ul><li>从<code>功能逻辑上</code>说，索引主要有4种，分别是<code>普通索引</code>、<code>唯一索引</code>、<code>主键索引</code>、<code>全文索引</code></li><li>按照<code>物理实现方式</code>，索引可以分为2种:<code>聚簇索引</code>和<code>非聚簇索引</code>。 </li><li>按照<code>作用字段个数</code>进行划分，分成<code>单列索引</code>和<code>联合索引</code>。</li></ul></blockquote></li><li><p>普通索引</p><blockquote><ul><li>在创建普通索引时，<code>不附加任何限制条件</code>，<code>只是用于提高查询效率</code>。这类索引可以创建在任何数据类型中,其值是否唯一和非空,要由字段本身的完整性约束条件决定。建立索引以后，可以通过索引进行查询。</li><li>例如，在表 student的字段name上建立一个普通索引，查询记录时就可以根据该索引进行查询。</li></ul></blockquote></li><li><p>唯一性索引</p><blockquote><ul><li>使用<code>UNIQUE参数</code>可以设置索引为唯一性索引， 在创建唯一性索引时，<code>限制该索引的值必须是唯一的</code>， <code>但允许有空值</code>。在<code>一张数据表里可以有多个唯一索引</code>。 </li><li>例如。在表student的字段email中创建唯一性索引，那么字段email的值就<code>必须是唯一</code>的。<code>通过唯一性索引，可以更快速地确定某条记录</code>。</li></ul></blockquote></li><li><p>主键索引</p><blockquote><ul><li>主键索引就是一种特殊的唯一性索引，在唯一索引的基础上<code>增加了不为空的约束,也就是NOT NULL+UNIQUE</code>，<code>一张表里最多只有一个主键索引</code>。 这是由主键索引的物理实现方式决定的，因为数据存储在文件中只能按照一种顺序进行存储。</li></ul></blockquote></li><li><p>单列索引</p><blockquote><ul><li>在表中的<code>单个字段上创建索引</code>。单列索引只根据该字段进行索引。<code>单列索引可以是普通索引</code>，<code>也可以是唯一性索引</code>，<code>还可以是全文索引</code>。只要保证该索只对应一个字段即可，<code>一个表可以有多个单列索引</code>。</li></ul></blockquote></li><li><p>多列索引（组合索引、联合索引）</p><blockquote><ul><li>多列索引是<code>在表的多个字段组合上创建一个索引</code>。该索引指向创建时对应的<code>多个字段</code>，可以通过这几个字段进行查询，但是<code>只有查询条件中使用了这些字段中的第一个字段时才会被使用</code>。</li><li>例如，在表中的字段id，name和gender上建立一个多列索引 idx_ id_name_gender ，只有在查询条件中使用了字段id（<code>第一个字段</code>）时该索引才会被使用。</li><li><code>使用组合索引时遵循最左前缀集合</code>。</li></ul></blockquote></li><li><p>全文索引</p><blockquote><ul><li>全文索引(也称全文检索)是目前<code>搜索引擎使用的一种关键技术</code>。 它能够利用<code>[分词技术]</code>等多种算法智能分析出文本文字中关键词的频率和重要性，然后按照一定的算法规则智能地筛选出我们想要的搜索结果。 <code>全文索引非常适合大型数据集</code>，对于小的数据集，它的用处比较小。</li><li>使用参数<code>FULLTEXT</code>可以设置索引为全文索引。在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。<code>全文索引只能创建在CHAR、VARCHAR 或TEXT类型及其系列类型的字段上</code>，查询数据量较大的字符串类型的字段时，使用全文索引可以提高查询速度。</li><li>例如，表student的字段information是TEXT类型，该字段包含了很多文字信息。在字段information, 上建立全文索引后,可以提高查询字段information的速度。</li><li>全文索引典型的有两种类型:<code>自然语言的全文索引</code>和<code>布尔全文索引</code>。<ul><li><code>自然语言搜索引擎</code>将计算每一个文档对象和查询的相关度。这里，相关度是基于匹配的关键词的个数，以及关键词在文档中出现的次数。<code>在整个索引中出现次数越少的词语，匹配时的相关度就越高</code>。相反,非常常见的单词将不会被搜索，如果一个词语的在超过50%的记录中都出现了，那么自然语言的搜索将不会搜索这类词语。</li></ul></li></ul></blockquote></li></ul><ul><li>空间索引<blockquote><ul><li>使用<code>参数SPATIAL</code>可以设置索引为空间素引。<code>空间索引只能建立在空间数据类型上，这样可以提高系统获取空间数据的效率</code>。MySQL中的空间数据类型包括<code>GEOMETRY</code>、<code>POINT</code> 、<code>LINESTRING</code>和<code>POLYGON</code>等。</li><li>目前只有<code>MyISAM存储引擎支持空间检索</code>，而且<code>索引的字段不能为空值</code>。对于初学者来说，这类索引很少会用到。</li></ul></blockquote></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-索引的声明和使用">2. 索引的声明和使用<a class="hash-link" href="#2-索引的声明和使用" title="标题的直接链接">​</a></h3><ul><li><p>MySQL 支持多种方法在单个或多个列上创建索引:</p><blockquote><ol><li>在创建表的定义语句<code>CREATE TABLE</code> 中指定索引列，</li><li>使用 <code>ALTER TABLE</code>语句在存在的表上创建索引，或者使用<code>CREATE INDEX</code> 语句在已存在的表上添加索引。</li></ol></blockquote></li><li><p>查看索引</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#方式一：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#方式二：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>性能分析工具<code>EXPLAIN</code></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> 索引字段 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ‘’</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>创建索引方式一：<code>CREATE TABLE 中指定索引</code></p><blockquote><ol><li>隐式自动创建索引：<ul><li>在声明有主键约束、唯一 性约束、外键约束的字段上，会<code>自动</code>的添加相关的索引</li></ul></li><li>显示创建索引语法：<ul><li><code>UNIQUE</code>、 <code>FULLTEXT</code>和<code>SPATIAL</code>为可选参数，分别表示唯一索引全文索引和空间索引</li><li><code>INDEX</code>与<code>KEY</code>为同义词,两者的作用相同，用来指定创建索引</li><li><code>index_name</code>指定索引的名称，为可选参数，如果不指定，那么MySQL默认<code>col_name</code>为索引名<code>co1_name</code>为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择;</li><li><code>length</code>为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度;</li><li><code>ASC</code>或<code>DESC</code>指定升序或者降序的索引值存储。</li></ul></li></ol></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> 表名 </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">col_name data_type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> FULLTEXT </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> SPATIAL </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token keyword" style="color:#00009f">KEY</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">index_name</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">col_name </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">length</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">ASC</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#例：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> book</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      info </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      conmment </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      year_publication </span><span class="token keyword" style="color:#00009f">YEAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#创建普通索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> index_book_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#创建唯一性索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">UNIQUE</span><span class="token plain"> index_conmment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conmment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#创建联合索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> mul_index_book_id_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">book_name</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><ul><li><code>FULLTEXT</code>全文索引可以用于全文搜索，并且只为<code>CHAR</code>、<code>VARCHAR</code> 和<code>TEXT</code>类型的列创建索引。全文索引索引总是对整个列进行，不支持局部(前缀)索引.</li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> book1</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      info </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      conmment </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      year_publication </span><span class="token keyword" style="color:#00009f">YEAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#创建全文索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      FULLTEXT </span><span class="token keyword" style="color:#00009f">KEY</span><span class="token plain"> index_full</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">book_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">info</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><ul><li>全文索引用 match+against 方式查询<ul><li>注意点:<ol><li>使用全文索引前，搞清楚版本支持情况;</li><li>全文索引比like+ %快N倍，但是可能存在精度问题: </li><li>如果需要全文索引的是大量数据，建议先添加数据，再创建索引</li></ol></li></ul></li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">match</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">全文索引字段</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">字段</span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> against </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;查询的字符串&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>创建索引方式二：使用 <code>ALTER TABLE</code> 或 <code>CREATE INDEX</code> 在已创建的表中添加索引</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">add</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">索引类型</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> 索引名</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字段</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">索引类型</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 索引名 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字段名</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>索引的删除</p><blockquote><ol><li>添加<code>AUTO_INCREMENT</code>约束字段的<code>唯一索引</code>不能被删除。</li><li>删除表中的列时，如果要删除的列为索引的组成部分，则该列也会从索引中删除。如果组成索引的所有列都被删除，则整个索引将被删除。</li></ol></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#方式一：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 索引名</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#方式二：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">drop</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 索引名 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> 表名</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-mysql80-索引新特性">3. mysql8.0 索引新特性<a class="hash-link" href="#3-mysql80-索引新特性" title="标题的直接链接">​</a></h3><ul><li><p>降序索引</p><blockquote><p>MySQL在8.0版本之前创建的仍然是<code>升序索引</code>，使用时进行反向扫描，这大大降低了数据库的效率。在某些场景下，<code>降序索引</code>意义重大。
例如，如果一个查询， 需要对多个列进行排序，且顺序要求不一致，那么<code>使用降序索引将会避免数据库使用额外的文件排序操作</code>，从而提高性能。</p></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> test_desc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      a </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      b </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> index_a_b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a </span><span class="token keyword" style="color:#00009f">ASC</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>隐藏索引</p><blockquote><ul><li>在MySQL 5.7版本及之前，只能通过<code>显式的方式删除索引</code>.此时，如果发现删除索引后出现错误，又只能通过显式创建索引的方式将删除的索引|创建回来。如果数据表中的数据量非常大，或者数据表本身比较大，这种操作就会消耗系统过多的资源，操作成本非常高。</li><li>从MySQL 8.x开始支持<code>隐藏索引</code>(invisible indexes) ， 只需要<code>将待删除的索引设置为隐藏索引</code>,使查询优化器不再使用这个索引(即使使用force index (强制使用索引)，优化器也不会使用该索引)， 确认将索引设置为隐藏索引后系统不受任何响应，就可以彻底删除索引。<code>这种通过先将索引设置为隐藏索引，再删除索引的方式就是软删除。</code>
同时，如果你想验证某个索引删除之后的<code>查询性能影响</code>，就可以暂时先隐藏该索引。</li><li><code>主键不能被设置为隐藏索引</code>。当表中没有显式主键时，表中第一个唯一 非空索引会成为隐式主键，也不能设置为隐藏索引。</li><li><code>索引默认是可见的</code>，在使用<code>CREATE TABLE，CREATE INDEX</code>或者<code>ALTER TABLE</code>等语句时可以通过<code>VISIBLE</code>或者<code>INVISIBLE</code>关键词设置索引的可见性。</li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> book2</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      book_name </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      info </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      conmment </span><span class="token keyword" style="color:#00009f">VARCHAR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      year_publication </span><span class="token keyword" style="color:#00009f">YEAR</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">#创建不可见索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> index_conmment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">conmment</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> invisible</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#给某个表添加隐藏索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">table</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">add</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 索引名</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字段</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> invisible</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#或</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">create</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 索引名 </span><span class="token keyword" style="color:#00009f">on</span><span class="token plain"> 索引名</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">字段</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> invisible</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#修改索引的可见性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">index</span><span class="token plain"> 表名 </span><span class="token keyword" style="color:#00009f">alter</span><span class="token plain"> 索引名 </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">invisible </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> visible</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>当索引被隐藏时，它的内容仍然是和正常索引一样实时更新的。<code>如果一个索引需要长期被隐藏，那么可以将其删除，因为索引的存在会影响插入、更新和删除的性能</code>。</p></blockquote></li></ul><ul><li><p>使隐藏索引对查询优化器(<code>explain</code>)可见</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#查看隐藏索引是否对查询优化器可见</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> @</span><span class="token variable" style="color:#36acaa">@optimizer_switch</span><span class="token plain"> \G</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#设置语法</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">session</span><span class="token plain"> optimizer_switch</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;use_</span><br></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">invisible_indexes=on&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>  <img loading="lazy" alt="invisible_indexes" src="/assets/images/invisible_indexes-4389d8503285fef85e7c7d41ced29837.png" width="1663" height="159" class="img_ev3q"></p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-索引的设计原则">4. 索引的设计原则<a class="hash-link" href="#4-索引的设计原则" title="标题的直接链接">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-适合创建索引的情况">1. 适合创建索引的情况<a class="hash-link" href="#1-适合创建索引的情况" title="标题的直接链接">​</a></h4><ul><li><p>字段的数值有唯一性的限制</p><blockquote><ul><li>索引本身可以起到约束的作用。<code>比如唯一索引、主键索引都是可以起到唯一性约束的</code>，因此在我们的数据表中，如果<code>某个字段是唯一性</code>的，就可以直接创建<code>唯一性索引</code>，或者<code>主键索引</code>。这样可以更快速地通过该索引来确定某条记录。</li><li>业务上具有唯一特性的字段，即使是<code>组合字段</code>，也必须建成唯一索引。(来源: Alibaba)</li><li><code>说明</code>:不要以为唯一索引影响了insert速度，这个速度损耗可以忽略，但提高查找速度是明显的。</li></ul></blockquote></li><li><p>频繁作为 where 查询条件的字段</p><blockquote><ul><li>某个字段在 SELECT 语句的<code>WHERE条件</code>中经常被使用到，那么就需要给这个字段创建索引了。尤其是在数据量大的情况下，<code>创建普通索引就可以大幅提升数据查询的效率</code></li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#不使用索引按student_id字段查询,执行时间：0.960秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">course_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_info</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123110</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#给student_id字段添加索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">ALTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_info</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ADD</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> index_sid</span><span class="token punctuation" style="color:#393A34">(</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INDEX</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_info</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#使用索引按student_id字段查询,执行时间：0.041秒，0.039秒，0.043秒....</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">name</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">course_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token punctuation" style="color:#393A34">,</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">create_time</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_info</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> </span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token identifier">student_id</span><span class="token identifier punctuation" style="color:#393A34">`</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">123110</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>经常group by 和 order by的列</p><blockquote><p>索引就是让数据按照某种顺序进行存储或检索，因此当我们使用<code>GROUP BY</code>对数据进行<code>分组查询</code>，或者使用<code>ORDER BY</code>对数据进行<code>排序</code>的时候，就需要对分组或者排序的字段进行索引。如果待排序的列有多个，那么可以在这些列上建立<code>组合索引</code>。</p></blockquote></li></ul><ul><li><p>update、delete 的 where 条件列</p><blockquote><ul><li>对数据按照某个条件进行查询后再进行<code>UPDATE</code>或 <code>DELETE</code>的操作，如果对<code>WHERE字段创建了索引</code>，就能大幅提升效率。</li><li>原理是因为我们需要先根据WHERE条件列检索出来这条记录，然后再对它进行更新或删除。<code>如果进行更新的时候，更新的字段是非索引字段，提升的效率会更明显，这是因为非索引字段更新不需要对索引进行维护</code>。</li></ul></blockquote></li><li><p>distinct（去重）字段需要创建索引</p><blockquote><p>因为索引会对数据按照某种顺序进行排序。所以在去重的时候也会快很多。</p></blockquote></li></ul><ul><li>多表 join 连接操作时创建索引的注意事项<blockquote><ul><li>首先，<code>连接表的数量尽量不要超过3张</code>，因为每增加一张表就相当于增加了一次嵌套的循环，数量级增长会非常快，严重影响查询的效率。</li><li>其次，<code>对WHERE条件创建索引</code>，因为WHERE才是对数据条件的过滤。如果在数据量非常大的情况下，没有WHERE条件过滤是非常可怕的。</li><li>最后，<code>对用于连接的字段创建索引</code>,并且该字段在多张表中的类型必须一致。比如course_id在student_info表和course表中都为int(11)类型，而不能一个为int另一个为varchar类型。</li></ul></blockquote></li></ul><ul><li><p>使用列的类型小的创建索引</p><blockquote><ul><li>这里所说的<code>类型大小</code>指的就是该<code>类型表示的数据范围的大小</code>。</li><li>我们在定义表结构的时候要显式的指定列的类型，以整数类型为例，有<code>TINYINT</code>、<code>MEDIUMINT</code>、<code>INT</code>、<code>BIGINT</code>等,它们占用的存储空间依次递增，能表示的整数范围当然也是依次递增，如果我们想要对某个整数列建立索引的话，<code>在表示的整数范围允许的情况下，尽量让索引列使用较小的类型</code>，比如我们能使用INT就不要使用BIGINT，能使用MEDIUMINT就不要使用INT。
这是因为: <ul><li><code>数据类型越小，在查询时进行的比较操作越快</code></li><li><code>数据类型越小，索引占用的存储空间就越少，在一个数据页内就可以放下更多的记录，从而减少磁盘I/0带来的性能损耗，也就意味着可以把更多的数据页缓存在内存中，从而加快读写效率</code>。</li></ul></li><li>这个建议对于表的<code>主键来说更加适用</code>，因为不仅是聚簇索引中会存储主键值，其他所有的二级索引|的节点处都会存储一份记录的主键值，<code>如果主键使用更小的数据类型，也就意味着节省更多的存储空间和更高效的I/0</code>。</li></ul></blockquote></li><li><p>使用字符串前缀创建索引</p><blockquote><ul><li><p>假设字符串很长，那存储一个字符串就需要占用很大的存储空间。 在我们需要为这个字符事列建立索引时，那就意味着在对应的B+树中有这么两个问题:</p><ul><li><code>B+树索引中的记最需要把该列的完整字符串存储起来，更费时。而且字符串越长，在索引中占用的存储空间越大</code>。</li><li><code>如果B+树索引中索引列存储的字符串很长，那在做字符串比较时会占用更多的时间。</code></li></ul></li><li><p>我们可以通过<code>截取字段的前面一部分内容建立索引</code>，这个就叫<code>前缀索引</code>。这样在查找记录时虽然不能精确的定位到记录的位置，但是能定位到相应前缀所在的位置，然后根据前缀相同的记录的主键值回表查询完整的字符串值。既<code>节约空间</code>，又<code>减少了字符串的比较时间</code>，还大体能解决排序的问题。</p></li><li><p>问题是，截取多少呢?截取得多了，达不到节省索引存储空间的目的;截取得少了，重复内容太多，字段的散列度(选择性)会降低。<code>怎么计算不同的长度的选择性呢</code>?</p></li><li><p>计算截取长度的公式（<code>区分度</code>）： <code>count(distinct left(列名，索引长度))/count(*)</code></p></li><li><p>在Alibaba (Java开发手册》中<!-- -->[<code>强制的一条</code>]<!-- -->  </p><ul><li>在varchar字段上建立索引时，<code>必须指定索引长度</code>，<code>没必要对全字段建立索引</code>，根据实际<code>文本区分度</code>决定索引长度。</li><li>说明:索引的长度与区分度是一对矛盾体，<code>一般对字符串类型数据，长度为20的索引，区分度会高达98%以上</code>，可以使用count(distinct left(列名,索引长度))/count(*)的<code>区分度</code>来确定截取的长度。</li></ul></li></ul></blockquote></li><li><p>区分度高（散列性高）的散列适合作为索引</p><blockquote><ul><li><code>列的基数</code>指的是<code>某一列中不重复数据的个数</code>,比方说某个列包含值2，5，8. 2, 5, 8, 2,5,8,虽然有9条记录，但该列的基数却是3。也就是说，在记录行数一定的情况下，<code>列的基数越大，该列中的值越分散;列的基数越小，该列中的值越集中</code>。这个列的基数指标非常重要，直接影响我们是否能有效的利用索引。最好<code>为列的基数大的列建立索引</code>，为基数太小列的建立索引效果可能不好。</li><li>可以使用公式<code>select count(distinct a)/count(*) from t1</code>计算区分度，<code>越接近1越好，一般超过33%就 算是比较高效的索引了</code>。 </li><li>拓展:<code>联合索引把区分度高(散列性高)的列放在前面</code>。</li></ul></blockquote></li><li><p>使用最频繁的列放到联合索引的左侧</p></li><li><p>在多个字段都要创建索引的情况下，联合索引优于单值索引</p></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2限制索引的数量">2.限制索引的数量<a class="hash-link" href="#2限制索引的数量" title="标题的直接链接">​</a></h4><blockquote><p>在实际工作中，我们也需要注意平衡，索的数目不是越多越好。我们需要限制每张表上的索引数量,<code>建议单张表索引数量不超过6个。</code>
原因:</p><ul><li><ol><li>每个索引都需要占用磁盘空间，索引越多，需要的磁盘空间就越大。</li></ol></li><li><ol start="2"><li>索引会影响INSERT、DELETE. UPDATE等语句的性能，因为表中的数据更改的同时，索引也会进行调整和更新，会造成负担。</li></ol></li><li><ol start="3"><li>优化器在选择如何优化查询时，会根据统一信息,对每一个可以用到的索引来进行评估，以生成出一个最好的执行计划，如果同时有很多个索引都可以用于查询，会增加MySQL优化器生成执行计划时间，降低查询性能。</li></ol></li></ul></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3不适合创建索引的情况">3.不适合创建索引的情况<a class="hash-link" href="#3不适合创建索引的情况" title="标题的直接链接">​</a></h4><ul><li><p>在where中使用不到的字段，不要设置索引</p><blockquote><p><code>WHERE条件(包括GROUP BY，ORDER BY)里用不到的字段不需要创建索引</code>，索引的价值是快速定位，如果起不到定位的字段通常是不需要创建索引的。</p></blockquote></li><li><p>数据量小的表最好不要使用索引</p><blockquote><p>如果表记录太少，比如少于1000个，那么是不需要创建索引的。表记录太少。是否创建索引对查询效率的影响并不大。甚至说，查询花费的时间可能比遍历索引|的时间还要短，索引可能不会产生优化效果。</p></blockquote></li><li><p>有大量重复数据的列上不要建立索引</p><blockquote><p>在条件表达式中经常用到的不同值较多的列上建立索引，但<code>字段中如果有大量重复数据，也不用创建索引</code>，比如在学生表的“性别“字段上只有“男”与“女”两个不同值，因此无须建立索引。如果建立索引，不但不会提高查询效率，反而会严重降低数据更新速度 。</p><ul><li>结论:当数据重复度大，比如高于18% 的时候，也不需要对这个字段使用索引。</li></ul></blockquote></li><li><p>避免对经常更新的表创建过多的索引</p><blockquote><ul><li>第一层含义:<code>频繁更新的字段</code>不一定要创建索引。<code>因为更新数据的时候，也需要更新索引</code>,如果索引太多,在更新索引的时候也会造成负担，从而影响效率。</li><li>第二层含义:避免对经常更新的表创建过多的索引，井且索引中的列尽可能少。此时，虽然提高了查询速度，同时却会降低更新表的速度。</li></ul></blockquote></li><li><p>不建议用无序的值作为索引</p><blockquote><p>例如身份证、UUID(在索引比较时需要转为ASCII, 井且插入时可能造成<code>页分裂</code>)、MD5. HASH. 无序长字符串等。</p></blockquote></li><li><p>删除不再使用或很少使用的索引</p><blockquote><p>表中的数据被大量更新，或者数据的使用方式被改变后，原有的一-些索引可能不再需要。数据库管理员应当定期找出这些索引，将它们删除，从而减少索引|对更新操作的影响。</p></blockquote></li><li><p>不要定义冗余或重复的索引</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="二性能分析工具的使用">二、性能分析工具的使用<a class="hash-link" href="#二性能分析工具的使用" title="标题的直接链接">​</a></h2><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1查看系统性能参数">1.查看系统性能参数<a class="hash-link" href="#1查看系统性能参数" title="标题的直接链接">​</a></h4><ul><li><p><code>SHOW STATUS</code>查询一些MySQL数据库服务器的<code>性能参数</code>、<code>执行频率</code>。</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">session</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;参数&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>一些常用的性能参数如下: </p><ul><li><code>Connections</code>: 连接MySQL服务器的次数。</li><li><code>Uptime</code>: MySQL服务器的上线时间。</li><li><code>Slow_queries</code>: 慢查询的次数。</li><li><code>Innodb_rows_read</code>: Select查询返回的行数 </li><li><code>Innodb_rows_inserted</code>: 执行INSERT操作插入的行数 。</li><li><code>Innodb_rows_updated</code>:执行UPDATE操作更新的行数 </li><li><code>Innodb_rows_deleted</code>: 执行DELETE操作删除的行数 。</li><li><code>Com_select</code>: 查询操作的次数。</li><li><code>Com_insert</code>: 插入操作的次数。对于批量插入的INSERT操作，只累加一次。 </li><li><code>Com_update</code>:更新操作的次数。 </li><li><code>Com_delete</code>: 删除操作的次数。</li></ul></blockquote></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2统计sql的查询成本last_query_cost">2.统计SQL的查询成本：last_query_cost<a class="hash-link" href="#2统计sql的查询成本last_query_cost" title="标题的直接链接">​</a></h4><blockquote><ul><li>一条SQL查询语句在执行前需要确定查询执行计划。如果存在多种执行计划的话，MySQL会计算每个执行计划所需要的成本，从中选择成本最小的一个作为最终执行的执行计划。</li><li>如果我们想要查看某条SQL语句的查询成本。可以在执行完这条SQL语句之后，通过查看当前会话中的 <code>last_query_cost</code>变量值来得到当前查询的成本。它通常也是我们评价一个查询的执行效率的一个常用指标。这个<code>查询成本对应的是SQL语句所需要读取的页的数量</code>.</li></ul></blockquote><ul><li><p>查看查询成本</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;last_query_cost&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>SQL查询是一个动态的过程，从页加载的角度来看，我们可以得到以下两点结论: </p><ul><li>1.<code>位置决定效率</code>。如果页就在数据库缓冲池中，那么效率是最高的，否则还需要从内存或者磁盘中进行读取，当然针对单个页的读取来说，如果页存在于内存中，会比在磁盘中读取效率高很多。 </li><li>2.<code>批量决定效率</code> 。如果我们从磁盘中对单一页进行随机读，那么效率是很低的(差不多10ms)，而采用<code>顺序读取的方式，批量对页进行读取</code>，平均一页的读取效率就会提升很多，甚至<code>要快于单个页面在内存中的随机读取</code>。</li></ul><p>所以说，遇到I/0并不用担心，方法找对了，效率还是很高的。我们首先要考虑数据存放的位置，如果是<code>经常使用的数据就要尽量放到缓冲池中</code>，其次我们可以充分利用磁盘的吞吐能力，<code>一次性批量读取数据</code>，这样单个页的读取效率也就得到了提升。</p></blockquote></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="三慢查询日志定位慢sql">三、慢查询日志:定位慢SQL<a class="hash-link" href="#三慢查询日志定位慢sql" title="标题的直接链接">​</a></h2><blockquote><ul><li>MySQL的慢查询日志，用来记录在MySQL中<code>响应时间超过阈值</code>的SQL语句,具体指运行时间超过<code>long_query_time</code>值的SQL,则会被记录到慢查询日志中。long_query_time的默认值为10，意思是运行10秒以上(不含10秒)的语句，认为是超出了我们的最大忍耐时间值。 <ul><li>它的主要作用是，帮助我们发现那些执行时间特别长的SQL查询，并且有针对性地进行优化，从而提高系统的整体效率当我们的数据库服务器发生阻塞、运行变慢的时候，检查一下慢查询日志, 找到那些慢查询,对解决问题很有帮助。比如一条sql执行超过5秒钟，我们就算慢SQL，希望能收集超过5秒的sql，结合<code>explain</code>进行全面析。</li></ul></li><li>默认情况下，MySQL数据库没有开启慢查询日志，需要我们手动来设置这个参数。<code>如果不是调优需要的话，一般不建议启动该参数，因为开启慢查询日志会或多或少带来一定的性能影响</code>。</li><li>慢查询日志支持将日志记录写入文件。</li></ul></blockquote><ul><li><p>开启慢查询日志</p><blockquote><p><code>slow_query_log</code> 慢查询日志参数 <code>slow_query_log_file</code> 慢查询日志文件参数</p></blockquote><p>  <img loading="lazy" alt="slow_query_log" src="data:image/png;base64,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" width="604" height="148" class="img_ev3q"></p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> slow_query_log </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>修改long_query_time的值</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#临时修改</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> long_query_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 阈值</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> long_query_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 阈值</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>通过修改配置文件</p><blockquote><p>修改my.cnf文件，<!-- -->[mysqld]<!-- -->下增加或修改参数 <code>long_query_time</code>、<code>slow_query_log</code>和
<code>slow_query_log_file</code> 后，然后<code>重启MySQL</code>服务器。</p></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slow_query_log </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  slow_query_log_file </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 存放日志文件的位置</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  long_query_time </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> 阈值</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  log_output </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FILE</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#将日志存放到文件中</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>查看慢查询数目</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">status</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">like</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;slow_queries&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>控制慢查询日志的还有一个系统变量: <code>min_examined_row_limit</code>。 这个变量的意思是，<code>查询扫描过的最少记录数</code>。这个变量和查询执行时间，共同组成了判别一个查询是否是慢查询的条件，<code>如果查询扫描过的记录数大于等于这个变量的值，并且查询执行时间超过long_query_time的值，那么，这个查询就被记录到慢查询日志中;反之，则不被记录到慢查询日志中。</code></p></blockquote></li><li><p>慢查询日志分析工具</p><blockquote><p>在生产环境中，如果要手工分析日志，查找、分析SQL，显然是个体力活，MySQL提供了日志分析工具 <code>mysqldumpslow</code>。</p><ul><li><code>注意：该工具不是在mysql环境下使用，而是在Linux环境下使用</code> </li></ul></blockquote><p>  <img loading="lazy" alt="mysqldumpslow" src="/assets/images/mysqldumpslow-dd0a617777804789eb65cf2e51d84c7b.png" width="1048" height="564" class="img_ev3q"></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mysqldumpslow -s t -t </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> /var/lib/mysql/Lhk001-slow.log </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>关闭慢查询日志</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#修改配置文件，修改后重启mysql服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">mysqld</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">slow_query_log</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">off</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#或者直接注释或删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#使用set语句临时关闭</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">global</span><span class="token plain"> slow_query_log</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">off</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>删除慢查询日志文件</p><ol><li><p>直接手动删除文件即可</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> Lhk001-slow.log</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>重新生成慢查询日志文件</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> mysqladmin -u root -p flush-logs slow</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>慢查询日志都是使用<code>mysqladmin flush-logs</code>命令来删除重建的。使用时一定要注意，一旦执行了这个命令，慢查询日志都只存在新的日志文件中，如果需要旧的查询日志，就必须事先备份。</p></blockquote></li></ol></li><li><p>查看SQL的执行成本：show profile</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#开启profiling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> profiling </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">on</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#查看SQL执行成本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> profiles</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#查看最后执行的SQL执行成本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> profile</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#查看指定query id 的SQL的执行成本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">show</span><span class="token plain"> profile </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> query n</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>show profile的常用查询参数: </p><ul><li><code>ALL</code>:显示所有的开销信息。</li><li><code>BLOCK I0</code>:显示块I0开销。 </li><li><code>CONTEXT SWITCHES</code>:上下文切换开销。</li><li><code>CPU</code>:显示CPU开销信息。 </li><li><code>IPC</code>:显示发送和接收开销信息。 </li><li><code>MEMORY</code>:显示内存开销信息。</li><li><code>PAGE FAULTS</code>:显示页面错误开销信息。 </li><li><code>SOURCE</code>:显示和Source_function, Source_file, Source_line相关的开销信息。</li><li><code>SWAPS</code>:显示交换次数开销信息。 </li></ul></blockquote><p>  日常开发需注意的结论:</p><blockquote><ul><li><code>converting HEAP to MyISAM</code>:查询结果太大,内存不够，数据往磁盘上搬了。 </li><li><code>Creating tmp table</code>:创建临时表。先拷贝数据到临时表，用完后再删除临时表。 </li><li><code>Copying to tmp table on disk</code>:把内存中时表复制到磁盘上,警惕! </li><li><code>locked</code> </li></ul><p>如果在<code>show profile</code>诊断结果中出现了以上4条结果中的任何一条，则sql语句需要优化。
注意: 不过<code>SHOW PROFILE</code>命令将被弃用，我们可以从information_schema中的profling数据表进行查看。</p></blockquote></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="四分析查询语句explain">四、分析查询语句：explain<a class="hash-link" href="#四分析查询语句explain" title="标题的直接链接">​</a></h2><blockquote><ul><li>定位了查询慢的SQL之后，我们就可以使用<code>EXPLAIN</code>或<code>DESCRIBE</code>工具做针对性的分析查询语句。</li><li>MySQL为我们提供了<code>EXPLAIN</code>语句来帮助我们查看某个查询语句的具体执行计划，大家看懂<code>EXPLAIN</code>语句的各个输出项，可以有针对性的提升我们查询语句的性能。</li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">explain</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SQL</span><span class="token plain">语句</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">#或</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">describe</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SQL</span><span class="token plain">语句</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>EXPLAIN语句输出的各个列的作用如下:</p><table><thead><tr><th>列名</th><th>描述</th></tr></thead><tbody><tr><td>id</td><td>在一个<code>大的查询语句</code>中<code>每个SELECT关键字</code>都对应一个<code>唯一的id</code></td></tr><tr><td>select_type</td><td>SELECT关键字<code>对应的那个查询的类型</code> ，用于确定小查询在大查询中扮演的角色</td></tr><tr><td>table</td><td>表名，查询的每一行记录对应着一个单表</td></tr><tr><td>partitions</td><td>匹配的分区信息</td></tr><tr><td>type</td><td>针对单表的访问方法</td></tr><tr><td>possible_keys</td><td>可能用到的索引</td></tr><tr><td>key</td><td>实际上使用的索引</td></tr><tr><td>key_len</td><td>实际使用到的索引长度，对于联合索引，值越大越好</td></tr><tr><td>ref</td><td>当使用索引列<code>等值查询</code>时，与索引列进行等值匹配的对象信息</td></tr><tr><td>rows</td><td>预估的需要读取的记录条数，<code>越小越好</code></td></tr><tr><td>filtered</td><td>某个表经过<code>搜索条件过滤后</code>剩余记录条数的<code>百分比</code></td></tr><tr><td>Extra</td><td>一些额外的信息一些额外的信息</td></tr></tbody></table><ul><li><p>关于 id</p><blockquote><ul><li><code>id如果相同，可以认为是一组，从上往下顺序执行</code> </li><li><code>在所有组中, id值越大，优先级越高,越先执行</code> </li><li>“关注点:
<code>id号每个号码，表示一趟独立的查询, 一个sql的查询趟数越少越好</code></li></ul></blockquote></li><li><p>关于type</p><blockquote><ul><li>结果值从最好到最坏依次是: <ul><li><code>system</code> &gt; <code>const</code>&gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; fulltext &gt; ref_or_null &gt; index_merge &gt; unique_subquery &gt; index_subquery &gt; <code>range</code> &gt; <code>index</code> &gt; <code>ALL</code> </li><li>其中比较重要的几个提取出来（框起来的几个）。</li></ul></li><li>SQL 性能优化的目标：至少要达到range级别，要求是ref 级别，最好是const级别。(阿里巴巴开发手册要求)</li><li>EXPLAIN不考虑各种Cache </li><li>EXPLAIN不能显示MySQL在执行查询时所作的优化工作</li><li>EXPLAIN不会告诉你关于触发器、存储过程的信息或用户自定义函数对查询的影响情况</li><li>部分统计信息是估算的，并非精确值</li></ul></blockquote></li><li><p>explain的四种输出格式</p><blockquote><ul><li>EXPLAIN可以输出四种格式:<ul><li><code>传统格式（EXPLAIN ...）</code></li><li><code>JSON格式(EXPLAIN FORMAT=JSON ...)</code></li><li><code>TREE格式(EXPLAIN FORMAT=TREE ...)</code></li><li><code>可视化输出(Workbench工具)</code>。</li></ul></li></ul></blockquote></li><li><p>show warnings</p><blockquote><p>在我们使用EXPLAIN语句查看了某个查询的执行计划后，紧接着还可以使用<code>SHOW WARNINGS</code> 语句查看与这个查询的执行计划有关的一些扩展信息</p></blockquote></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="五分析优化器执行计划trace">五、分析优化器执行计划：trace<a class="hash-link" href="#五分析优化器执行计划trace" title="标题的直接链接">​</a></h2><blockquote><ul><li><code>OPTIMIZER_TRACE</code>是MySQL 5.6引入的一项<code>跟踪功能</code>，它可以跟踪优化器做出的各种决策(比如访问表的方法、各种开销计算、各种转换等)，并将跟踪结果记录到<code>INFORMATION_SCHEMA.0PTIMIZER_TRACE</code>表中。</li><li>此功能默认关闭。开启trace, 并设置格式为JSON,同时设置trace最大能够使用的内存大小，避免解析过程中因为默认内存过小而不能够完整展示。</li></ul></blockquote><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> optimizer_trace </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;enabled=on&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">end_markers_in_json</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">on</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">set</span><span class="token plain"> optimizer_trace_max_mem_size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100000</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">#查看表information_schema.optimizer_trace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> information_schema</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimizer_trace\G</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="六mysql-监控分析视图--sys-schema">六、MySQL 监控分析视图 —— sys schema<a class="hash-link" href="#六mysql-监控分析视图--sys-schema" title="标题的直接链接">​</a></h2><blockquote><p>关于MySQL的性能监控和问题诊断，我们一般都从<code>performance_schema</code>中去获取想要的数据，在MySQL5.7.7版本中新增<code>sys schema</code>,它将<code>performance_schema</code>和<code>information_schema</code>中的数据以更容易理解的方式总结归纳为&quot;视 图&quot;，<code>其目的就是为了降低查询performance_schema的复杂度，让DBA能够快速的定位问题</code>。</p></blockquote><ul><li><p>Sys schema 视图摘要</p><blockquote><ol><li>主机相关:以host summary开头,主要汇总了I0延迟的信息。</li><li>Innodb相关:以innodb开头, 汇总了innodb buffer信息和事务等待innodb锁的信息。</li><li>I/o相关:以io开头， 汇总了等待I/0、 I/0使用量情况。</li><li>内存使用情况:以memory开头, 从主机线程、事件等角度展示内存的使用情况</li><li>连接与会话信息: proesslist印session相关视图， 总结了会话相关信息。</li><li>表相关:以 schema_table 开头的视图，展示了表的统计信息。</li><li>索引信息:统计了索引的使用情况，包含冗余索引和未使用的索引情况。</li><li>语句相关:以statement开头，包含执行全表扫描、使用临时表、排序等的语句信息。</li><li>用户相关:以user开头的规图, 统计了用户使用的文件I/0。执行语句统计信息。</li><li>等待事件相关信息:以wait开头， 展示等待事件的延迟情况。</li></ol></blockquote></li><li><p>Sys schema 视图使用场景</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#索引相关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#1.查询冗余索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema_redundant_indexes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#2.查询未使用过的索引</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema_unused_indexes</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#3.查询索引的使用情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> index_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">rows_selected</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">row_inserted</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">rows_updated</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">rows_deleted </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema_index_statistics </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> table_schema</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;dbname&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#表相关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#1.查询表的访问量</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> table_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token function" style="color:#d73a49">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">io_read_requests</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">io_requests</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> io </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">schema_table_statistics </span><span class="token keyword" style="color:#00009f">group</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> table_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">table_name </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> io </span><span class="token keyword" style="color:#00009f">desc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#2.查询占用bufferpool较多的表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> object_schema</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">object_name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">allocated</span><span class="token punctuation" style="color:#393A34">,</span><span class="token keyword" style="color:#00009f">data</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">innodb_buffer_stats_by_table </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> allocated </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#3.查询表的全表扫描情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> ysy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statements_with_full_table_scans </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> db</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;dbname&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#语句相关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#1.监控SQL执行效率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">exec_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">query </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statement_analysis </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> exec_count </span><span class="token keyword" style="color:#00009f">desc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#2.监控使用了排序的SQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">exec_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">first_seen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">last_seen</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">query </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statement_with_sorting </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#3.监控使用了临时表或者磁盘临时表的SQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> db</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">exec_count</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">tmp_tables</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">tmp_disk_tables</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">query </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">statement_analysis </span><span class="token keyword" style="color:#00009f">where</span><span class="token plain"> tmp_tables</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> ro tmp_disk_tables </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tmp_tables</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">tmp_disk_tables </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">desc</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#io相关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">file</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">avg_read</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">avg_write</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">avg_read</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">avg_write </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> avg_io </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">io_global_by_bytes </span><span class="token keyword" style="color:#00009f">order</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">by</span><span class="token plain"> avg_read </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#innodb相关</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">#1.行锁阻塞情况</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">select</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> sys</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">innodb_lock_waits</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><ul><li>风险提示: <blockquote><p>通过 sys 库去查询时，MySQL 会<code>消耗大最资源</code>去收集相关信息，严重的可能会导致业务请求被阻塞，从而引起故障。
建议生产上<code>不要频繁</code>的去查询 sys 或者 performance_schema、information_schema 来完成监控、巡检等工作。</p></blockquote></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文档分页导航"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/MySql/advanced/mysql-advance-1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">MySQL 高级第一篇</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/MySql/advanced/mysql-advance-3"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">MySQL 高级第三篇</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#一索引的创建与设计原则" class="table-of-contents__link toc-highlight">一、索引的创建与设计原则</a><ul><li><a href="#1-索引的分类" class="table-of-contents__link toc-highlight">1. 索引的分类</a></li><li><a href="#2-索引的声明和使用" class="table-of-contents__link toc-highlight">2. 索引的声明和使用</a></li><li><a href="#3-mysql80-索引新特性" class="table-of-contents__link toc-highlight">3. mysql8.0 索引新特性</a></li><li><a href="#4-索引的设计原则" class="table-of-contents__link toc-highlight">4. 索引的设计原则</a></li></ul></li><li><a href="#二性能分析工具的使用" class="table-of-contents__link toc-highlight">二、性能分析工具的使用</a></li><li><a href="#三慢查询日志定位慢sql" class="table-of-contents__link toc-highlight">三、慢查询日志:定位慢SQL</a></li><li><a href="#四分析查询语句explain" class="table-of-contents__link toc-highlight">四、分析查询语句：explain</a></li><li><a href="#五分析优化器执行计划trace" class="table-of-contents__link toc-highlight">五、分析优化器执行计划：trace</a></li><li><a href="#六mysql-监控分析视图--sys-schema" class="table-of-contents__link toc-highlight">六、MySQL 监控分析视图 —— sys schema</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 HankLay, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.11a1e1e4.js"></script>
<script src="/assets/js/main.2c7bbae3.js"></script>
</body>
</html>