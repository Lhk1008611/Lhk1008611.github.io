"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3414],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),m=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=m(e.components);return a.createElement(s.Provider,{value:t},e.children)},k="mdxType",o={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},N=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,l=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),k=m(n),N=i,u=k["".concat(s,".").concat(N)]||k[N]||o[N]||l;return n?a.createElement(u,r(r({ref:t},d),{},{components:n})):a.createElement(u,r({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var l=n.length,r=new Array(l);r[0]=N;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p[k]="string"==typeof e?e:i,r[1]=p;for(var m=2;m<l;m++)r[m]=n[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}N.displayName="MDXCreateElement"},408:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>k,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var a=n(87462),i=(n(67294),n(3905));const l={sidebar_position:5},r="Redis \u539f\u7406",p={unversionedId:"Redis/ReidsPrinciple",id:"Redis/ReidsPrinciple",title:"Redis \u539f\u7406",description:"- redis \u6e90\u7801\uff1aredis/redis Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps. (github.com)",source:"@site/docs/Redis/ReidsPrinciple.md",sourceDirName:"Redis",slug:"/Redis/ReidsPrinciple",permalink:"/docs/Redis/ReidsPrinciple",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Redis \u9ad8\u7ea7",permalink:"/docs/Redis/RedisSenior"},next:{title:"Dubbo",permalink:"/docs/category/dubbo"}},s={},m=[{value:"\u4e00\u3001\u6570\u636e\u7ed3\u6784",id:"\u4e00\u6570\u636e\u7ed3\u6784",level:2},{value:"SDS(\u52a8\u6001\u5b57\u7b26\u4e32)",id:"sds\u52a8\u6001\u5b57\u7b26\u4e32",level:3},{value:"IntSet",id:"intset",level:3},{value:"Dict",id:"dict",level:3},{value:"Dict \u7684\u6269\u5bb9",id:"dict-\u7684\u6269\u5bb9",level:4},{value:"Dict \u7684\u6536\u7f29",id:"dict-\u7684\u6536\u7f29",level:4},{value:"Dict \u7684 rehash",id:"dict-\u7684-rehash",level:4},{value:"ZipList",id:"ziplist",level:3},{value:"ZipList \u4e2d\u7684 Entry",id:"ziplist-\u4e2d\u7684-entry",level:4},{value:"ZipList Entry \u4e2d\u7684 encoding \u7f16\u7801",id:"ziplist-entry-\u4e2d\u7684-encoding-\u7f16\u7801",level:4},{value:"ZipList \u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898",id:"ziplist-\u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898",level:4},{value:"ZipList \u7684\u7279\u6027",id:"ziplist-\u7684\u7279\u6027",level:4},{value:"QuickList",id:"quicklist",level:3},{value:"SkipList",id:"skiplist",level:3},{value:"RedisObject",id:"redisobject",level:3},{value:"Redis \u4e94\u79cd\u6570\u636e\u7c7b\u578b",id:"redis-\u4e94\u79cd\u6570\u636e\u7c7b\u578b",level:3},{value:"1. string",id:"1-string",level:4},{value:"2. List",id:"2-list",level:4},{value:"3. set",id:"3-set",level:4},{value:"4. Zset \uff08SortedSet\uff09",id:"4-zset-sortedset",level:4},{value:"5. Hash",id:"5-hash",level:4},{value:"\u4e8c\u3001\u7f51\u7edc\u6a21\u578b",id:"\u4e8c\u7f51\u7edc\u6a21\u578b",level:2},{value:"\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4",id:"\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4",level:3},{value:"\u963b\u585e IO \uff08Blocking I0\uff09",id:"\u963b\u585e-io-blocking-i0",level:3},{value:"\u975e\u963b\u585e IO\uff08Nonblocking I0\uff09",id:"\u975e\u963b\u585e-iononblocking-i0",level:3},{value:"IO \u591a\u8def\u590d\u7528\uff08I0 Multiplexing\uff09",id:"io-\u591a\u8def\u590d\u7528i0-multiplexing",level:3},{value:"1. select",id:"1-select",level:4},{value:"2. poll",id:"2-poll",level:4},{value:"3. epoll",id:"3-epoll",level:4},{value:"\u4e8b\u4ef6\u901a\u77e5\u673a\u5236",id:"\u4e8b\u4ef6\u901a\u77e5\u673a\u5236",level:5},{value:"\u57fa\u4e8e epoll \u6a21\u5f0f\u7684 web \u670d\u52a1\u7684\u57fa\u672c\u6d41\u7a0b",id:"\u57fa\u4e8e-epoll-\u6a21\u5f0f\u7684-web-\u670d\u52a1\u7684\u57fa\u672c\u6d41\u7a0b",level:5},{value:"\u4fe1\u53f7\u9a71\u52a8 IO\uff08Signal Driven l0\uff09",id:"\u4fe1\u53f7\u9a71\u52a8-iosignal-driven-l0",level:3},{value:"\u5f02\u6b65 I0 \uff08Asynchronous I0\uff09",id:"\u5f02\u6b65-i0-asynchronous-i0",level:3},{value:"\u540c\u6b65 IO \u548c\u5f02\u6b65 IO",id:"\u540c\u6b65-io-\u548c\u5f02\u6b65-io",level:5},{value:"Redis \u7f51\u7edc\u6a21\u578b",id:"redis-\u7f51\u7edc\u6a21\u578b",level:3},{value:"Redis \u5230\u5e95\u662f\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b?",id:"redis-\u5230\u5e95\u662f\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b",level:5},{value:"\u4e09\u3001\u901a\u4fe1\u534f\u8bae",id:"\u4e09\u901a\u4fe1\u534f\u8bae",level:2},{value:"RESP \u534f\u8bae",id:"resp-\u534f\u8bae",level:3},{value:"RESP \u6570\u636e\u7c7b\u578b",id:"resp-\u6570\u636e\u7c7b\u578b",level:3},{value:"\u6a21\u62df Redis \u5ba2\u6237\u7aef",id:"\u6a21\u62df-redis-\u5ba2\u6237\u7aef",level:3},{value:"\u56db\u3001\u5185\u5b58\u7b56\u7565",id:"\u56db\u5185\u5b58\u7b56\u7565",level:2},{value:"\u8fc7\u671f\u7b56\u7565",id:"\u8fc7\u671f\u7b56\u7565",level:3},{value:"reids \u7684 DB \u7ed3\u6784",id:"reids-\u7684-db-\u7ed3\u6784",level:4},{value:"\u60f0\u6027\u5220\u9664",id:"\u60f0\u6027\u5220\u9664",level:4},{value:"\u5468\u671f\u5220\u9664",id:"\u5468\u671f\u5220\u9664",level:4},{value:"\u6dd8\u6c70\u7b56\u7565",id:"\u6dd8\u6c70\u7b56\u7565",level:3}],d={toc:m};function k(e){let{components:t,...l}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,l,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"redis-\u539f\u7406"},"Redis \u539f\u7406"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"redis \u6e90\u7801\uff1a",(0,i.kt)("a",{parentName:"li",href:"https://github.com/redis/redis"},"redis/redis: Redis is an in-memory database that persists on disk. The data model is key-value, but many different kind of values are supported: Strings, Lists, Sets, Sorted Sets, Hashes, Streams, HyperLogLogs, Bitmaps. (github.com)")),(0,i.kt)("li",{parentName:"ul"},"\u4ee5\u4e0b\u51fa\u73b0\u7684\u6e90\u7801\u662f\u57fa\u4e8e redis 6.2 \u7248\u672c")),(0,i.kt)("h2",{id:"\u4e00\u6570\u636e\u7ed3\u6784"},"\u4e00\u3001\u6570\u636e\u7ed3\u6784"),(0,i.kt)("h3",{id:"sds\u52a8\u6001\u5b57\u7b26\u4e32"},"SDS(\u52a8\u6001\u5b57\u7b26\u4e32)"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u4e2d\u4fdd\u5b58\u7684 Key \u662f\u5b57\u7b26\u4e32\uff0cvalue \u5f80\u5f80\u662f\u5b57\u7b26\u4e32\u6216\u8005\u5b57\u7b26\u4e32\u7684\u96c6\u5408\u3002\u53ef\u89c1\u5b57\u7b26\u4e32\u662f Redis \u4e2d\u6700\u5e38\u7528\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7ecf\u8fc7 Redis \u662f\u7531  C \u8bed\u8a00\u7f16\u5199\u7684\uff0c\u4f46\u662f Redis \u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u4e2d\u7684\u5b57\u7b26\u4e32\uff0c\u56e0\u4e3a C \u8bed\u8a00\u5b57\u7b26\u4e32\u5b58\u5728\u5f88\u591a\u95ee\u9898"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u9700\u8981\u901a\u8fc7\u8fd0\u7b97"),(0,i.kt)("li",{parentName:"ul"},"\u975e\u4e8c\u8fdb\u5236\u5b89\u5168",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5b57\u7b26\u6570\u7ec4\u4e2d\u95f4\u5b58\u5728 ",(0,i.kt)("inlineCode",{parentName:"li"},"/0"),"\u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u5b57\u7b26\u5c31\u4f1a\u5728",(0,i.kt)("inlineCode",{parentName:"li"},"/0"),"\u5904\u7ed3\u675f\uff0c\u8868\u793a\u5b57\u7b26\u6570\u7ec4\u4e0d\u80fd\u5b58\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26"))),(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u53ef\u4fee\u6539"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u6b64\uff0cRedis \u6784\u5efa\u4e86\u4e00\u79cd\u65b0\u7684\u5b57\u7b26\u4e32\u7ed3\u6784\uff0c\u79f0\u4e3a",(0,i.kt)("strong",{parentName:"p"},"\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32"),"(Simple Dynamic string)\u7b80\u79f0 SDS"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"SDS \u4e5f\u662f\u901a\u8fc7 C \u8bed\u8a00\u7f16\u5199\uff0c\u662f\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"sds.h")," \u4e2d\u5b9a\u4e49\uff0c\u6e90\u7801\u5982\u4e0b"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"struct __attribute__ ((__packed__)) sdshdr8 {\n    uint8_t len; /* used  */  // buf \u5df2\u4fdd\u5b58\u7684\u5b57\u7b26\u4e32\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u542b\u7ed3\u675f\u6807\u793a\n    uint8_t alloc; /* excluding the header and null terminator */  //buf\u7533\u8bf7\u7684\u603b\u7684\u5b57\u8282\u6570\uff0c\u4e0d\u5305\u542b\u7ed3\u675f\u6807\u793a\n    unsigned char flags; /* 3 lsb of type, 5 unused bits */  //\u4e0d\u540c SDS \u7684\u5934\u7c7b\u578b\uff0c\u7528\u6765\u63a7\u5236 SDS \u7684\u5934\u5927\u5c0f\n    char buf[]; //\u5b58\u6570\u636e\u4f53\n};\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"flags")," \u7684\u5177\u4f53\u7c7b\u578b\u4e5f\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"sds.h")," \u4e2d\u6709\u5b9a\u4e49"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"#define SDS_TYPE_5  0\n#define SDS_TYPE_8  1\n#define SDS_TYPE_16 2\n#define SDS_TYPE_32 3\n#define SDS_TYPE_64 4\n#define SDS_TYPE_MASK 7\n#define SDS_TYPE_BITS 3\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0c\u4e00\u4e2a\u5305\u542b\u5b57\u7b26\u4e32  name \u7684 SDS \u7ed3\u6784\u5982\u4e0b"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240719010039756",src:n(78997).Z,width:"586",height:"100"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"SDS \u4e4b\u6240\u4ee5\u53eb\u505a\u52a8\u6001\u5b57\u7b26\u4e32\uff0c\u662f\u56e0\u4e3a\u5b83\u5177\u5907\u52a8\u6001\u6269\u5bb9\u7684\u80fd\u529b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5047\u5982\u6211\u4eec\u8981\u7ed9 SDS \u8ffd\u52a0\u4e00\u6bb5\u5b57\u7b26\u4e32,\u9996\u5148\u4f1a\u7533\u8bf7\u65b0\u5185\u5b58\u7a7a\u95f4"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u65b0\u5b57\u7b26\u4e32\u5c0f\u4e8e1M\uff0c\u5219\u65b0\u7a7a\u95f4\u4e3a\u6269\u5c55\u540e\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u4e24\u500d+1;"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u65b0\u5b57\u7b26\u4e32\u5927\u4e8e1M\uff0c\u5219\u65b0\u7a7a\u95f4\u4e3a\u6269\u5c55\u540e\u5b57\u7b26\u4e32\u957f\u5ea6+1M+1\u3002\u79f0\u4e3a\u5185\u5b58\u9884\u5206\u914d\u3002"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0c\u4e00\u4e2a\u5185\u5bb9\u4e3a \u201chi\u201d \u7684 SDS:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240719010813672",src:n(16432).Z,width:"452",height:"74"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8ffd\u52a0\u4e00\u6bb5\u5b57\u7b26\u4e32 \u201cAmy\u201d \u5219\u53d8\u6210\u5982\u4e0b"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240719011010853",src:n(42496).Z,width:"824",height:"80"}))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"SDS \u7684\u4f18\u70b9"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a0(1)"),(0,i.kt)("li",{parentName:"ol"},"\u652f\u6301\u52a8\u6001\u6269\u5bb9"),(0,i.kt)("li",{parentName:"ol"},"\u51cf\u5c11\u5185\u5b58\u5206\u914d\u6b21\u6570"),(0,i.kt)("li",{parentName:"ol"},"\u4e8c\u8fdb\u5236\u5b89\u5168")))))),(0,i.kt)("h3",{id:"intset"},"IntSet"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"IntSet \u662f Redis \u4e2d set \u96c6\u5408\u7684\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u57fa\u4e8e",(0,i.kt)("strong",{parentName:"p"},"\u6574\u6570\u6570\u7ec4"),"\u6765\u5b9e\u73b0\uff0c\u5e76\u4e14\u5177\u5907",(0,i.kt)("strong",{parentName:"p"},"\u957f\u5ea6\u53ef\u53d8"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u6709\u5e8f"),"\u7b49\u7279\u5f81"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7ed3\u6784\u5b9a\u4e49\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"intset.h"),"\u4e2d"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"typedef struct intset {\n    uint32_t encoding; /* \u7f16\u7801\u65b9\u5f0f\uff0c\u652f\u6301\u5b58\u653e16\u4f4d\u300132\u4f4d\u300164\u4f4d\u6574\u6570 */\n    uint32_t length;   /* \u5143\u7d20\u4e2a\u6570 */\n    int8_t contents[]; /* \u6574\u6570\u6570\u7ec4\uff0c\u4fdd\u5b58\u96c6\u5408\u6570\u636e */\n} intset;\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u867d\u7136 ",(0,i.kt)("inlineCode",{parentName:"p"},"intset")," \u7ed3\u6784\u5c06 ",(0,i.kt)("inlineCode",{parentName:"p"},"contents")," \u5c5e\u6027\u58f0\u660e\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"int8_t")," \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u53ea\u662f\u5145\u5f53\u4e86\u4e00\u4e2a\u6307\u5411\u96c6\u5408\u6570\u636e\u7684\u6307\u9488\uff0c\u5b9e\u9645\u4e0a ",(0,i.kt)("inlineCode",{parentName:"p"},"contents")," \u6570\u7ec4\u5e76\u4e0d\u4fdd\u5b58\u4efb\u4f55 ",(0,i.kt)("inlineCode",{parentName:"p"},"int8_t")," \u7c7b\u578b\u7684\u503c\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"contents")," \u6570\u7ec4\u7684\u771f\u6b63\u7c7b\u578b\u53d6\u51b3\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding")," \u5c5e\u6027\u7684\u503c"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5176\u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding")," \u5305\u542b\u4e09\u79cd\u6a21\u5f0f\uff0c\u8868\u793a\u5b58\u50a8\u7684\u6574\u6570\u5927\u5c0f\u4e0d\u540c\uff0c\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"intset.c"),"\u4e2d\u5b9a\u4e49"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/* Note that these encodings are ordered, so:\n * INTSET_ENC_INT16 < INTSET_ENC_INT32 < INTSET_ENC_INT64. */\n#define INTSET_ENC_INT16 (sizeof(int16_t)) /* 2\u5b57\u8282\u6574\u6570\uff0c\u8303\u56f4\u7c7b\u4f3cjava\u7684short */\n#define INTSET_ENC_INT32 (sizeof(int32_t)) /* 4\u5b57\u8282\u6574\u6570\uff0c\u8303\u56f4\u7c7b\u4f3cjava\u7684int */\n#define INTSET_ENC_INT64 (sizeof(int64_t)) /* 8\u5b57\u8282\u6574\u6570\uff0c\u8303\u56f4\u7c7b\u4f3cjava\u7684long */\n"))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u65b9\u4fbf\u67e5\u627e\uff0cRedis \u4f1a\u5c06 intset \u4e2d\u6240\u6709\u7684\u6574\u6570",(0,i.kt)("strong",{parentName:"p"},"\u6309\u7167\u5347\u5e8f"),"\u4f9d\u6b21\u4fdd\u5b58\u5728 contents \u6570\u7ec4\u4e2d\uff0c\u7ed3\u6784\u5982\u56fe"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240719044415982",src:n(86671).Z,width:"659",height:"170"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u4e0a\u56fe\u7684\u6bcf\u90e8\u5206\u5b57\u8282\u5927\u5c0f\u4e3a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"encoding: 4\u5b57\u8282",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"uint32_t")," \u7c7b\u578b\u4e3a32bit = 4\u5b57\u8282"))),(0,i.kt)("li",{parentName:"ul"},"length: 4\u5b57\u8282",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"uint32_t")," \u7c7b\u578b\u4e3a32bit = 4\u5b57\u8282"))),(0,i.kt)("li",{parentName:"ul"},"contents: 2\u5b57\u8282*3=6\u5b57\u8282",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6839\u636e ",(0,i.kt)("inlineCode",{parentName:"li"},"encoding:INTSET ENC_INT16")," \u51b3\u5b9a\u6bcf\u4e2a\u5143\u7d20\u4e3a 16bit = 2\u5b57\u8282"))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Intset \u7c7b\u578b\u5347\u7ea7\uff0c\u5177\u4f53\u5347\u7ea7\u6e90\u7801\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"intset.c"),"\u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"intsetAdd")," \u65b9\u6cd5"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5047\u8bbe\u6709\u4e00\u4e2a intset\uff0c\u5143\u7d20\u4e3a {5,10,20}\uff0c\u91c7\u7528\u7684\u7f16\u7801\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"INTSET_ENC_INT16"),"\uff0c\u5219\u6bcf\u4e2a\u6574\u6570\u5360 2 \u5b57\u8282\uff0c\u5171 6 \u4e2a\u5b57\u8282"),(0,i.kt)("li",{parentName:"ul"},"\u82e5\u5411\u5176\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u6570\u5b57: 50000\uff0c\u8fd9\u4e2a\u6570\u5b57\u8d85\u51fa\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"int16_t"),"\u7684\u8303\u56f4\uff0cintset \u4f1a\u81ea\u52a8\u5347\u7ea7\u7f16\u7801\u65b9\u5f0f\u5230\u5408\u9002\u7684\u5927\u5c0f\uff0c\u5347\u7ea7\u6d41\u7a0b\u4e3a\uff1a",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u5347\u7ea7\u7f16\u7801\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"INTSET_ENC_INT32"),"\uff0c\u6bcf\u4e2a\u6574\u6570\u5360 4 \u5b57\u8282\uff0c\u5e76\u6309\u7167\u65b0\u7684\u7f16\u7801\u65b9\u5f0f\u53ca\u5143\u7d20\u4e2a\u6570\u6269\u5bb9\u6570\u7ec4\uff0c\u6269\u5bb9\u523016 \u4e2a\u5b57\u8282"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u5012\u5e8f"),"\u4f9d\u6b21\u5c06\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u62f7\u8d1d\u5230\u6269\u5bb9\u540e\u7684\u6b63\u786e\u4f4d\u7f6e\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u5012\u5e8f"),"\u7684\u76ee\u7684\u662f\u89e3\u51b3\u6269\u5bb9\u65f6\u8986\u76d6\u5176\u4ed6\u5143\u7d20\u7684\u5185\u5b58"),(0,i.kt)("li",{parentName:"ol"},"\u5c06\u5f85\u6dfb\u52a0\u7684\u5143\u7d20\u653e\u5165\u6570\u7ec4\u672b\u5c3e"),(0,i.kt)("li",{parentName:"ol"},"\u6700\u540e\uff0c\u5c06 inset \u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"encoding")," \u5c5e\u6027\u6539\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"INTSET_ENC_INT32"),"\uff0c\u5c06 length \u5c5e\u6027\u6539\u4e3a 4"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Intset \u53ef\u4ee5\u770b\u505a\u662f",(0,i.kt)("strong",{parentName:"p"},"\u7279\u6b8a\u7684\u6574\u6570\u6570\u7ec4"),"\uff0c\u5177\u5907\u4e00\u4e9b\u7279\u70b9"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Redis \u4f1a\u786e\u4fdd Intset \u4e2d\u7684\u5143\u7d20",(0,i.kt)("strong",{parentName:"li"},"\u552f\u4e00"),"\u3001",(0,i.kt)("strong",{parentName:"li"},"\u6709\u5e8f")),(0,i.kt)("li",{parentName:"ol"},"\u5177\u5907\u7c7b\u578b\u5347\u7ea7\u673a\u5236\uff0c\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4"),(0,i.kt)("li",{parentName:"ol"},"\u5e95\u5c42\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u65b9\u5f0f\u6765\u67e5\u8be2")))),(0,i.kt)("h3",{id:"dict"},"Dict"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u672c\u8eab\u662f\u4e00\u4e2a",(0,i.kt)("strong",{parentName:"p"},"\u952e\u503c\u578b"),"(Key-Value Pair)\u7684\u6570\u636e\u5e93\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u952e\u5b9e\u73b0\u5feb\u901f\u7684\u589e\u5220\u6539\u67e5\u3002\u800c\u952e\u4e0e\u503c\u7684\u6620\u5c04\u5173\u7cfb\u6b63\u662f\u901a\u8fc7 ",(0,i.kt)("strong",{parentName:"p"},"Dict")," \u6765\u5b9e\u73b0\u7684")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dict \u7531\u4e09\u90e8\u5206\u7ec4\u6210\uff0c\u5206\u522b\u662f: ",(0,i.kt)("strong",{parentName:"p"},"\u54c8\u5e0c\u8868(DictHashTable)"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u54c8\u5e0c\u8282\u70b9(DictEntry)"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u5b57\u5178(Dict)")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7ed3\u6784\u5b9a\u4e49\u5728",(0,i.kt)("inlineCode",{parentName:"p"},"dict.h")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"typedef struct dictEntry {\n    // \u952e\n    void *key;\n    // \u503c\n    union {\n        void *val;\n        uint64_t u64;\n        int64_t s64;\n        double d;\n    } v;\n    // \u6307\u5411\u4e0b\u4e00\u4e2a Entry \u7684\u6307\u9488\n    struct dictEntry *next;\n} dictEntry;\n\n/* This is our hash table structure. Every dictionary has two of this as we\n * implement incremental rehashing, for the old to the new table. */\ntypedef struct dictht {\n    // Entry \u6570\u7ec4,\u6570\u7ec4\u4e2d\u4fdd\u5b58\u7684\u662f\u6307\u5411 Entry \u7ed3\u6784\u7684\u6307\u9488\n    dictEntry **table;\n    // \u54c8\u5e0c\u8868\u5927\u5c0f\n    unsigned long size;\n    // \u54c8\u5e0c\u8868\u5927\u5c0f\u7684\u63a9\u7801\uff0c\u603b\u7b49\u4e8e size-1\uff0c\u7528\u4e8e\u8ba1\u7b97\u5143\u7d20\u5b58\u653e\u4f4d\u7f6e\n    unsigned long sizemask;\n    // Entry \u4e2a\u6570\n    unsigned long used;\n} dictht;\n\ntypedef struct dict {\n    // dict \u7c7b\u578b\uff0c\u5185\u7f6e\u4e0d\u540c\u7684 hash \u51fd\u6570\n    dictType *type;\n    // \u79c1\u6709\u6570\u636e\uff0c\u5728\u505a\u7279\u6b8a hash \u8fd0\u7b97\u65f6\u7528\n    void *privdata;\n    // \u4e00\u4e2a Dict \u5305\u542b\u4e24\u4e2a\u54c8\u5e0c\u8868\uff0c\u5176\u4e2d\u4e00\u4e2a\u662f\u5f53\u524d\u6570\u636e\uff0c\u53e6\u4e00\u4e2a\u4e00\u822c\u662f\u7a7a\uff0crehash \u65f6\u4f7f\u7528\n    dictht ht[2];\n    // rehash \u7684\u8fdb\u5ea6\uff0c-1 \u8868\u793a\u672a\u8fdb\u884c\n    long rehashidx; /* rehashing not in progress if rehashidx == -1 */\n    // rehash \u662f\u5426\u6682\u505c\uff0c1 \u5219\u6682\u505c\uff0c0 \u5219\u7ee7\u7eed\n    int16_t pauserehash; /* If >0 rehashing is paused (<0 indicates coding error) */\n} dict;\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53\u5411 Dict \u6dfb\u52a0\u952e\u503c\u5bf9\u65f6\uff0cRedis \u9996\u5148\u6839\u636e key \u8ba1\u7b97\u51fa hash \u503c(h)\uff0c\u7136\u540e\u5229\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"h & sizemask")," \u6765\u8ba1\u7b97\u5143\u7d20\u5e94\u8be5\u5b58\u50a8\u5230\u6570\u7ec4\u4e2d\u7684\u54ea\u4e2a\u7d22\u5f15\u4f4d\u7f6e"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e3a\u4ec0\u4e48\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"h & sizemask")," \u8ba1\u7b97\u5b58\u50a8\u7684\u4f4d\u7f6e\uff1f"),(0,i.kt)("blockquote",{parentName:"li"},(0,i.kt)("p",{parentName:"blockquote"}," \u9996\u5148 ",(0,i.kt)("inlineCode",{parentName:"p"},"dictht")," \u4e2d\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"size = 2 \u7684 n \u6b21\u65b9"),"  \uff0c\u53c8\u56e0\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"sizemask = size - 1"),"\uff0c\u6240\u4ee5  ",(0,i.kt)("inlineCode",{parentName:"p"},"sizemask = 2 \u7684 n \u6b21\u65b9 - 1")),(0,i.kt)("p",{parentName:"blockquote"},"\u56e0\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"sizemask")," \u8f6c\u4e3a 2 \u8fdb\u5236\u4e00\u5171\u6709 n \u4f4d\uff0c\u4e14\u5168\u4e3a 1\uff0c\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"hash & sizemask")," \u8ba1\u7b97\u7684\u5230\u7684\u503c\u4e00\u5b9a\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"0 ~ 2 \u7684 n \u6b21\u65b9 - 1")," \u7684\u8303\u56f4\uff0c\u5b9e\u9645\u4e0a\u5c31\u7b49\u540c\u4e8e\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"hash % size")," \u7684\u6548\u679c\uff0c\u4f46\u662f\u4f7f\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"h & sizemask")," \u7531\u4e8e\u662f\u901a\u8fc7\u4f4d\u8fd0\u7b97\uff0c\u6548\u7387\u66f4\u9ad8"),(0,i.kt)("p",{parentName:"blockquote"},"\u7c7b\u4f3c ",(0,i.kt)("inlineCode",{parentName:"p"},"HashMap")," \u7684\u8ba1\u7b97 hash \u4f4d\u7f6e"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dict \u91c7\u7528",(0,i.kt)("strong",{parentName:"p"},"\u5934\u63d2\u6cd5"),"\u63d2\u5165\u540c\u4e00\u4e2a\u5b58\u50a8\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u7531\u4e8e Redis \u662f\u5355\u7ebf\u7a0b\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898"))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240720092327897",src:n(75322).Z,width:"1486",height:"549"})))),(0,i.kt)("h4",{id:"dict-\u7684\u6269\u5bb9"},"Dict \u7684\u6269\u5bb9"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dict \u4e2d\u7684 HashTable \u5c31\u662f\u6570\u7ec4\u7ed3\u5408\u5355\u5411\u94fe\u8868\u7684\u5b9e\u73b0\uff0c\u5f53\u96c6\u5408\u4e2d\u5143\u7d20\u8f83\u591a\u65f6\uff0c\u5fc5\u7136\u5bfc\u81f4\u54c8\u5e0c\u51b2\u7a81\u589e\u591a\uff0c\u94fe\u8868\u8fc7\u957f\uff0c\u5219\u67e5\u8be2\n\u6548\u7387\u4f1a\u5927\u5927\u964d\u4f4e")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Dict \u5728\u6bcf\u6b21\u65b0\u589e\u952e\u503c\u5bf9\u65f6\u90fd\u4f1a\u68c0\u67e5",(0,i.kt)("strong",{parentName:"p"},"\u8d1f\u8f7d\u56e0\u5b50"),"(",(0,i.kt)("inlineCode",{parentName:"p"},"LoadFactor = used/size"),")\uff0c\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u65f6\u4f1a\u89e6\u53d1",(0,i.kt)("strong",{parentName:"p"},"\u54c8\u5e0c\u8868\u6269\u5bb9"),":"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u54c8\u5e0c\u8868\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadFactor >= 1"),"\uff0c\u5e76\u4e14\u670d\u52a1\u5668\u6ca1\u6709\u6267\u884c ",(0,i.kt)("inlineCode",{parentName:"li"},"BGSAVE")," \u6216\u8005 ",(0,i.kt)("inlineCode",{parentName:"li"},"BGREWRITEAOF")," \u7b49\u540e\u53f0\u8fdb\u7a0b"),(0,i.kt)("li",{parentName:"ol"},"\u54c8\u5e0c\u8868\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"LoadFactor > 5"),";")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"dict.c")," \u6e90\u7801\u53c2\u8003"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},'/* Expand the hash table if needed */\nstatic int _dictExpandIfNeeded(dict *d)\n{\n    /* Incremental rehashing already in progress. Return. */\n    // \u5982\u679c\u6b63\u5728rehash\uff0c\u5219\u8fd4\u56deok\n    if (dictIsRehashing(d)) return DICT_OK;\n\n\n    /* If the hash table is empty expand it to the initial size. */\n    // \u5982\u679c\u54c8\u5e0c\u8868\u4e3a\u7a7a\uff0c\u5219\u521d\u59cb\u5316\u54c8\u5e0c\u8868\u4e3a\u9ed8\u8ba4\u5927\u5c0f:4\n    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);\n\n\n    /* If we reached the 1:1 ratio, and we are allowed to resize the hash\n     * table (global setting) or we should avoid it but the ratio between\n     * elements/buckets is over the "safe" threshold, we resize doubling\n     * the number of buckets. */\n    /* \u5f53\u8d1f\u8f7d\u56e0\u5b50(used/size)\u8fbe\u52301\u4ee5\u4e0a\uff0c\u5e76\u4e14\u5f53\u524d\u6ca1\u6709\u8fdb\u884c bgrewrite \u7b49\u5b50\u8fdb\u7a0b\u64cd\u4f5c\n     * \u6216\u8005\u8d1f\u8f7d\u56e0\u5b50\u8d85\u8fc75\uff0c\u5219\u8fdb\u884c dictExpand \uff0c\u4e5f\u5c31\u662f\u6269\u5bb9 */\n    if (!dictTypeExpandAllowed(d))\n        return DICT_OK;\n    if ((dict_can_resize == DICT_RESIZE_ENABLE &&\n         d->ht[0].used >= d->ht[0].size) ||\n        (dict_can_resize != DICT_RESIZE_FORBID &&\n         d->ht[0].used / d->ht[0].size > dict_force_resize_ratio))\n    {\n        //\u6269\u5bb9\u5927\u5c0f\u4e3a used + 1, \u5e95\u5c42\u4f1a\u5bf9\u6269\u5bb9\u5927\u5c0f\u505a\u5224\u65ad\uff0c\u5b9e\u9645\u4e0a\u6269\u5bb9\u5230\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e used + 1 \u7684 2^n\n        return dictExpand(d, d->ht[0].used + 1);\n    }\n    return DICT_OK;\n}\n')))),(0,i.kt)("h4",{id:"dict-\u7684\u6536\u7f29"},"Dict \u7684\u6536\u7f29"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6bcf\u6b21\u5220\u9664\u5143\u7d20\u65f6\uff0c\u4e5f\u4f1a\u5bf9\u8d1f\u8f7d\u56e0\u5b50\u505a\u68c0\u67e5\uff0c\u5f53 ",(0,i.kt)("inlineCode",{parentName:"p"},"LoadFactor<0.1")," \u65f6\uff0c\u4f1a\u505a\u54c8\u5e0c\u8868\u6536\u7f29:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"t_hash.h")," \u6e90\u7801\u67e5\u770b"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},'/* Delete an element from a hash.\n * Return 1 on deleted and 0 on not found. */\nint hashTypeDelete(robj *o, sds field) {\n    int deleted = 0;\n\n    if (o->encoding == OBJ_ENCODING_ZIPLIST) {\n        unsigned char *zl, *fptr;\n\n        zl = o->ptr;\n        fptr = ziplistIndex(zl, ZIPLIST_HEAD);\n        if (fptr != NULL) {\n            fptr = ziplistFind(zl, fptr, (unsigned char*)field, sdslen(field), 1);\n            if (fptr != NULL) {\n                zl = ziplistDelete(zl,&fptr); /* Delete the key. */\n                zl = ziplistDelete(zl,&fptr); /* Delete the value. */\n                o->ptr = zl;\n                deleted = 1;\n            }\n        }\n    } else if (o->encoding == OBJ_ENCODING_HT) {\n        //  Dict \u7684\u6536\u7f29\u903b\u8f91\n        if (dictDelete((dict*)o->ptr, field) == C_OK) {\n            deleted = 1;\n            //\u5220\u9664\u6210\u529f\u540e\uff0c\u68c0\u67e5\u662f\u5426\u9700\u8981\u91cd\u7f6e Dict \u5927\u5c0f\uff0c\u5982\u679c\u9700\u8981\u5219\u8c03\u7528 dictResize \u91cd\u7f6e\n            /* Always check if the dictionary needs a resize after a delete. */\n            if (htNeedsResize(o->ptr)) dictResize(o->ptr);\n        }\n\n    } else {\n        serverPanic("Unknown hash encoding");\n    }\n    return deleted;\n}\n')),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"server.h")," \u6e90\u7801\u67e5\u770b"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"int htNeedsResize(dict *dict) {\n    long long size, used;\n    // \u54c8\u5e0c\u8868\u5927\u5c0f\n    size = dictSlots(dict);\n    // entry \u6570\u91cf\n    used = dictSize(dict);\n    // size > 4(\u54c8\u5e0c\u8868\u521d\u8bc6\u5927\u5c0f) \u5e76\u4e14 \u8d1f\u8f7d\u56e0\u5b50 < 0.1\n    return (size > DICT_HT_INITIAL_SIZE &&\n            (used*100/size < HASHTABLE_MIN_FILL));// \u6b64\u5904 HASHTABLE_MIN_FILL = 10\n}\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"dict.c")," \u6e90\u7801\u53c2\u8003"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/* Resize the table to the minimal size that contains all the elements,\n * but with the invariant of a USED/BUCKETS ratio near to <= 1 */\nint dictResize(dict *d)\n{\n    unsigned long minimal;\n    // \u5982\u679c\u6b63\u5728\u505a bgsave \u6216 bgrewriteof \u6216 rehash\uff0c\u5219\u8fd4\u56de\u9519\u8bef\n    if (dict_can_resize != DICT_RESIZE_ENABLE || dictIsRehashing(d)) return DICT_ERR;\n    // \u83b7\u53d6 used\uff0c\u4e5f\u5c31\u662f entry \u4e2a\u6570\n    minimal = d->ht[0].used;\n    // \u5982\u679c used \u5c0f\u4e8e 4\uff0c\u5219\u91cd\u7f6e\u4e3a 4\n    if (minimal < DICT_HT_INITIAL_SIZE)\n        minimal = DICT_HT_INITIAL_SIZE;\n    //\u91cd\u7f6e\u5927\u5c0f\u4e3a minimal\uff0c\u5b9e\u9645\u4e0a\u662f\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e minimal \u7684 2^n\n    return dictExpand(d, minimal);\n}\n\n/* return DICT_ERR if expand was not performed */\nint dictExpand(dict *d, unsigned long size) {\n    return _dictExpand(d, size, NULL);\n}\n\n/* Expand or create the hash table,\n * when malloc_failed is non-NULL, it'll avoid panic if malloc fails (in which case it'll be set to 1).\n * Returns DICT_OK if expand was performed, and DICT_ERR if skipped. */\nint _dictExpand(dict *d, unsigned long size, int* malloc_failed)\n{\n    if (malloc_failed) *malloc_failed = 0;\n\n    /* the size is invalid if it is smaller than the number of\n     * elements already inside the hash table */\n    // \u5982\u679c\u5f53\u524d entry \u6570\u91cf\u8d85\u8fc7\u4e86\u8981\u7533\u8bf7\u7684 size \u5927\u5c0f\uff0c\u6216\u8005\u6b63\u5728 rehash\uff0c\u76f4\u63a5\u62a5\u9519\n    if (dictIsRehashing(d) || d->ht[0].used > size)\n        return DICT_ERR;\n\n    // \u58f0\u660e\u65b0\u7684 hash table\n    dictht n; /* the new hash table */\n    // \u5b9e\u9645\u5927\u5c0f\uff0c\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u4f20\u5165\u7684 size \u7684 2^n \u6b21\u65b9\n    unsigned long realsize = _dictNextPower(size);\n\n    /* Detect overflows */\n    // \u8d85\u51fa LONG MAX\uff0c\u8bf4\u660e\u5185\u5b58\u6ea2\u51fa\uff0c\u62a5\u9519\n    if (realsize < size || realsize * sizeof(dictEntry*) < realsize)\n        return DICT_ERR;\n\n    /* Rehashing to the same table size is not useful. */\n    // \u65b0\u7684 size \u5982\u679c\u4e0e\u65e7\u7684\u4e00\u81f4\uff0c\u62a5\u9519\n    if (realsize == d->ht[0].size) return DICT_ERR;\n\n    /* Allocate the new hash table and initialize all pointers to NULL */\n    // \u91cd\u7f6e\u65b0\u7684 hash table \u5927\u5c0f\u548c\u63a9\u7801\n    n.size = realsize;\n    n.sizemask = realsize-1;\n    if (malloc_failed) {\n        n.table = ztrycalloc(realsize*sizeof(dictEntry*));\n        *malloc_failed = n.table == NULL;\n        if (*malloc_failed)\n            return DICT_ERR;\n    } else\n        // \u5206\u914d\u5185\u5b58: size * entrySize\n        n.table = zcalloc(realsize*sizeof(dictEntry*));\n    // \u5df2\u4f7f\u7528\u521d\u59cb\u5316\u4e3a 0\n    n.used = 0;\n\n    /* Is this the first initialization? If so it's not really a rehashing\n     * we just set the first hash table so that it can accept keys. */\n    // \u5982\u679c\u662f\u7b2c\u4e00\u6b21\uff0c\u5219\u76f4\u63a5\u628a n \u8d4b\u503c\u7ed9 ht[0] \u5373\u53ef\n    if (d->ht[0].table == NULL) {\n        d->ht[0] = n;\n        return DICT_OK;\n    }\n    \n    /* Prepare a second hash table for incremental rehashing */\n    //\u5426\u5219\uff0c\u9700\u8981 rehash\uff0c\u6b64\u5904\u53ea\u9700\u8981\u628a rehashidx \u7f6e\u4e3a 0 \u5373\u53ef\u3002\u5728\u6bcf\u6b21\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u65f6\u90fd\u4f1a\u89e6\u53d1 rehash\n    d->ht[1] = n;\n    d->rehashidx = 0;\n    return DICT_OK;\n}\n")))),(0,i.kt)("h4",{id:"dict-\u7684-rehash"},"Dict \u7684 rehash"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u7ba1\u662f\u6269\u5bb9\u8fd8\u662f\u6536\u7f29\uff0c\u5fc5\u5b9a\u4f1a\u521b\u5efa\u65b0\u7684\u54c8\u5e0c\u8868\uff0c\u5bfc\u81f4\u54c8\u5e0c\u8868\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"size")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"sizemask")," \u53d8\u5316\uff0c\u800c ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," \u7684\u67e5\u8be2\u4e0e ",(0,i.kt)("inlineCode",{parentName:"li"},"sizemask")," \u6709\u5173\u3002\u56e0\u6b64\u5fc5\u987b\u5bf9\u54c8\u5e0c\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"key")," \u91cd\u65b0\u8ba1\u7b97\u7d22\u5f15\uff0c\u63d2\u5165\u65b0\u7684\u54c8\u5e0c\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"rehash"),"\u3002"),(0,i.kt)("li",{parentName:"ul"},"Dict \u7684 rehash \u5e76\u4e0d\u662f\u4e00\u6b21\u6027\u5b8c\u6210\u7684\u3002\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c Dict \u4e2d\u5305\u542b\u6570\u767e\u4e07\u7684 entry\uff0c\u8981\u5728\u4e00\u6b21 rehash \u5b8c\u6210\uff0c\u6781\u6709\u53ef\u80fd",(0,i.kt)("strong",{parentName:"li"},"\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u963b\u585e"),"\u3002\u56e0\u6b64 Dict \u7684 rehash \u662f",(0,i.kt)("strong",{parentName:"li"},"\u5206\u591a\u6b21"),"\u3001",(0,i.kt)("strong",{parentName:"li"},"\u6e10\u8fdb\u5f0f"),"\u7684\u5b8c\u6210\uff0c\u56e0\u6b64\u79f0\u4e3a",(0,i.kt)("strong",{parentName:"li"},"\u6e10\u8fdb\u5f0f rehash")),(0,i.kt)("li",{parentName:"ul"},"\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u8ba1\u7b97\u65b0 hash \u8868\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"realeSize"),"\uff0c\u503c\u53d6\u51b3\u4e8e\u5f53\u524d\u8981\u505a\u7684\u662f\u6269\u5bb9\u8fd8\u662f\u6536\u7f29",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u662f\u6269\u5bb9\uff0c\u5219\u65b0 ",(0,i.kt)("inlineCode",{parentName:"li"},"size")," \u4e3a\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0].used+1"),"\u7684 2^n"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u662f\u6536\u7f29\uff0c\u5219\u65b0 ",(0,i.kt)("inlineCode",{parentName:"li"},"size")," \u4e3a\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0].used")," \u7684 2^n (\u4e0d\u5f97\u5c0f\u4e8e4)"))),(0,i.kt)("li",{parentName:"ol"},"\u6309\u7167\u65b0\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"realeSize")," \u7533\u8bf7\u5185\u5b58\u7a7a\u95f4\uff0c\u521b\u5efa\u65b0\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"dictht"),"\uff0c\u5e76\u8d4b\u503c\u7ed9\u5f53\u524d ",(0,i.kt)("inlineCode",{parentName:"li"},"dict")," \u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]")),(0,i.kt)("li",{parentName:"ol"},"\u8bbe\u7f6e ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.rehashidx=0"),"\uff0c\u6807\u793a\u5f00\u59cb rehash\uff0c\u5728\u6bcf\u6b21\u589e\u3001\u5220\u3001\u6539\u3001\u67e5\u65f6\u90fd\u4f1a\u89e6\u53d1 rehash"),(0,i.kt)("li",{parentName:"ol"},"\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0]")," \u4e2d\u7684\u6bcf\u4e00\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"dictEntry")," \u90fd",(0,i.kt)("strong",{parentName:"li"},"\u6e10\u8fdb\u5f0f rehash")," \u5230 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6bcf\u6b21\u6267\u884c\u65b0\u589e\u3001\u67e5\u8be2\u3001\u4fee\u6539\u3001\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u90fd\u68c0\u67fb\u4e00\u4e0b ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.rehashidx")," \u662f\u5426\u5927\u4e8e -1\u5982\u679c\u662f\u5219\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0].table[rehashidx] \u7684 entny \u94fe\u8868 rehash \u5230dict.ht[1]"),"\uff0c\u5e76\u4e14\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"rehashidx++"),"\u3002\u76f4\u81f3",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0]")," \u7684\u6240\u6709\u6570\u636e\u90fd rehash \u5230 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]")),(0,i.kt)("li",{parentName:"ul"},"\u5728 rehash \u8fc7\u7a0b\u4e2d\uff0c\u65b0\u589e\u64cd\u4f5c\uff0c\u5219\u76f4\u63a5\u5199\u5165 ",(0,i.kt)("inlineCode",{parentName:"li"},"ht[1]"),"\uff0c\u67e5\u8be2\u3001\u4fee\u6539\u548c\u5220\u9664\u5219\u4f1a\u5728 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0]")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]")," \u4f9d\u6b21\u67e5\u627e\u5e76\u6267\u884c\u3002\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd ",(0,i.kt)("inlineCode",{parentName:"li"},"ht[0]")," \u7684\u6570\u636e\u53ea\u51cf\u4e0d\u589e\uff0c\u968f\u7740 rehash \u6700\u7ec8\u4e3a\u7a7a"))),(0,i.kt)("li",{parentName:"ol"},"\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]")," \u8d4b\u503c\u7ed9 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0]"),"\uff0c\u7ed9 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[1]")," \u521d\u59cb\u5316\u4e3a\u7a7a\u54c8\u5e0c\u8868\uff0c\u91ca\u653e\u539f\u6765\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"dict.ht[0]")," \u7684\u5185\u5b58"),(0,i.kt)("li",{parentName:"ol"},"\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"rehashidx")," \u8d4b\u503c\u4e3a -1\uff0c\u4ee3\u8868 rehash \u7ed3\u675f")))),(0,i.kt)("h3",{id:"ziplist"},"ZipList"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ZipList \u662f\u4e00\u79cd\u7279\u6b8a\u7684\u201c\u53cc\u7aef\u94fe\u8868\u201d\uff0c\u7531\u4e00\u7cfb\u5217",(0,i.kt)("strong",{parentName:"p"},"\u7279\u6b8a\u7f16\u7801"),"\u7684",(0,i.kt)("strong",{parentName:"p"},"\u8fde\u7eed\u5185\u5b58\u5757"),"\u7ec4\u6210\u3002\u53ef\u4ee5\u5728",(0,i.kt)("strong",{parentName:"p"},"\u4efb\u610f\u4e00\u7aef\u8fdb\u884c\u538b\u5165/\u5f39\u51fa\u64cd\u4f5c"),"\uff0c\u5e76\u4e14\u8be5\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"0(1)")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5185\u5b58\u7ed3\u6784\u56fe")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240721080636696",src:n(38078).Z,width:"1249",height:"505"})),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"\u5c5e\u6027"),(0,i.kt)("th",{parentName:"tr",align:null},"\u7c7b\u578b"),(0,i.kt)("th",{parentName:"tr",align:"left"},"\u957f\u5ea6"),(0,i.kt)("th",{parentName:"tr",align:null},"\u7528\u9014"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"zlbytes"),(0,i.kt)("td",{parentName:"tr",align:null},"uint32_t"),(0,i.kt)("td",{parentName:"tr",align:"left"},"4 \u5b57\u8282"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8bb0\u5f55\u6574\u4e2a\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u5b57\u8282\u6570")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"zltail"),(0,i.kt)("td",{parentName:"tr",align:null},"uint32_t"),(0,i.kt)("td",{parentName:"tr",align:"left"},"4 \u5b57\u8282"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8bb0\u5f55\u538b\u7f29\u5217\u8868\u8868\u5c3e\u8282\u70b9\u8ddd\u79bb\u538b\u7f29\u5217\u8868\u7684\u8d77\u59cb\u5730\u5740\u6709\u591a\u5c11\u5b57\u8282\uff0c\u901a\u8fc7\u8fd9\u4e2a\u504f\u79fb\u91cf\uff0c\u53ef\u4ee5\u786e\u5b9a\u8868\u5c3e\u8282\u70b9\u7684\u5730\u5740")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"zllen"),(0,i.kt)("td",{parentName:"tr",align:null},"uint16_t"),(0,i.kt)("td",{parentName:"tr",align:"left"},"2 \u5b57\u8282"),(0,i.kt)("td",{parentName:"tr",align:null},"\u8bb0\u5f55\u4e86\u538b\u7f29\u5217\u8868\u5305\u542b\u7684\u8282\u70b9\u6570\u91cf\u3002\u6700\u5927\u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"td"},"UINT16_MAX"),"(65534)\uff0c\u5982\u679c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u6b64\u5904\u4f1a\u8bb0\u5f55\u4e3a 65535\uff0c\u4f46\u8282\u70b9\u7684\u771f\u5b9e\u6570\u91cf\u9700\u8981\u904d\u5386\u6574\u4e2a\u538b\u7f29\u5217\u8868\u624d\u80fd\u8ba1\u7b97\u5f97\u51fa")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"entry"),(0,i.kt)("td",{parentName:"tr",align:null},"\u5217\u8868\u8282\u70b9"),(0,i.kt)("td",{parentName:"tr",align:"left"},"\u4e0d\u5b9a"),(0,i.kt)("td",{parentName:"tr",align:null},"\u538b\u7f29\u5217\u8868\u5305\u542b\u7684\u5404\u4e2a\u8282\u70b9\uff0c\u8282\u70b9\u7684\u957f\u5ea6\u7531\u8282\u70b9\u4fdd\u5b58\u7684\u5185\u5bb9\u51b3\u5b9a")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"zlend"),(0,i.kt)("td",{parentName:"tr",align:null},"uint8_t"),(0,i.kt)("td",{parentName:"tr",align:"left"},"1 \u5b57\u8282"),(0,i.kt)("td",{parentName:"tr",align:null},"\u7279\u6b8a\u503c ",(0,i.kt)("inlineCode",{parentName:"td"},"0xFF"),"(\u5341\u8fdb\u5236 255)\uff0c\u7528\u4e8e\u6807\u8bb0\u538b\u7f29\u5217\u8868\u7684\u672b\u7aef")))))),(0,i.kt)("h4",{id:"ziplist-\u4e2d\u7684-entry"},"ZipList \u4e2d\u7684 Entry"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ZipList \u4e2d\u7684 Entry \u5e76\u4e0d\u50cf\u666e\u901a\u94fe\u8868\u90a3\u6837\u8bb0\u5f55\u524d\u540e\u8282\u70b9\u7684\u6307\u9488\uff0c\u56e0\u4e3a\u8bb0\u5f55\u4e24\u4e2a\u6307\u9488\u8981\u5360\u7528 16 \u4e2a\u5b57\u8282\uff0c\u6d6a\u8d39\u5185\u5b58\u3002\u800c\u662f\u91c7\u7528\n\u4e86\u4e0b\u9762\u7684\u7ed3\u6784:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240721081811431",src:n(32904).Z,width:"740",height:"72"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"previous_entry_length"),": \u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u5360 1 \u4e2a\u6216 5 \u4e2a\u5b57\u8282",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u5219\u91c7\u7528 1 \u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e 254 \u5b57\u8282\uff0c\u5219\u91c7\u7528 5 \u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"0xfe"),"\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u624d\u662f\u771f\u5b9e\u957f\u5ea6\u6570\u636e"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"encoding"),": \u7f16\u7801\u5c5e\u6027\uff0c\u8bb0\u5f55 ",(0,i.kt)("inlineCode",{parentName:"li"},"content")," \u7684\u6570\u636e\u7c7b\u578b(\u5b57\u7b26\u4e32\u8fd8\u662f\u6574\u6570)\u4ee5\u53ca\u957f\u5ea6\uff0c\u5360\u7528 1 \u4e2a\u30012 \u4e2a\u6216 5 \u4e2a\u5b57\u8282"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"content"),": \u8d1f\u8d23\u4fdd\u5b58\u8282\u70b9\u7684\u6570\u636e\uff0c\u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u6216\u6574\u6570"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Entry \u8fd9\u6837\u8bbe\u8ba1\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5185\u5b58\u7684\u8ba1\u7b97\u7b97\u51fa\u5f53\u524d\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5",(0,i.kt)("strong",{parentName:"p"},"\u6839\u636e\u5f53\u524d\u8282\u70b9\u5730\u5740\u548c\u5f53\u524d\u8282\u70b9\u957f\u5ea6\u8ba1\u7b97\u51fa\u4e0b\u4e00\u4e2a\u8282\u70b9\u5730\u5740"),"\u5b9e\u73b0\u6b63\u5e8f\u904d\u5386\uff0c\u53ef\u4ee5",(0,i.kt)("strong",{parentName:"p"},"\u6839\u636e\u5f53\u524d\u8282\u70b9\u548c",(0,i.kt)("inlineCode",{parentName:"strong"},"previous_entry_length")," \u8ba1\u7b97\u51fa\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u5730\u5740"),"\u5b9e\u73b0\u9006\u5e8f\u904d\u5386"))),(0,i.kt)("h4",{id:"ziplist-entry-\u4e2d\u7684-encoding-\u7f16\u7801"},"ZipList Entry \u4e2d\u7684 encoding \u7f16\u7801"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Entry \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding")," \u7f16\u7801\u5206\u4e3a",(0,i.kt)("strong",{parentName:"p"},"\u5b57\u7b26\u4e32"),"\u548c",(0,i.kt)("strong",{parentName:"p"},"\u6574\u6570"),"\u4e24\u79cd\uff0c\u7528\u524d\u4e24\u4f4d\u4e8c\u8fdb\u5236\u533a\u5206"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5b57\u7b26\u4e32"),": \u5982\u679c ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding"),"\u662f\u4ee5",(0,i.kt)("inlineCode",{parentName:"p"},"00"),"\u3001",(0,i.kt)("inlineCode",{parentName:"p"},"01"),"\u6216\u8005",(0,i.kt)("inlineCode",{parentName:"p"},"10"),"\u5f00\u5934\uff0c\u5219\u8bc1\u660e ",(0,i.kt)("inlineCode",{parentName:"p"},"content")," \u662f\u5b57\u7b26\u4e32"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"encoding \u7f16\u7801\u4e8c\u8fdb\u5236\u793a\u4f8b"),(0,i.kt)("th",{parentName:"tr",align:null},"\u7f16\u7801\u957f\u5ea6"),(0,i.kt)("th",{parentName:"tr",align:null},"\u5b57\u7b26\u4e32\u5927\u5c0f"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"|","00pppppp","|"),(0,i.kt)("td",{parentName:"tr",align:null},"1bytes"),(0,i.kt)("td",{parentName:"tr",align:null},"<= 63 bytes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"|","01pppppp","|","qqqqqqqq","|"),(0,i.kt)("td",{parentName:"tr",align:null},"2 bytes"),(0,i.kt)("td",{parentName:"tr",align:null},"<= 16383 bytes")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"|","10000000","|","qqqqqqqq","|","rrrrrrrr","|","ssssssss","|","tttttttt","|"),(0,i.kt)("td",{parentName:"tr",align:null},"5 bytes"),(0,i.kt)("td",{parentName:"tr",align:null},"<= 4294967295 bytes")))),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0c\u4fdd\u5b58\u5b57\u7b26\u4e32 \u201cab\u201d \u548c \u201cbc\u201c"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240721104050853",src:n(93577).Z,width:"1294",height:"207"}))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6574\u6570"),": \u5982\u679c ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding")," \u662f\u4ee5 ",(0,i.kt)("inlineCode",{parentName:"p"},"11")," \u5f00\u59cb\uff0c\u5219\u8bc1\u660e ",(0,i.kt)("inlineCode",{parentName:"p"},"content")," \u662f\u6574\u6570\uff0c\u4e14 ",(0,i.kt)("inlineCode",{parentName:"p"},"encoding")," \u56fa\u5b9a\u53ea\u5360\u7528 1 \u4e2a\u5b57\u8282"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"encoding \u7f16\u7801\u4e8c\u8fdb\u5236\u793a\u4f8b"),(0,i.kt)("th",{parentName:"tr",align:null},"\u7f16\u7801\u957f\u5ea6"),(0,i.kt)("th",{parentName:"tr",align:null},"\u6574\u6570\u7c7b\u578b"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"11000000"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"int16_t(2 bytes)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"11010000"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"int32_t(4 bytes)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"11100000"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"int64 t(8 bytes)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"11110000"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"24 \u4f4d\u6709\u7b26\u6574\u6570(3 bytes)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"11111110"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"8 \u4f4d\u6709\u7b26\u6574\u6570(1 bytes)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"1111xxxx"),(0,i.kt)("td",{parentName:"tr",align:null},"1"),(0,i.kt)("td",{parentName:"tr",align:null},"\u76f4\u63a5\u5728 xxxx \u4f4d\u7f6e\u4fdd\u5b58\u6570\u503c\uff0c\u8303\u56f4\u4ece0001~1101\uff0c\u51cf 1 \u540e\u7ed3\u679c\u4e3a\u5b9e\u9645\u503c")))),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f8b\u5982\uff0cZipList\u4e2d\u4fdd\u5b58\u4e24\u4e2a\u6574\u6570\u503c: 2 \u548c 5"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240723115727308",src:n(24434).Z,width:"1057",height:"195"})))))))),(0,i.kt)("h4",{id:"ziplist-\u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898"},"ZipList \u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"ZipList \u7684\u6bcf\u4e2a Entry \u90fd\u5305\u542b ",(0,i.kt)("inlineCode",{parentName:"li"},"previous_entry_length")," \u6765\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\uff0c\u957f\u5ea6\u662f 1 \u4e2a\u6216 5 \u4e2a\u5b57\u8282:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u5219\u91c7\u7528 1 \u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u524d\u4e00\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e 254 \u5b57\u8282\uff0c\u5219\u91c7\u7528 5 \u4e2a\u5b57\u8282\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff0c\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e3a ",(0,i.kt)("inlineCode",{parentName:"li"},"0xfe"),"\uff0c\u540e\u56db\u4e2a\u5b57\u8282\u624d\u662f\u771f\n\u5b9e\u957f\u5ea6\u6570\u636e"))),(0,i.kt)("li",{parentName:"ul"},"\u8fde\u9501\u66f4\u65b0\u95ee\u9898",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5047\u8bbe\u6709 N \u4e2a\u8fde\u7eed\u7684\u3001\u957f\u5ea6\u4e3a 250~253 \u5b57\u8282\u4e4b\u95f4\u7684 entry\uff0c\u56e0\u6b64 entry \u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"previous_entry_length")," \u5c5e\u6027\u7528 1 \u4e2a\u5b57\u8282\u5373\u53ef\u3002\u6b64\u65f6\u5f80 ZipList \u4e2d\u63d2\u5165\u4e86\u4e00\u4e2a\u957f\u5ea6\u4e3a 254 \u5b57\u8282\u7684 entry \u5e76\u4e14\u63d2\u5165\u4f4d\u7f6e\u5728\u9996\u4f4d\uff0c\u7531\u4e8e\u8be5\u65b0 entry \u7684\u957f\u5ea6\u4e3a 254 \u5b57\u8282\uff0c\u56e0\u6b64\u8ddf\u5728\u540e\u9762\u7684\u65e7 entry \u672c\u6765\u7528 1 \u4e2a\u5b57\u8282\u8bb0\u5f55\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"previous_entry_length")," \u5c5e\u6027\u9700\u8981\u53d8\u4e3a 5\u4e2a\u5b57\u8282\uff0c\u5bfc\u81f4\u8fd9\u4e2a\u65e7 entry \u7684\u957f\u5ea6\u5c31\u4f1a\u5927\u4e8e\u7b49\u4e8e 254 \u5b57\u8282\uff0c\u4fc3\u4f7f\u540e\u9762 entry \u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"previous_entry_length")," \u5c5e\u6027\u9700\u8981\u7531 1 \u4e2a\u5b57\u8282\u53d8\u4e3a 5\u4e2a\u5b57\u8282\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8fd9 N \u4e2a\u8fde\u7eed\u7684\u8282\u70b9\u90fd\u9700\u8981\u8fdb\u884c\u6269\u5bb9"),(0,i.kt)("li",{parentName:"ul"},"ZipList \u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\u4ea7\u751f\u7684",(0,i.kt)("strong",{parentName:"li"},"\u8fde\u7eed\u591a\u6b21\u7a7a\u95f4\u6269\u5c55"),"\u64cd\u4f5c\u79f0\u4e4b\u4e3a",(0,i.kt)("strong",{parentName:"li"},"\u8fde\u9501\u66f4\u65b0"),"(Cascade Update)\u3002",(0,i.kt)("strong",{parentName:"li"},"\u65b0\u589e"),"\u3001",(0,i.kt)("strong",{parentName:"li"},"\u5220\u9664"),"\u90fd\u53ef\u80fd\u5bfc\u81f4\u8fde\u9501\u66f4\u65b0\u7684\u53d1\u751f",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u8fde\u7eed\u591a\u6b21\u7a7a\u95f4\u6269\u5c55"),"\u4f1a\u9891\u7e41\u5730\u7533\u8bf7\u5185\u5b58\u3001\u9500\u6bc1\u5185\u5b58\u3001\u6570\u636e\u7684\u8fc1\u79fb\uff0c\u8fd9\u4f1a\u6d89\u53ca\u5230\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6781\u5927\u5f71\u54cd\u6027\u80fd"),(0,i.kt)("li",{parentName:"ul"},"\u8fd9\u4e2a\u95ee\u9898\u53d1\u751f\u7684\u6761\u4ef6\u6bd4\u8f83\u82db\u523b\uff0c\u53d1\u751f\u6982\u7387\u6bd4\u8f83\u4f4e")))))),(0,i.kt)("h4",{id:"ziplist-\u7684\u7279\u6027"},"ZipList \u7684\u7279\u6027"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},'\u538b\u7f29\u5217\u8868\u7684\u53ef\u4ee5\u770b\u505a\u4e00\u79cd\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7684"\u53cc\u5411\u94fe\u8868"'),(0,i.kt)("li",{parentName:"ol"},"\u5217\u8868\u7684\u8282\u70b9\u4e4b\u95f4\u4e0d\u662f\u901a\u8fc7\u6307\u9488\u8fde\u63a5\uff0c\u800c\u662f\u8bb0\u5f55\u4e0a\u4e00\u8282\u70b9\u548c\u672c\u8282\u70b9\u957f\u5ea6\u6765\u5bfb\u5740\uff0c\u5185\u5b58\u5360\u7528\u8f83\u4f4e"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u5217\u8868\u6570\u636e\u8fc7\u591a\uff0c\u5bfc\u81f4\u94fe\u8868\u8fc7\u957f\uff0c\u53ef\u80fd\u5f71\u54cd\u67e5\u8be2\u6027\u80fd"),(0,i.kt)("li",{parentName:"ol"},"\u589e\u6216\u5220\u8f83\u5927\u6570\u636e\u65f6\u6709\u53ef\u80fd\u53d1\u751f\u8fde\u7eed\u66f4\u65b0\u95ee\u9898")),(0,i.kt)("h3",{id:"quicklist"},"QuickList"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"ZipList \u5b58\u5728\u95ee\u9898"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"ZipList \u867d\u7136\u8282\u7701\u5185\u5b58\uff0c\u4f46\u7533\u8bf7\u5185\u5b58\u5fc5\u987b\u662f\u8fde\u7eed\u7a7a\u95f4\uff0c\u5982\u679c\u5185\u5b58\u5360\u7528\u8f83\u591a\uff0c\u7533\u8bf7\u5185\u5b58\u6548\u7387\u5f88\u4f4e\u3002\u600e\u4e48\u529e?",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u4e3a\u4e86\u7f13\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5fc5\u987b\u9650\u5236 ZipList \u7684\u957f\u5ea6\u548c entry \u5927\u5c0f"))),(0,i.kt)("li",{parentName:"ul"},"\u4f46\u662f\u5982\u679c\u8981\u5b58\u50a8\u5927\u91cf\u6570\u636e\uff0c\u8d85\u51fa\u4e86 ZipList \u6700\u4f73\u7684\u4e0a\u9650\u8be5\u600e\u4e48\u529e?",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a ZipList \u6765\u5206\u7247\u5b58\u50a8\u6570\u636e"))),(0,i.kt)("li",{parentName:"ul"},"\u6570\u636e\u62c6\u5206\u540e\u6bd4\u8f83\u5206\u6563\uff0c\u4e0d\u65b9\u4fbf\u7ba1\u7406\u548c\u67e5\u627e\uff0c\u8fd9\u591a\u4e2a ZipList \u5982\u4f55\u5efa\u7acb\u8054\u7cfb?",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Redis \u5728 3.2 \u7248\u672c\u5f15\u5165\u4e86\u65b0\u7684\u6570\u636e\u7ed3\u6784 QuickList\uff0c\u5b83\u662f\u4e00\u4e2a\u53cc\u7aef\u94fe\u8868\uff0c\u53ea\u4e0d\u8fc7\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a ZipList\u3001")))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240723124255082",src:n(60937).Z,width:"1647",height:"365"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u907f\u514d QuickList \u4e2d\u7684\u6bcf\u4e2a ZipList \u4e2d entry \u8fc7\u591a\uff0cRedis \u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u9879: ",(0,i.kt)("inlineCode",{parentName:"p"},"list-max-ziplist-size")," \u6765\u9650\u5236\u3002"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u503c\u4e3a\u6b63\uff0c\u5219\u4ee3\u8868 ZipList \u7684\u5141\u8bb8\u7684 entry \u4e2a\u6570\u7684\u6700\u5927\u503c\uff0c\u5982\u679c\u503c\u4e3a\u8d1f\uff0c\u5219\u4ee3\u8868 ZipList \u7684\u6700\u5927\u5185\u5b58\u5927\u5c0f")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u52065\u79cd\u60c5\u51b5:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"-1"),":\u6bcf\u4e2a ZipList \u7684 \u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc7 4kb")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"}," -2"),":\u6bcf\u4e2a ZipList \u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc7 8kb")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"-3"),":\u6bcf\u4e2a ZipList \u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc7 16kb")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"-4"),":\u6bcf\u4e2a ZipList \u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc7 32kb")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"-5"),":\u6bcf\u4e2a ZipList \u7684\u5185\u5b58\u5360\u7528\u4e0d\u80fd\u8d85\u8fc7 64kb")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5176\u9ed8\u8ba4\u503c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"-2")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u914d\u7f6e\u547d\u4ee4\nconfig get list-max-ziplist-size\n"))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u9664\u4e86\u63a7\u5236 ZipList \u7684\u5927\u5c0f\uff0cQuickList \u8fd8\u53ef\u4ee5\u5bf9\u8282\u70b9\u7684 ZipList \u505a",(0,i.kt)("strong",{parentName:"p"},"\u538b\u7f29"),"\u3002\u901a\u8fc7\u914d\u7f6e\u9879 ",(0,i.kt)("inlineCode",{parentName:"p"},"list-compress-depth"),"\u6765\u63a7\u5236\u3002\u56e0\u4e3a\u94fe\u8868\u4e00\u822c\u90fd\u662f\u4ece\u9996\u5c3e\u8bbf\u95ee\u8f83\u591a\uff0c\u6240\u4ee5\u9996\u5c3e\u662f\u4e0d\u538b\u7f29\u7684\u3002\u8fd9\u4e2a\u53c2\u6570\u662f\u63a7\u5236\u9996\u5c3e\u4e0d\u538b\u7f29\u7684\u8282\u70b9\u4e2a\u6570"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"0"),":\u7279\u6b8a\u503c\uff0c\u4ee3\u8868\u4e0d\u538b\u7f29")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"1"),":\u6807\u793a QuickList \u7684\u9996\u5c3e\u5404\u6709 1 \u4e2a\u8282\u70b9\u4e0d\u538b\u7f29\uff0c\u4e2d\u95f4\u8282\u70b9\u538b\u7f29")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"2"),":\u6807\u793a QuickList \u7684\u9996\u5c3e\u5404\u6709 2 \u4e2a\u8282\u70b9\u4e0d\u538b\u7f29\uff0c\u4e2d\u95f4\u8282\u70b9\u538b\u7f29")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4ee5\u6b64\u7c7b\u63a8"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b\u914d\u7f6e\u547d\u4ee4\nconfig get list-compress-depth`\n"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"QuickList \u7ed3\u6784\u6e90\u7801\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"quicklist.h"),"\u6587\u4ef6"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/* quicklist is a 40 byte struct (on 64-bit systems) describing a quicklist.\n * 'count' is the number of total entries.\n * 'len' is the number of quicklist nodes.\n * 'compress' is: 0 if compression disabled, otherwise it's the number\n *                of quicklistNodes to leave uncompressed at ends of quicklist.\n * 'fill' is the user-requested (or default) fill factor.\n * 'bookmakrs are an optional feature that is used by realloc this struct,\n *      so that they don't consume memory when not used. */\ntypedef struct quicklist {\n    // \u5934\u8282\u70b9\u6307\u9488\n    quicklistNode *head;\n    // \u5c3e\u8282\u70b9\u6307\u9488\n    quicklistNode *tail;\n    // \u6240\u6709 ziplist \u7684 entry \u7684\u6570\u91cf\n    unsigned long count;        /* total count of all entries in all ziplists */\n    // ziplists \u603b\u6570\u91cf\n    unsigned long len;          /* number of quicklistNodes */\n    // ziplist \u7684 entry \u4e0a\u9650\uff0c\u9ed8\u8ba4\u503c -2\n    int fill : QL_FILL_BITS;              /* fill factor for individual nodes */\n    // \u9996\u5c3e\u4e0d\u538b\u7f29\u7684\u8282\u70b9\u6570\u91cf\n    unsigned int compress : QL_COMP_BITS; /* depth of end nodes not to compress;0=off */\n    // \u5185\u5b58\u91cd\u5206\u914d\u65f6\u7684\u4e66\u7b7e\u6570\u91cf\u53ca\u6570\u7ec4\uff0c\u4e00\u822c\u7528\u4e0d\u5230\n    unsigned int bookmark_count: QL_BM_BITS;\n    quicklistBookmark bookmarks[];\n} quicklist;\n\n\n/* quicklistNode is a 32 byte struct describing a ziplist for a quicklist.\n * We use bit fields keep the quicklistNode at 32 bytes.\n * count: 16 bits, max 65536 (max zl bytes is 65k, so max count actually < 32k).\n * encoding: 2 bits, RAW=1, LZF=2.\n * container: 2 bits, NONE=1, ZIPLIST=2.\n * recompress: 1 bit, bool, true if node is temporary decompressed for usage.\n * attempted_compress: 1 bit, boolean, used for verifying during testing.\n * extra: 10 bits, free for future use; pads out the remainder of 32 bits */\ntypedef struct quicklistNode {\n    // \u524d\u4e00\u4e2a\u8282\u70b9\u6307\u9488\n    struct quicklistNode *prev;\n    // \u4e0b\u4e00\u4e2a\u8282\u70b9\u6307\u9488\n    struct quicklistNode *next;\n    // \u5f53\u524d\u8282\u70b9\u7684 ziplist \u6307\u9488\n    unsigned char *zl;\n    // \u5f53\u524d\u8282\u70b9\u7684 zipList \u7684\u5b57\u8282\u5927\u5c0f\n    unsigned int sz;             /* ziplist size in bytes */\n    // \u5f53\u524d\u8282\u70b9\u7684 zipList \u7684 entry \u4e2a\u6570\n    unsigned int count : 16;     /* count of items in ziplist */\n    // \u7f16\u7801\u65b9\u5f0f:1 : ZipList; 2 : lzf\u538b\u7f29\u6a21\u5f0f\n    unsigned int encoding : 2;   /* RAW==1 or LZF==2 */\n    // \u6570\u636e\u5bb9\u5668\u7c7b\u578b(\u9884\u7559) : 1\uff0c\u5176\u5b83; 2\uff0cZipList\n    unsigned int container : 2;  /* NONE==1 or ZIPLIST==2 */\n    // \u662f\u5426\u88ab\u89e3\u538b\u7f29\u30021:\u5219\u8bf4\u660e\u88ab\u89e3\u538b\u4e86\uff0c\u5c06\u6765\u8981\u91cd\u65b0\u538b\u7f29\n    unsigned int recompress : 1; /* was this node previous compressed? */\n    // \u6d4b\u8bd5\u7528\n    unsigned int attempted_compress : 1; /* node can't compress; too small */\n    // \u9884\u7559\u5b57\u6bb5\n    unsigned int extra : 10; /* more bits to steal for future usage */\n} quicklistNode;\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240723140420158",src:n(17687).Z,width:"1524",height:"686"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"QuickList \u7684\u7279\u70b9:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u662f\u4e00\u4e2a\u8282\u70b9\u4e3a ZipList \u7684\u53cc\u7aef\u94fe\u8868"),(0,i.kt)("li",{parentName:"ul"},"\u8282\u70b9\u91c7\u7528 ZipList\uff0c\u89e3\u51b3\u4e86\u4f20\u7edf\u94fe\u8868\u7684\u5185\u5b58\u5360\u7528\u95ee\u9898"),(0,i.kt)("li",{parentName:"ul"},"\u63a7\u5236\u4e86 ZipList \u5927\u5c0f\uff0c\u89e3\u51b3\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\u7533\u8bf7\u6548\u7387\u95ee\u9898"),(0,i.kt)("li",{parentName:"ul"},"\u4e2d\u95f4\u8282\u70b9\u53ef\u4ee5\u538b\u7f29\uff0c\u8fdb\u4e00\u6b65\u8282\u7701\u4e86\u5185\u5b58")))),(0,i.kt)("h3",{id:"skiplist"},"SkipList"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"SkipList (\u8df3\u8868 )\u9996\u5148\u662f\u94fe\u8868\uff0c\u4f46\u4e0e\u4f20\u7edf\u94fe\u8868\u76f8\u6bd4\u6709\u51e0\u70b9\u5dee\u5f02:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5143\u7d20\u6309\u7167\u5347\u5e8f\u6392\u5217\u5b58\u50a8"),(0,i.kt)("li",{parentName:"ul"},"\u8282\u70b9\u53ef\u80fd\u5305\u542b\u591a\u4e2a\u6307\u9488\uff0c\u6307\u9488\u8de8\u5ea6\u4e0d\u540c")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240723171240294",src:n(13983).Z,width:"1650",height:"490"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728\u6587\u4ef6",(0,i.kt)("inlineCode",{parentName:"p"},"server.h"),"\u4e2d\u67e5\u770b\u6e90\u7801"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"typedef struct zskiplist {\n    // \u5934\u5c3e\u8282\u70b9\u6307\u9488\n    struct zskiplistNode *header, *tail;\n    // \u8282\u70b9\u6570\u91cf\n    unsigned long length;\n    // \u6700\u5927\u7684\u7d22\u5f15\u5c42\u7ea7\uff0c\u9ed8\u8ba4\u662f 1\n    int level;\n} zskiplist;\n\n/* ZSETs use a specialized version of Skiplists */\ntypedef struct zskiplistNode {\n    // \u8282\u70b9\u5b58\u50a8\u7684\u503c\n    sds ele;\n    // \u8282\u70b9\u5206\u6570\uff0c\u6392\u5e8f\u3001\u67e5\u627e\u7528\n    double score;\n    // \u524d\u4e00\u4e2a\u8282\u70b9\u6307\u9488\n    struct zskiplistNode *backward;\n    // \u591a\u7ea7\u7d22\u5f15\u6570\u7ec4\uff0c\u6bcf\u4e00\u4e2a\u8282\u70b9\u90fd\u6709\u591a\u4e2a\u7d22\u5f15\n    struct zskiplistLevel {\n        // \u4e0b\u4e00\u4e2a\u8282\u70b9\u6307\u9488\n        struct zskiplistNode *forward;\n        // \u7d22\u5f15\u8de8\u5ea6\uff0c\u8de8\u8d8a\u591a\u5c11\u4e2a\u5143\u7d20\n        unsigned long span;\n    } level[];\n} zskiplistNode;\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240723172924590",src:n(1491).Z,width:"1575",height:"597"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"SkipList \u7684\u7279\u70b9:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8df3\u8dc3\u8868\u662f\u4e00\u4e2a",(0,i.kt)("strong",{parentName:"li"},"\u53cc\u5411\u94fe\u8868"),"\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u5305\u542b score \u548c ele \u503c"),(0,i.kt)("li",{parentName:"ul"},"\u8282\u70b9\u6309\u7167 score \u503c\u6392\u5e8f\uff0cscore \u503c\u4e00\u6837\u5219\u6309\u7167 ele \u5b57\u5178\u6392\u5e8f"),(0,i.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u5305\u542b\u591a\u5c42\u6307\u9488\uff0c\u5c42\u6570\u662f 1 \u5230 32 \u4e4b\u95f4\u7684\u968f\u673a\u6570"),(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u540c\u5c42\u6307\u9488\u5230\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u8de8\u5ea6\u4e0d\u540c\uff0c\u5c42\u7ea7\u8d8a\u9ad8\uff0c\u8de8\u5ea6\u8d8a\u5927"),(0,i.kt)("li",{parentName:"ul"},"\u589e\u5220\u6539\u67e5\u6548\u7387\u4e0e\u7ea2\u9ed1\u6811\u57fa\u672c\u4e00\u81f4\uff0c\u5b9e\u73b0\u5374\u66f4\u7b80\u5355")))),(0,i.kt)("h3",{id:"redisobject"},"RedisObject"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u4e2d\u7684\u4efb\u610f\u6570\u636e\u7c7b\u578b\u7684\u952e\u548c\u503c\u90fd\u4f1a\u88ab\u5c01\u88c5\u4e3a\u4e00\u4e2a RedisObject\uff0c\u4e5f\u53eb\u505a Redis \u5bf9\u8c61\uff0c"),(0,i.kt)("p",{parentName:"li"},"\u5728\u6587\u4ef6",(0,i.kt)("inlineCode",{parentName:"p"},"server.h"),"\u4e2d\u67e5\u770b\u6e90\u7801"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"// \u5bf9\u8c61\u7c7b\u578b\n/* The actual Redis Object */\n#define OBJ_STRING 0    /* String object. */\n#define OBJ_LIST 1      /* List object. */\n#define OBJ_SET 2       /* Set object. */\n#define OBJ_ZSET 3      /* Sorted set object. */\n#define OBJ_HASH 4      /* Hash object. */\n\n// 11 \u79cd\u7f16\u7801\u65b9\u5f0f\n/* Objects encoding. Some kind of objects like Strings and Hashes can be\n * internally represented in multiple ways. The 'encoding' field of the object\n * is set to one of this fields for this object. */\n// raw \u7f16\u7801\u52a8\u6001\u5b57\u7b26\u4e32\n#define OBJ_ENCODING_RAW 0     /* Raw representation */\n// long \u7c7b\u578b\u7684\u6574\u6570\u7684\u5b57\u7b26\u4e32\n#define OBJ_ENCODING_INT 1     /* Encoded as integer */\n// hash \u8868(\u5b57\u5178 dict )\n#define OBJ_ENCODING_HT 2      /* Encoded as hash table */\n#define OBJ_ENCODING_ZIPMAP 3  /* Encoded as zipmap */\n// \u53cc\u7aef\u94fe\u8868\n#define OBJ_ENCODING_LINKEDLIST 4 /* No longer used: old list encoding. */\n// \u538b\u7f29\u5217\u8868\n#define OBJ_ENCODING_ZIPLIST 5 /* Encoded as ziplist */\n// \u6574\u6570\u96c6\u5408\n#define OBJ_ENCODING_INTSET 6  /* Encoded as intset */\n// \u8df3\u8868\n#define OBJ_ENCODING_SKIPLIST 7  /* Encoded as skiplist */\n// embstr \u7684\u52a8\u6001\u5b57\u7b26\u4e32\n#define OBJ_ENCODING_EMBSTR 8  /* Embedded sds string encoding */\n// \u5feb\u901f\u5217\u8868\n#define OBJ_ENCODING_QUICKLIST 9 /* Encoded as linked list of ziplists */\n// \u5feb\u901f\u5217\u8868\n#define OBJ_ENCODING_STREAM 10 /* Encoded as a radix tree of listpacks */\n\n\ntypedef struct redisObject {\n    // \u5bf9\u8c61\u7c7b\u578b\uff0c\u5206\u522b\u662f string\u3001hash\u3001list\u3001set \u548c zset\uff0c\u53604\u4e2abit\u4f4d\n    unsigned type:4;\n    // \u5e95\u5c42\u7f16\u7801\u65b9\u5f0f\uff0c\u5171\u670911\u79cd\uff0c\u53604\u4e2abit\u4f4d\n    unsigned encoding:4;\n    // lru \u8868\u793a\u8be5\u5bf9\u8c61\u6700\u540e\u4e00\u6b21\u88ab\u8bbf\u95ee\u7684\u65f6\u95f4\uff0c\u5176\u5360\u7528 24 \u4e2a bit \u4f4d\u3002\u4fbf\u4e8e\u5224\u65ad\u7a7a\u95f2\u65f6\u95f4\u592a\u4e45\u7684 key\n    unsigned lru:LRU_BITS; /* LRU time (relative to global lru_clock) or\n                            * LFU data (least significant 8 bits frequency\n                            * and most significant 16 bits access time). */\n    // \u5bf9\u8c61\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u8ba1\u6570\u5668\u4e3a 0 \u5219\u8bf4\u660e\u5bf9\u8c61\u65e0\u4eba\u5f15\u7528\uff0c\u53ef\u4ee5\u88ab\u56de\u6536\n    int refcount;\n    // \u6307\u9488\uff0c\u6307\u5411\u5b58\u653e\u5b9e\u9645\u6570\u636e\u7684\u7a7a\u95f4\n    void *ptr;\n} robj;\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u4e2d\u4f1a\u6839\u636e\u5b58\u50a8\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\uff0c\u9009\u62e9\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\u3002\u6bcf\u79cd\u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u7684\u7f16\u7801\u65b9\u5f0f\u5982\u4e0b"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"\u6570\u636e\u7c7b\u578b"),(0,i.kt)("th",{parentName:"tr",align:null},"\u7f16\u7801\u65b9\u5f0f"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"OBJ_STRING"),(0,i.kt)("td",{parentName:"tr",align:null},"int\u3001embstr\u3001raw")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"OBJ_LIST"),(0,i.kt)("td",{parentName:"tr",align:null},"LinkedList \u548c ZipList(3.2\u4ee5\u524d)\u3001QuickList(3.2\u4ee5\u540e)")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"OBJ_SET"),(0,i.kt)("td",{parentName:"tr",align:null},"intset\u3001HT")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"0BJ_ZSET"),(0,i.kt)("td",{parentName:"tr",align:null},"ZipList\u3001HT\u3001SkipList")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"OBJ_HASH"),(0,i.kt)("td",{parentName:"tr",align:null},"ZipList\u3001HT")))))),(0,i.kt)("h3",{id:"redis-\u4e94\u79cd\u6570\u636e\u7c7b\u578b"},"Redis \u4e94\u79cd\u6570\u636e\u7c7b\u578b"),(0,i.kt)("h4",{id:"1-string"},"1. string"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"String \u662f Redis \u4e2d\u6700\u5e38\u89c1\u7684\u6570\u636e\u5b58\u50a8\u7c7b\u578b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5176\u57fa\u672c\u7f16\u7801\u65b9\u5f0f\u662f ",(0,i.kt)("strong",{parentName:"p"},"RAW"),"\uff0c\u57fa\u4e8e\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32(SDS)\u5b9e\u73b0\uff0c\u5b58\u50a8\u4e0a\u9650\u4e3a 512mb"),(0,i.kt)("p",{parentName:"li"},"\u200b\t",(0,i.kt)("img",{alt:"image-20240727180506033",src:n(87580).Z,width:"1479",height:"396"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u5b58\u50a8\u7684 SDS \u957f\u5ea6\u5c0f\u4e8e 44 \u5b57\u8282\uff0c\u5219\u4f1a\u91c7\u7528",(0,i.kt)("strong",{parentName:"p"},"EMBSTR "),"\u7f16\u7801\uff0c\u6b64\u65f6 object head \u4e0e SDS \u662f\u4e00\u6bb5\u8fde\u7eed\u7a7a\u95f4\u3002\u7533\u8bf7\u5185\u5b58\u65f6\u53ea\u9700\u8981\u8c03\u7528\u4e00\u6b21\u5185\u5b58\u5206\u914d\u51fd\u6570\uff0c\u6548\u7387\u66f4\u9ad8"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240727180610225",src:n(49599).Z,width:"1507",height:"146"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5982\u679c\u5b58\u50a8\u7684\u5b57\u7b26\u4e32\u662f",(0,i.kt)("strong",{parentName:"p"},"\u6574\u6570"),"\u503c\uff0c\u5e76\u4e14\u5927\u5c0f\u5728 LONG_MAX\u8303\u56f4\u5185\uff0c\u5219\u4f1a\u91c7\u7528 ",(0,i.kt)("strong",{parentName:"p"},"INT "),"\u7f16\u7801\uff1a\u76f4\u63a5\u5c06\u6570\u636e\u4fdd\u5b58\u5728 RedisObject \u7684 ptr \u6307\u9488\u4f4d\u7f6e(\u521a\u597d8\u5b57\u8282)\uff0c\u4e0d\u518d\u9700\u8981 SDS \u4e86"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240727182420751",src:n(50229).Z,width:"654",height:"102"})))),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# \u67e5\u770b key \u7684\u7f16\u7801\u683c\u5f0f\nOBJECT encoding key\n")))),(0,i.kt)("h4",{id:"2-list"},"2. List"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u7684 List \u7c7b\u578b\u53ef\u4ee5\u4ece\u9996\u3001\u5c3e\u64cd\u4f5c\u5217\u8868\u4e2d\u7684\u5143\u7d20\uff0c\u5e95\u5c42\u91c7\u7528 ",(0,i.kt)("strong",{parentName:"p"},"0uickList")," \u7f16\u7801\uff0c\u7ed3\u6784\u5982\u56fe"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u80fd\u591f\u6ee1\u8db3\u53ef\u4ee5\u4ece\u9996\u3001\u5c3e\u64cd\u4f5c\u5217\u8868\u5143\u7d20\u7684\u6570\u636e\u7ed3\u6784\u6709",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"LinkedList\uff1a\u666e\u901a\u94fe\u8868\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u8f83\u9ad8\uff0c\u5185\u5b58\u788e\u7247\u8f83\u591a"),(0,i.kt)("li",{parentName:"ul"},"ZipList\uff1a\u538b\u7f29\u5217\u8868\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u4f4e\uff0c\u5b58\u50a8\u4e0a\u9650\u4f4e"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"0uickList"),"\uff1aLinkedList + ZipList\uff0c\u53ef\u4ee5\u4ece\u53cc\u7aef\u8bbf\u95ee\uff0c\u5185\u5b58\u5360\u7528\u8f83\u4f4e\uff0c\u5305\u542b\u591a\u4e2a ZipList\uff0c\u5b58\u50a8\u4e0a\u9650\u9ad8")))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240802182114392",src:n(33948).Z,width:"1330",height:"436"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u90e8\u5206\u6e90\u7801, ",(0,i.kt)("inlineCode",{parentName:"p"},"t_list.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},'/* Implements LPUSH/RPUSH/LPUSHX/RPUSHX. \n * \'xx\': push if key exists. */\nvoid pushGenericCommand(client *c, int where, int xx) {\n    int j;\n\n    for (j = 2; j < c->argc; j++) {\n        if (sdslen(c->argv[j]->ptr) > LIST_MAX_ITEM_SIZE) {\n            addReplyError(c, "Element too large");\n            return;\n        }\n    }\n\n    robj *lobj = lookupKeyWrite(c->db, c->argv[1]);\n    if (checkType(c,lobj,OBJ_LIST)) return;\n    if (!lobj) {\n        if (xx) {\n            addReply(c, shared.czero);\n            return;\n        }\n\n        // \u521b\u5efa Quicklist\n        lobj = createQuicklistObject();\n        quicklistSetOptions(lobj->ptr, server.list_max_ziplist_size,\n                            server.list_compress_depth);\n        dbAdd(c->db,c->argv[1],lobj);\n    }\n\n    for (j = 2; j < c->argc; j++) {\n        listTypePush(lobj,c->argv[j],where);\n        server.dirty++;\n    }\n\n    addReplyLongLong(c, listTypeLength(lobj));\n\n    char *event = (where == LIST_HEAD) ? "lpush" : "rpush";\n    signalModifiedKey(c,c->db,c->argv[1]);\n    notifyKeyspaceEvent(NOTIFY_LIST,event,c->argv[1],c->db->id);\n}\n')),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"object.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"robj *createQuicklistObject(void) {\n    quicklist *l = quicklistCreate();\n    robj *o = createObject(OBJ_LIST,l);\n    o->encoding = OBJ_ENCODING_QUICKLIST;\n    return o;\n}\n")))),(0,i.kt)("h4",{id:"3-set"},"3. set"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Set \u662f Redis \u4e2d\u7684\u5355\u5217\u96c6\u5408\uff0c\u6ee1\u8db3\u4e0b\u5217\u7279\u70b9:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u4e0d\u4fdd\u8bc1\u6709\u5e8f\u6027"),(0,i.kt)("li",{parentName:"ul"},"\u4fdd\u8bc1\u5143\u7d20\u552f\u4e00(\u53ef\u4ee5\u5224\u65ad\u5143\u7d20\u662f\u5426\u5b58\u5728)"),(0,i.kt)("li",{parentName:"ul"},"\u6c42\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u67e5\u8be2\u6548\u7387\u548c\u552f\u4e00\u6027\uff0cset \u91c7\u7528 ",(0,i.kt)("strong",{parentName:"p"},"HT")," \u7f16\u7801(",(0,i.kt)("strong",{parentName:"p"},"Dict"),")\u3002Dict \u4e2d\u7684 key \u7528\u6765\u5b58\u50a8\u5143\u7d20\uff0cvalue \u7edf\u4e00\u4e3a null"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240802193703900",src:n(50048).Z,width:"1374",height:"395"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53\u5b58\u50a8\u7684\u6240\u6709\u6570\u636e\u90fd\u662f\u6574\u6570\uff0c\u5e76\u4e14\u5143\u7d20\u6570\u91cf\u4e0d\u8d85\u8fc7 set-max-intset-entries \uff08\u9ed8\u8ba4\u503c 512\uff09\u65f6\uff0cSet \u4f1a\u91c7\u7528 ",(0,i.kt)("strong",{parentName:"p"},"Intset")," \u7f16\u7801\uff0c\u4ee5\u8282\u7701\u5185\u5b58"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240802193458287",src:n(53744).Z,width:"1266",height:"331"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6e90\u7801\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"t_set.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},'/* Factory method to return a set that *can* hold "value". When the object has\n * an integer-encodable value, an intset will be returned. Otherwise a regular\n * hash table. */\nrobj *setTypeCreate(sds value) {\n    // \u5224\u65ad value \u662f\u5426\u4e3a\u6570\u503c\u7c7b\u578b\n    if (isSdsRepresentableAsLongLong(value,NULL) == C_OK)\n        return createIntsetObject();\n    return createSetObject();\n}\n\n\n/* Add the specified value into a set.\n *\n * If the value was already member of the set, nothing is done and 0 is\n * returned, otherwise the new element is added and 1 is returned. */\n// \u5f80 set \u6dfb\u52a0\u6570\u636e\nint setTypeAdd(robj *subject, sds value) {\n    long long llval;\n    if (subject->encoding == OBJ_ENCODING_HT) {  // HT \u7f16\u7801\uff0c\u5219\u76f4\u63a5\u5f80 dict \u6dfb\u52a0\u5143\u7d20\n        dict *ht = subject->ptr;\n        dictEntry *de = dictAddRaw(ht,value,NULL);\n        if (de) {\n            dictSetKey(ht,de,sdsdup(value));\n            dictSetVal(ht,de,NULL);\n            return 1;\n        }\n    } else if (subject->encoding == OBJ_ENCODING_INTSET) {  // IntSet \u7f16\u7801\n        //\u82e5 value \u4e3a\u6574\u6570\uff0c\u76f4\u63a5\u5f80 IntSet \u4e2d\u6dfb\u52a0\u5143\u7d20\n        if (isSdsRepresentableAsLongLong(value,&llval) == C_OK) {\n            uint8_t success = 0;\n            subject->ptr = intsetAdd(subject->ptr,llval,&success);\n            if (success) {\n                /* Convert to regular set when the intset contains\n                 * too many entries. */\n                size_t max_entries = server.set_max_intset_entries;\n                /* limit to 1G entries due to intset internals. */\n                if (max_entries >= 1<<30) max_entries = 1<<30;\n                // \u82e5 IntSet \u7684\u5143\u7d20\u6570\u91cf\u8d85\u51fa set_max_intset_entries\uff0c\u5219\u5c06 IntSet \u8f6c\u4e3a HT\n                if (intsetLen(subject->ptr) > max_entries)\n                    setTypeConvert(subject,OBJ_ENCODING_HT);\n                return 1;\n            }\n        } else {\n            /* Failed to get integer from object, convert to regular set. */\n            //\u82e5 value \u4e0d\u662f\u6574\u6570\uff0c\u5c06 IntSet \u8f6c\u4e3a HT\n            setTypeConvert(subject,OBJ_ENCODING_HT);\n\n            /* The set *was* an intset and this value is not integer\n             * encodable, so dictAdd should always work. */\n            serverAssert(dictAdd(subject->ptr,sdsdup(value),NULL) == DICT_OK);\n            return 1;\n        }\n    } else {\n        serverPanic("Unknown set encoding");\n    }\n    return 0;\n}\n')),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"object.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"//\u521b\u5efa IntSet\nrobj *createIntsetObject(void) {\n    intset *is = intsetNew();\n    robj *o = createObject(OBJ_SET,is);\n    o->encoding = OBJ_ENCODING_INTSET;\n    return o;\n}\n\n// \u521b\u5efa dict\nrobj *createSetObject(void) {\n    dict *d = dictCreate(&setDictType,NULL);\n    robj *o = createObject(OBJ_SET,d);\n    o->encoding = OBJ_ENCODING_HT;\n    return o;\n}\n")))),(0,i.kt)("h4",{id:"4-zset-sortedset"},"4. Zset \uff08SortedSet\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Zset \u4e5f\u5c31\u662f SortedSet\uff0c\u5176\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u9700\u8981\u6307\u5b9a\u4e00\u4e2a score \u503c\u548c member\u503c"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6839\u636e score \u503c\u6392\u5e8f"),(0,i.kt)("li",{parentName:"ul"},"member \u5fc5\u987b\u552f\u4e00"),(0,i.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u6839\u636e member \u67e5\u8be2\u5206\u6570"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u6b64\uff0cZset \u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5fc5\u987b\u6ee1\u8db3",(0,i.kt)("strong",{parentName:"p"},"\u952e\u503c\u5b58\u50a8"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u952e\u5fc5\u987b\u552f\u4e00"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u53ef\u6392\u5e8f"),"\u8fd9\u51e0\u4e2a\u9700\u6c42"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SkipList")," : \u53ef\u4ee5\u6392\u5e8f\uff0c\u5e76\u4e14\u53ef\u4ee5\u540c\u65f6\u5b58\u50a8 score \u548c ele \u503c (member)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"HT (Dict)")," : \u53ef\u4ee5\u952e\u503c\u5b58\u50a8\uff0c\u5e76\u4e14\u53ef\u4ee5\u6839\u636e key \u627e value"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Zset")," \u7ed3\u6784\u6e90\u7801\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"t_zset.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"// zset \u7ed3\u6784\u4f53\ntypedef struct zset {\n    // Dict \u6307\u9488\n    dict *dict;\n    // Skiplist \u6307\u9488\n    zskiplist *zsl;\n} zset;\n\n// \u521b\u5efa zset \u5bf9\u8c61\nrobj *createZsetObject(void) {\n    zset *zs = zmalloc(sizeof(*zs));\n    robj *o;\n    // \u521b\u5efa Dict\n    zs->dict = dictCreate(&zsetDictType,NULL);\n    // \u521b\u5efa Skiplist\n    zs->zsl = zslCreate();\n    o = createObject(OBJ_ZSET,zs);\n    o->encoding = OBJ_ENCODING_SKIPLIST;\n    return o;\n}\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809012303548",src:n(79786).Z,width:"1336",height:"697"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7531\u4e0a\u8ff0 ",(0,i.kt)("inlineCode",{parentName:"p"},"zset")," \u7684\u5185\u5b58\u7ed3\u6784\u56fe\u53ef\u770b\u51fa\uff0c\u5b8c\u6574\u7684",(0,i.kt)("inlineCode",{parentName:"p"},"zset"),"\u7ed3\u6784\u5305\u542b\u5927\u91cf\u6307\u9488\uff0c\u5185\u5b58\u6d88\u8017\u4f1a\u5f88\u5927\u3002\u4e14\u5f53\u5143\u7d20\u6570\u91cf\u4e0d\u591a\u65f6\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"HT")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"SkipList")," \u7684\u4f18\u52bf\u4e0d\u660e\u663e\u3002"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"zset")," \u8fd8\u4f1a\u91c7\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"ZipList")," \u7ed3\u6784\u6765\u8282\u7701\u5185\u5b58\uff0c\u4e0d\u8fc7\u9700\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u5143\u7d20\u6570\u91cf\u5c0f\u4e8e ",(0,i.kt)("inlineCode",{parentName:"p"},"zset_max_ziplist_entries"),"\uff0c\u9ed8\u8ba4\u503c 128")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"\u6bcf\u4e2a\u5143\u7d20\u90fd\u5c0f\u4e8e",(0,i.kt)("inlineCode",{parentName:"p"},"zset_max_ziplist_value")," \u5b57\u8282\uff0c\u9ed8\u8ba4\u503c 64"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"config get zset_max_ziplist_entries\n\nconfig get zset_max_ziplist_value\n"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"t_zset.c")," \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"zaddGenericCommand")," \u65b9\u6cd5\u521d\u59cb\u5316 ",(0,i.kt)("inlineCode",{parentName:"p"},"zset")," \u5bf9\u8c61\uff0c\u90e8\u5206\u6e90\u4ee3\u7801\u5982\u4e0b"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"      // \u7565......\n    /* Lookup the key and create the sorted set if does not exist. */\n    // zadd\u6dfb\u52a0\u5143\u7d20\u65f6\uff0c\u5148\u6839\u636e key \u627e\u5230 zset\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u65b0\u7684 zset\n    zobj = lookupKeyWrite(c->db,key);\n    if (checkType(c,zobj,OBJ_ZSET)) goto cleanup;\n    // zset \u4e0d\u5b58\u5728\n    if (zobj == NULL) {\n        if (xx) goto reply_to_client; /* No key + XX option: nothing to do. */\n        // zset_max_ziplist_entries \u8bbe\u7f6e\u4e3a 0 \u5c31\u662f\u7981\u7528\u4e86 ZipList\n        if (server.zset_max_ziplist_entries == 0 ||\n            server.zset_max_ziplist_value < sdslen(c->argv[scoreidx+1]->ptr))\n        {\n            // \u6216\u8005 value \u5927\u5c0f\u8d85\u8fc7\u4e86 zset_max_ziplist_value\uff0c\u91c7\u7528 HT + SkipList\n            zobj = createZsetObject();\n        } else {\n            // \u5426\u5219\uff0c\u91c7\u7528 ZipList\n            zobj = createZsetZiplistObject();\n        }\n        dbAdd(c->db,key,zobj);\n    }\n\n    for (j = 0; j < elements; j++) {\n        double newscore;\n        score = scores[j];\n        int retflags = 0;\n\n        ele = c->argv[scoreidx+1+j*2]->ptr;\n        // zsetAdd \u65b9\u6cd5\u8fd9\u79cd\u4f1a\u8fdb\u884c ZipList \u4e0e HT + SkipList \u8f6c\u6362\u7684\u5224\u65ad\n        int retval = zsetAdd(zobj, score, ele, flags, &retflags, &newscore);\n        if (retval == 0) {\n            addReplyError(c,nanerr);\n            goto cleanup;\n        }\n        if (retflags & ZADD_OUT_ADDED) added++;\n        if (retflags & ZADD_OUT_UPDATED) updated++;\n        if (!(retflags & ZADD_OUT_NOP)) processed++;\n        score = newscore;\n    }\n    // \u7565......\n")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"int zsetAdd(robj *zobj, double score, sds ele, int in_flags, int *out_flags, double *newscore) { \n    // \u7565......\n    /* Update the sorted set according to its encoding. */\n    // ZipList \u7f16\u7801\n    if (zobj->encoding == OBJ_ENCODING_ZIPLIST) {\n        unsigned char *eptr;\n        //\u5224\u65ad\u5f53\u524d\u5143\u7d20\u662f\u5426\u5df2\u7ecf\u5b58\u5728\uff0c\u5df2\u7ecf\u5b58\u5728\u5219\u66f4\u65b0score\u5373\u53ef\n        if ((eptr = zzlFind(zobj->ptr,ele,&curscore)) != NULL) {\n            // \u7565......\n            return 1;\n        } else if (!xx) {\n            /* check if the element is too large or the list\n             * becomes too long *before* executing zzlInsert. */\n            // \u5143\u7d20\u4e0d\u5b58\u5728\uff0c\u9700\u8981\u65b0\u589e\uff0c\u5219\u5224\u65ad ziplist \u957f\u5ea6\u6709\u6ca1\u6709\u8d85\u3001\u5143\u7d20\u7684\u5927\u5c0f\u6709\u6ca1\u6709\u8d85\n            if (zzlLength(zobj->ptr)+1 > server.zset_max_ziplist_entries ||\n                sdslen(ele) > server.zset_max_ziplist_value ||\n                !ziplistSafeToAdd(zobj->ptr, sdslen(ele)))\n            {\n                // \u5982\u679c\u8d85\u51fa\uff0c\u5219\u9700\u8981\u8f6c\u4e3a SkipList \u7f16\u7801\n                zsetConvert(zobj,OBJ_ENCODING_SKIPLIST);\n            } else {\n                zobj->ptr = zzlInsert(zobj->ptr,ele,score);\n                if (newscore) *newscore = score;\n                *out_flags |= ZADD_OUT_ADDED;\n                return 1;\n            }\n        } else {\n            *out_flags |= ZADD_OUT_NOP;\n            return 1;\n        }\n    }\n    // \u7565......\n}\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"object.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"robj *createZsetObject(void) {\n    zset *zs = zmalloc(sizeof(*zs));\n    robj *o;\n\n    zs->dict = dictCreate(&zsetDictType,NULL);\n    zs->zsl = zslCreate();\n    o = createObject(OBJ_ZSET,zs);\n    o->encoding = OBJ_ENCODING_SKIPLIST;\n    return o;\n}\n\nrobj *createZsetZiplistObject(void) {\n    unsigned char *zl = ziplistNew();\n    robj *o = createObject(OBJ_ZSET,zl);\n    o->encoding = OBJ_ENCODING_ZIPLIST;\n    return o;\n}\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"ziplist")," \u672c\u8eab\u6ca1\u6709\u6392\u5e8f\u529f\u80fd\uff0c\u800c\u4e14\u6ca1\u6709\u952e\u503c\u5bf9\u7684\u6982\u5ff5\uff0c\u56e0\u6b64\u9700\u8981\u7531 ",(0,i.kt)("inlineCode",{parentName:"p"},"zset")," \u901a\u8fc7\u7f16\u7801\u5b9e\u73b0"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"zipList")," \u662f\u8fde\u7eed\u5185\u5b58\uff0c\u56e0\u6b64 ",(0,i.kt)("inlineCode",{parentName:"p"},"score")," \u548c ",(0,i.kt)("inlineCode",{parentName:"p"},"element")," \u662f\u7d27\u6328\u5728\u4e00\u8d77\u7684\u4e24\u4e2a ",(0,i.kt)("inlineCode",{parentName:"p"},"entry"),"\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"element")," \u5728\u524d\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"score")," \u5728\u540e")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"score")," \u8d8a\u5c0f\u8d8a\u63a5\u8fd1\u961f\u9996\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"score")," \u8d8a\u5927\u8d8a\u63a5\u8fd1\u961f\u5c3e\uff0c\u6309\u7167 ",(0,i.kt)("inlineCode",{parentName:"p"},"score")," \u503c\u5347\u5e8f\u6392\u5217"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809021156736",src:n(65105).Z,width:"1296",height:"292"})))))))),(0,i.kt)("p",null,"\u200b"),(0,i.kt)("h4",{id:"5-hash"},"5. Hash"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Hash")," \u7ed3\u6784\u4e0e Redis \u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"Zset")," \u975e\u5e38\u7c7b\u4f3c:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u90fd\u662f\u952e\u503c\u5b58\u50a8"),(0,i.kt)("li",{parentName:"ul"},"\u90fd\u9700\u6c42\u6839\u636e\u952e\u83b7\u53d6\u503c"),(0,i.kt)("li",{parentName:"ul"},"\u952e\u5fc5\u987b\u552f\u4e00"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Hash")," \u4e0e",(0,i.kt)("inlineCode",{parentName:"p"},"Zset")," \u533a\u522b\u5982\u4e0b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"c \u7684\u952e\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"member"),"\uff0c\u503c\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"score"),"; ",(0,i.kt)("inlineCode",{parentName:"li"},"Hash")," \u7684\u952e\u548c\u503c\u90fd\u662f\u4efb\u610f\u503c"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"Zset"),"\u8981\u6839\u636e ",(0,i.kt)("inlineCode",{parentName:"li"},"score")," \u6392\u5e8f; ",(0,i.kt)("inlineCode",{parentName:"li"},"Hash")," \u5219\u65e0\u9700\u6392\u5e8f"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u6b64\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"Hash")," \u5e95\u5c42\u91c7\u7528\u7684\u7f16\u7801\u4e0e ",(0,i.kt)("inlineCode",{parentName:"p"},"Zset")," \u4e5f\u57fa\u672c\u4e00\u81f4\uff0c\u53ea\u9700\u8981\u628a\u6392\u5e8f\u6709\u5173\u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"SkipList")," \u53bb\u6389\u5373\u53ef:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"Hash"),"  \u7ed3\u6784\u9ed8\u8ba4\u91c7\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"ZipList")," \u7f16\u7801\uff0c\u7528\u4ee5\u8282\u7701\u5185\u5b58\u3002",(0,i.kt)("inlineCode",{parentName:"p"},"ZipList")," \u4e2d\u76f8\u90bb\u7684\u4e24\u4e2a ",(0,i.kt)("inlineCode",{parentName:"p"},"entry "),"\u5206\u522b\u4fdd\u5b58 ",(0,i.kt)("inlineCode",{parentName:"p"},"field")," \u548c",(0,i.kt)("inlineCode",{parentName:"p"},"value")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809021916855",src:n(22252).Z,width:"1297",height:"290"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53\u6570\u636e\u91cf\u8f83\u5927\u65f6\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"Hash"),"  \u7ed3\u6784\u4f1a\u8f6c\u4e3a ",(0,i.kt)("inlineCode",{parentName:"p"},"HT")," \u7f16\u7801\uff0c\u4e5f\u5c31\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"Dict"),"\uff0c\u89e6\u53d1\u6761\u4ef6\u6709\u4e24\u4e2a"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"ZipList")," \u4e2d\u7684\u5143\u7d20\u6570\u91cf\u8d85\u8fc7\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"hash-max-ziplist-entries (\u9ed8\u8ba4512)")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"ZipList"),"\u4e2d\u7684\u4efb\u610f ",(0,i.kt)("inlineCode",{parentName:"li"},"entry")," \u5927\u5c0f\u8d85\u8fc7\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"hash-max-ziplist-value (\u9ed8\u8ba464\u5b57\u8282)"))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809022429531",src:n(12969).Z,width:"1312",height:"319"}))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u90e8\u5206\u6e90\u7801\uff0c",(0,i.kt)("inlineCode",{parentName:"p"},"t_hash.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"// hset \u547d\u4ee4\uff0c\u4f8b\uff1a hset userl name Jack age 21\nvoid hsetCommand(client *c) {\n    int i, created = 0;\n    robj *o;\n\n    if ((c->argc % 2) == 1) {\n        addReplyErrorFormat(c,\"wrong number of arguments for '%s' command\",c->cmd->name);\n        return;\n    }\n\n    //\u5224\u65ad hash \u7684 key \u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\uff0c\u9ed8\u8ba4\u91c7\u7528 ZipList \u7f16\u7801\n    if ((o = hashTypeLookupWriteOrCreate(c,c->argv[1])) == NULL) return;\n    // \u5224\u65ad\u662f\u5426\u9700\u8981\u628a ZipList \u8f6c\u4e3a Dict\n    hashTypeTryConversion(o,c->argv,2,c->argc-1);\n\n    // \u5faa\u73af\u904d\u5386\u6bcf\u4e00\u5bf9 field \u548c value\uff0c\u5e76\u6267\u884c hset \u547d\u4ee4\n    for (i = 2; i < c->argc; i += 2)\n        created += !hashTypeSet(o,c->argv[i]->ptr,c->argv[i+1]->ptr,HASH_SET_COPY);\n\n    /* HMSET (deprecated) and HSET return value is different. */\n    char *cmdname = c->argv[0]->ptr;\n    if (cmdname[1] == 's' || cmdname[1] == 'S') {\n        /* HSET */\n        addReplyLongLong(c, created);\n    } else {\n        /* HMSET */\n        addReply(c, shared.ok);\n    }\n    signalModifiedKey(c,c->db,c->argv[1]);\n    notifyKeyspaceEvent(NOTIFY_HASH,\"hset\",c->argv[1],c->db->id);\n    server.dirty += (c->argc - 2)/2;\n}\n\nrobj *hashTypeLookupWriteOrCreate(client *c, robj *key) {\n    robj *o = lookupKeyWrite(c->db,key);\n    if (checkType(c,o,OBJ_HASH)) return NULL;\n\n    if (o == NULL) {\n        //\u521b\u5efa hash \u5bf9\u8c61\n        o = createHashObject();\n        dbAdd(c->db,key,o);\n    }\n    return o;\n}\n\n/* Check the length of a number of objects to see if we need to convert a\n * ziplist to a real hash. Note that we only check string encoded objects\n * as their string length can be queried in constant time. */\nvoid hashTypeTryConversion(robj *o, robj **argv, int start, int end) {\n    int i;\n    size_t sum = 0;\n    // \u672c\u6765\u5c31\u4e0d\u662f ZipList \u7f16\u7801\uff0c\u76f4\u63a5 return\n    if (o->encoding != OBJ_ENCODING_ZIPLIST) return;\n\n    for (i = start; i <= end; i++) {\n        if (!sdsEncodedObject(argv[i]))\n            continue;\n        size_t len = sdslen(argv[i]->ptr);\n        // \u5982\u679c field \u6216 value \u8d85\u8fc7 hash_max_ziplist_value\uff0c\u5219\u8f6c\u4e3aHT\n        if (len > server.hash_max_ziplist_value) {\n            hashTypeConvert(o, OBJ_ENCODING_HT);\n            return;\n        }\n        sum += len;\n    }\n    // ziplist \u603b\u5927\u5c0f\u8d85\u8fc7 1G\uff0c\u4e5f\u8f6c\u4e3a HT\n    if (!ziplistSafeToAdd(o->ptr, sum))\n        hashTypeConvert(o, OBJ_ENCODING_HT);\n}\n\n\nint hashTypeSet(robj *o, sds field, sds value, int flags) {\n    int update = 0;\n    //\u5224\u65ad\u662f\u5426\u4e3a ZipList \u7f16\u7801\n    if (o->encoding == OBJ_ENCODING_ZIPLIST) {\n        unsigned char *zl, *fptr, *vptr;\n\n        zl = o->ptr;\n        //\u67e5\u8be2 head \u6307\u9488\n        fptr = ziplistIndex(zl, ZIPLIST_HEAD);\n        // head \u4e0d\u4e3a\u7a7a\uff0c\u8bf4\u660e ZipList \u4e0d\u4e3a\u7a7a\uff0c\u5f00\u59cb\u67e5\u627e key\n        if (fptr != NULL) {\n            fptr = ziplistFind(zl, fptr, (unsigned char*)field, sdslen(field), 1);\n            // \u5224\u65ad\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5df2\u7ecf\u5b58\u5728\u5219\u66f4\u65b0\n            if (fptr != NULL) {\n                /* Grab pointer to the value (fptr points to the field) */\n                vptr = ziplistNext(zl, fptr);\n                serverAssert(vptr != NULL);\n                // \u5143\u7d20\u5b58\u5728\uff0c\u8bb0\u5f55\u64cd\u4f5c\u4e3a\u66f4\u65b0\n                update = 1;\n\n                /* Replace value */\n                zl = ziplistReplace(zl, vptr, (unsigned char*)value,\n                        sdslen(value));\n            }\n        }\n        //\u4e0d\u5b58\u5728\uff0c\u5219\u76f4\u63a5 push\n        if (!update) {\n            /* Push new field/value pair onto the tail of the ziplist */\n            // \u4f9d\u6b21push\u65b0\u7684 field \u548c value \u5230 ZipList \u7684\u5c3e\u90e8\n            zl = ziplistPush(zl, (unsigned char*)field, sdslen(field),\n                    ZIPLIST_TAIL);\n            zl = ziplistPush(zl, (unsigned char*)value, sdslen(value),\n                    ZIPLIST_TAIL);\n        }\n        o->ptr = zl;\n\n        /* Check if the ziplist needs to be converted to a hash table */\n        // \u63d2\u5165\u4e86\u65b0\u5143\u7d20\u540e\uff0c\u68c0\u67e5 list \u957f\u5ea6\u662f\u5426\u8d85\u51fa\uff0c\u8d85\u51fa\u5219\u8f6c\u4e3a HT\n        if (hashTypeLength(o) > server.hash_max_ziplist_entries)\n            hashTypeConvert(o, OBJ_ENCODING_HT);\n    } else if (o->encoding == OBJ_ENCODING_HT) {\n        // HT \u7f16\u7801\uff0c\u76f4\u63a5\u63d2\u5165\u6216\u8986\u76d6\uff0c\u7565......\n    } else {\n        serverPanic(\"Unknown hash encoding\");\n    }\n\n    /* Free SDS strings we did not referenced elsewhere if the flags\n     * want this function to be responsible. */\n    if (flags & HASH_SET_TAKE_FIELD && field) sdsfree(field);\n    if (flags & HASH_SET_TAKE_VALUE && value) sdsfree(value);\n    return update;\n}\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"object.c")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"robj *createHashObject(void) {\n    // \u9ed8\u8ba4\u91c7\u7528 ZipList \u7f16\u7801\uff0c\u7533\u8bf7 ZipList \u5185\u5b58\u7a7a\u95f4\n    unsigned char *zl = ziplistNew();\n    robj *o = createObject(OBJ_HASH, zl);\n    o->encoding = OBJ_ENCODING_ZIPLIST;\n    return o;\n}\n")))),(0,i.kt)("h2",{id:"\u4e8c\u7f51\u7edc\u6a21\u578b"},"\u4e8c\u3001\u7f51\u7edc\u6a21\u578b"),(0,i.kt)("h3",{id:"\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4"},"\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4efb\u4f55 Linux \u53d1\u884c\u7248\uff0c\u5176\u7cfb\u7edf\u5185\u6838\u90fd\u662f Linux\u3002\u6211\u4eec\u7684\u5e94\u7528\u90fd\u9700\u8981\u901a\u8fc7 Linux \u5185\u6838\u4e0e\u786c\u4ef6\u4ea4\u4e92"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809030020951",src:n(24154).Z,width:"1261",height:"482"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e3a\u4e86\u907f\u514d\u7528\u6237\u5e94\u7528\u5bfc\u81f4\u51b2\u7a81\u751a\u81f3\u5185\u6838\u5d29\u6e83\uff0c\u7528\u6237\u5e94\u7528\u4e0e\u5185\u6838\u662f\u5206\u79bb\u7684"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8fdb\u7a0b\u7684\u5bfb\u5740\u7a7a\u95f4\u4f1a\u5212\u5206\u4e3a\u4e24\u90e8\u5206: ",(0,i.kt)("strong",{parentName:"p"},"\u5185\u6838\u7a7a\u95f4"),"\u3001",(0,i.kt)("strong",{parentName:"p"},"\u7528\u6237\u7a7a\u95f4"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u7528\u6237\u7a7a\u95f4"),"\u53ea\u80fd\u6267\u884c\u53d7\u9650\u7684\u547d\u4ee4( ",(0,i.kt)("inlineCode",{parentName:"p"},"Ring3")," )\uff0c\u800c\u4e14\u4e0d\u80fd\u76f4\u63a5\u8c03\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u5fc5\u987b\u901a\u8fc7\u5185\u6838\u63d0\u4f9b\u7684\u63a5\u53e3\u6765\u8bbf\u95ee")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5185\u6838\u7a7a\u95f4"),"\u53ef\u4ee5\u6267\u884c\u7279\u6743\u547d\u4ee4( ",(0,i.kt)("inlineCode",{parentName:"p"},"Ring0")," )\u8c03\u7528\u4e00\u5207\u7cfb\u7edf\u8d44\u6e90"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809032446235",src:n(24894).Z,width:"1299",height:"439"}))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Linux \u7cfb\u7edf\u4e3a\u4e86\u63d0\u9ad8 IO \u6548\u7387\uff0c\u4f1a\u5728\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u90fd\u52a0\u5165",(0,i.kt)("strong",{parentName:"p"},"\u7f13\u51b2\u533a")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5199\u6570\u636e\u65f6\uff0c\u8981\u628a",(0,i.kt)("strong",{parentName:"p"},"\u7528\u6237\u7f13\u51b2\u533a"),"\u6570\u636e\u62f7\u8d1d\u5230",(0,i.kt)("strong",{parentName:"p"},"\u5185\u6838\u7f13\u51b2\u533a"),"\uff0c\u7136\u540e\u5199\u5165\u8bbe\u5907")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8bfb\u6570\u636e\u65f6\uff0c\u8981\u4ece\u8bbe\u5907\u8bfb\u53d6\u6570\u636e\u5230",(0,i.kt)("strong",{parentName:"p"},"\u5185\u6838\u7f13\u51b2\u533a"),"\uff0c\u7136\u540e\u62f7\u8d1d\u5230",(0,i.kt)("strong",{parentName:"p"},"\u7528\u6237\u7f13\u51b2\u533a")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809033223493",src:n(94329).Z,width:"586",height:"422"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u56e0\u6b64\u6570\u53d6\u6570\u636e\u7684\u6d41\u7a0b\u53ef\u4ee5\u7b80\u5316\u4e3a\u5982\u4e0b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u901a\u8fc7\u9488\u5bf9\u8fd9\u4e24\u4e2a\u9636\u6bb5\u8fdb\u884c\u4f18\u5316\uff0c\u51fa\u73b0\u4ee5\u4e0b\u51e0\u79cd\u7f51\u7edc IO \u6a21\u578b",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u963b\u585e I0 (",(0,i.kt)("strong",{parentName:"li"},"Blocking I0"),")"),(0,i.kt)("li",{parentName:"ul"},"\u975e\u963b\u585e I0 (",(0,i.kt)("strong",{parentName:"li"},"Nonblocking I0"),")"),(0,i.kt)("li",{parentName:"ul"},"I0 \u591a\u8def\u590d\u7528 (",(0,i.kt)("strong",{parentName:"li"},"I0 Multiplexing"),")"),(0,i.kt)("li",{parentName:"ul"},"\u4fe1\u53f7\u9a71\u52a8 I0 (",(0,i.kt)("strong",{parentName:"li"},"Signal Driven l0"),")"),(0,i.kt)("li",{parentName:"ul"},"\u5f02\u6b65 I0 (",(0,i.kt)("strong",{parentName:"li"},"Asynchronous I0"),")")))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809045524078",src:n(50914).Z,width:"605",height:"280"})))))),(0,i.kt)("h3",{id:"\u963b\u585e-io-blocking-i0"},"\u963b\u585e IO \uff08Blocking I0\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u963b\u585e I0 \u5c31\u662f\u4e24\u4e2a\u9636\u6bb5\u90fd\u5fc5\u987b\u963b\u585e\u7b49\u5f85\uff0c\u6027\u80fd\u5dee"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809050522189",src:n(15700).Z,width:"944",height:"456"})))),(0,i.kt)("h3",{id:"\u975e\u963b\u585e-iononblocking-i0"},"\u975e\u963b\u585e IO\uff08Nonblocking I0\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u975e\u963b\u585e I0 \u7684 ",(0,i.kt)("inlineCode",{parentName:"p"},"recvfrom")," \u64cd\u4f5c\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\u800c\u4e0d\u662f\u963b\u585e\u7528\u6237\u8fdb\u7a0b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u975e\u963b\u585e I0 \u5728",(0,i.kt)("strong",{parentName:"li"},"\u7b49\u5f85\u6570\u636e\u9636\u6bb5"),"\u662f\u975e\u963b\u585e\u7684\uff0c\u4f46\u662f\u5728",(0,i.kt)("strong",{parentName:"li"},"\u6570\u636e\u62f7\u8d1d\u9636\u6bb5"),"\u4f9d\u7136\u662f\u963b\u585e\u7684"),(0,i.kt)("li",{parentName:"ul"},"\u867d\u7136\u662f\u975e\u963b\u585e\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u6027\u80fd\u5e76\u6ca1\u6709\u5f97\u5230\u63d0\u9ad8\u3002\u800c\u4e14",(0,i.kt)("strong",{parentName:"li"},"\u5fd9\u7b49\u673a\u5236"),"\u4f1a\u5bfc\u81f4 CPU \u7a7a\u8f6c\uff0cCPU \u4f7f\u7528\u7387\u66b4\u589e")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240809050826799",src:n(90907).Z,width:"900",height:"449"})))),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"\u975e\u963b\u585e I/O \u76f8\u6bd4\u4e8e\u963b\u585e I/O \u901a\u5e38\u80fd\u591f\u63d0\u5347\u6027\u80fd\uff0c\u5c24\u5176\u662f\u5728\u5904\u7406\u9ad8\u5e76\u53d1\u7684\u7f51\u7edc\u8bf7\u6c42\u65f6\u3002\u7136\u800c\uff0c\u662f\u5426\u80fd\u591f\u63d0\u5347\u6027\u80fd\u4ee5\u53ca\u63d0\u5347\u7684\u5e45\u5ea6\uff0c\u53d6\u51b3\u4e8e\u5e94\u7528\u7684\u5177\u4f53\u573a\u666f\u548c\u5b9e\u73b0\u65b9\u5f0f\u3002"),(0,i.kt)("h3",{parentName:"blockquote",id:"\u963b\u585e-io-\u4e0e\u975e\u963b\u585e-io-\u7684\u533a\u522b"},"\u963b\u585e I/O \u4e0e\u975e\u963b\u585e I/O \u7684\u533a\u522b"),(0,i.kt)("ol",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u963b\u585e I/O"),"\uff1a\u5728\u963b\u585e I/O \u6a21\u5f0f\u4e0b\uff0c\u5f53\u4e00\u4e2a I/O \u64cd\u4f5c\uff08\u5982\u8bfb\u53d6\u6216\u5199\u5165\uff09\u53d1\u8d77\u65f6\uff0c\u8c03\u7528\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u64cd\u4f5c\u5b8c\u6210\u4e3a\u6b62\u3002\u8fd9\u610f\u5473\u7740\u5982\u679c\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85 I/O \u64cd\u4f5c\u5b8c\u6210\uff08\u6bd4\u5982\u7b49\u5f85\u8bfb\u53d6\u7684\u6570\u636e\uff09\uff0c\u5b83\u5c31\u65e0\u6cd5\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4efb\u52a1\u3002"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u975e\u963b\u585e I/O"),"\uff1a\u5728\u975e\u963b\u585e I/O \u6a21\u5f0f\u4e0b\uff0cI/O \u64cd\u4f5c\u7acb\u5373\u8fd4\u56de\uff0c\u800c\u4e0d\u5fc5\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\u3002\u5982\u679c\u6570\u636e\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u64cd\u4f5c\u4f1a\u8fd4\u56de\u4e00\u4e2a\u6807\u5fd7\uff08\u5982\u8fd4\u56de ",(0,i.kt)("inlineCode",{parentName:"li"},"-1")," \u6216 ",(0,i.kt)("inlineCode",{parentName:"li"},"EAGAIN"),"\uff09\uff0c\u544a\u77e5\u8c03\u7528\u8005\u6b64\u65f6\u65e0\u6cd5\u5b8c\u6210\u64cd\u4f5c\u3002\u8c03\u7528\u7ebf\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff0c\u5e76\u5728\u7a0d\u540e\u518d\u5c1d\u8bd5\u6267\u884c\u8be5 I/O \u64cd\u4f5c\u3002")),(0,i.kt)("h3",{parentName:"blockquote",id:"\u975e\u963b\u585e-io-\u63d0\u5347\u6027\u80fd\u7684\u539f\u56e0"},"\u975e\u963b\u585e I/O \u63d0\u5347\u6027\u80fd\u7684\u539f\u56e0"),(0,i.kt)("ol",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u63d0\u9ad8\u5e76\u53d1\u6027"),"\uff1a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u963b\u585e I/O"),"\uff1a\u5728\u9ad8\u5e76\u53d1\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u963b\u585e I/O \u7684\u4f20\u7edf\u6a21\u578b\u901a\u5e38\u9700\u8981\u4e3a\u6bcf\u4e2a I/O \u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u7ebf\u7a0b\u3002\u7ebf\u7a0b\u963b\u585e\u65f6\uff0c\u7cfb\u7edf\u8d44\u6e90\uff08\u5982\u5185\u5b58\u548c CPU\uff09\u4f1a\u6d6a\u8d39\u5728\u7b49\u5f85\u64cd\u4f5c\u5b8c\u6210\u4e0a\u3002\u8fd9\u5728\u5904\u7406\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\u65f6\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u74f6\u9888\u3002"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u975e\u963b\u585e I/O"),"\uff1a\u4f7f\u7528\u975e\u963b\u585e I/O\uff0c\u5355\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5904\u7406\u591a\u4e2a I/O \u64cd\u4f5c\u3002\u901a\u8fc7\u4e0d\u65ad\u8f6e\u8be2 I/O \u72b6\u6001\u6216\u7ed3\u5408\u4e8b\u4ef6\u9a71\u52a8\u673a\u5236\uff08\u5982 ",(0,i.kt)("inlineCode",{parentName:"li"},"select"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"poll"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"epoll"),"\uff0c\u6216 ",(0,i.kt)("inlineCode",{parentName:"li"},"kqueue"),"\uff09\uff0c\u7cfb\u7edf\u53ef\u4ee5\u9ad8\u6548\u5730\u5904\u7406\u5927\u91cf\u5e76\u53d1\u8bf7\u6c42\uff0c\u800c\u4e0d\u5fc5\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u72ec\u7acb\u7ebf\u7a0b\uff0c\u4ece\u800c\u964d\u4f4e\u7ebf\u7a0b\u5207\u6362\u7684\u5f00\u9500\u3002"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u51cf\u5c11\u8d44\u6e90\u6d88\u8017"),"\uff1a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u963b\u585e I/O \u6a21\u5f0f\u4e0b\u7684\u7ebf\u7a0b\u53ef\u80fd\u56e0\u4e3a\u963b\u585e\u800c\u6d88\u8017\u4e0d\u5fc5\u8981\u7684\u7cfb\u7edf\u8d44\u6e90\uff08\u5982\u5185\u5b58\u548c CPU \u65f6\u95f4\uff09\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u975e\u963b\u585e I/O \u6a21\u5f0f\u5141\u8bb8\u7ebf\u7a0b\u5728 I/O \u64cd\u4f5c\u672a\u5b8c\u6210\u65f6\u7ee7\u7eed\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff0c\u4ece\u800c\u66f4\u597d\u5730\u5229\u7528 CPU \u8d44\u6e90\u3002\u8fd9\u5728\u5904\u7406 I/O \u5bc6\u96c6\u578b\u4efb\u52a1\u65f6\u5c24\u4e3a\u91cd\u8981\u3002"))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u66f4\u597d\u7684\u54cd\u5e94\u6027"),"\uff1a",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5728\u963b\u585e I/O \u6a21\u5f0f\u4e0b\uff0c\u5982\u679c I/O \u64cd\u4f5c\u9700\u8981\u8f83\u957f\u65f6\u95f4\u624d\u80fd\u5b8c\u6210\uff0c\u8c03\u7528\u7ebf\u7a0b\u5c06\u957f\u65f6\u95f4\u7b49\u5f85\uff0c\u5bfc\u81f4\u7cfb\u7edf\u54cd\u5e94\u53d8\u6162\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u4f7f\u7528\u975e\u963b\u585e I/O\uff0c\u7ebf\u7a0b\u4e0d\u4f1a\u56e0\u4e3a\u5355\u4e2a I/O \u64cd\u4f5c\u800c\u957f\u65f6\u95f4\u505c\u6ede\uff0c\u8fd9\u6709\u52a9\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u6574\u4f53\u54cd\u5e94\u6027\u3002")))),(0,i.kt)("h3",{parentName:"blockquote",id:"\u975e\u963b\u585e-io-\u7684\u5c40\u9650\u6027"},"\u975e\u963b\u585e I/O \u7684\u5c40\u9650\u6027"),(0,i.kt)("p",{parentName:"blockquote"},"\u5c3d\u7ba1\u975e\u963b\u585e I/O \u5728\u8bb8\u591a\u573a\u666f\u4e2d\u80fd\u591f\u63d0\u5347\u6027\u80fd\uff0c\u4f46\u5b83\u4e5f\u5b58\u5728\u4e00\u4e9b\u5c40\u9650\u6027\uff1a"),(0,i.kt)("ol",{parentName:"blockquote"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u590d\u6742\u6027\u589e\u52a0"),"\uff1a\u5b9e\u73b0\u975e\u963b\u585e I/O \u901a\u5e38\u6bd4\u963b\u585e I/O \u66f4\u590d\u6742\u3002\u5f00\u53d1\u8005\u9700\u8981\u5904\u7406 I/O \u72b6\u6001\u7684\u8f6e\u8be2\u6216\u56de\u8c03\u7ba1\u7406\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4ee3\u7801\u66f4\u52a0\u590d\u6742\u548c\u96be\u4ee5\u7ef4\u62a4\u3002"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u8f6e\u8be2\u7684\u5f00\u9500"),"\uff1a\u5728\u6ca1\u6709\u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\u673a\u5236\u7684\u60c5\u51b5\u4e0b\uff0c\u975e\u963b\u585e I/O \u53ef\u80fd\u4f1a\u6d89\u53ca\u8f6e\u8be2\uff08polling\uff09\uff0c\u5373\u4e0d\u65ad\u68c0\u67e5 I/O \u64cd\u4f5c\u662f\u5426\u5b8c\u6210\u3002\u9891\u7e41\u7684\u8f6e\u8be2\u4f1a\u5e26\u6765\u6027\u80fd\u5f00\u9500\uff0c\u56e0\u6b64\uff0c\u5728\u4e0d\u9002\u5f53\u7684\u60c5\u51b5\u4e0b\uff0c\u975e\u963b\u585e I/O \u53ef\u80fd\u53cd\u800c\u964d\u4f4e\u6027\u80fd\u3002"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"\u9002\u7528\u573a\u666f\u6709\u9650"),"\uff1a\u5728\u67d0\u4e9b\u573a\u666f\u4e2d\uff0c\u963b\u585e I/O \u53ef\u80fd\u66f4\u52a0\u5408\u9002\u3002\u4f8b\u5982\uff0c\u5bf9\u4e8e\u5c11\u91cf\u7684 I/O \u64cd\u4f5c\uff0c\u963b\u585e I/O \u7684\u7b80\u5355\u6027\u548c\u4f4e\u590d\u6742\u6027\u53ef\u80fd\u66f4\u6709\u4f18\u52bf\u3002")),(0,i.kt)("h3",{parentName:"blockquote",id:"\u603b\u7ed3"},"\u603b\u7ed3"),(0,i.kt)("p",{parentName:"blockquote"},"\u975e\u963b\u585e I/O \u76f8\u6bd4\u4e8e\u963b\u585e I/O \u901a\u5e38\u80fd\u63d0\u5347\u6027\u80fd\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u3002\u7136\u800c\uff0c\u5177\u4f53\u63d0\u5347\u7684\u5e45\u5ea6\u53d6\u51b3\u4e8e\u5e94\u7528\u573a\u666f\u3001\u5b9e\u73b0\u65b9\u5f0f\u548c\u786c\u4ef6\u8d44\u6e90\u7b49\u591a\u4e2a\u56e0\u7d20\u3002\u5728\u9009\u62e9 I/O \u6a21\u578b\u65f6\uff0c\u5f00\u53d1\u8005\u9700\u8981\u6743\u8861\u6027\u80fd\u63d0\u5347\u4e0e\u4ee3\u7801\u590d\u6742\u6027\u4e4b\u95f4\u7684\u5173\u7cfb\u3002")),(0,i.kt)("h3",{id:"io-\u591a\u8def\u590d\u7528i0-multiplexing"},"IO \u591a\u8def\u590d\u7528\uff08I0 Multiplexing\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u65e0\u8bba\u662f\u963b\u585e I0 \u8fd8\u662f\u975e\u963b\u585e I0\uff0c\u7528\u6237\u5e94\u7528\u5728\u4e00\u9636\u6bb5\u90fd\u9700\u8981\u8c03\u7528 recvfrom \u6765\u83b7\u53d6\u6570\u636e\uff0c\u5dee\u522b\u5728\u4e8e\u65e0\u6570\u636e\u65f6\u7684\u5904\u7406\u65b9\u6848:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u8c03\u7528 recvfrom \u65f6\uff0c\u6070\u597d\u6ca1\u6709\u6570\u636e\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u963b\u585e I0 \u4f1a\u4f7f\u8fdb\u7a0b\u963b\u585e"),"\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u975e\u963b\u585e I0\u4f7fCPU\u7a7a\u8f6c"),"\uff0c\u90fd\u4e0d\u80fd\u5145\u5206\u53d1\u6325 CPU \u7684\u4f5c\u7528"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u8c03\u7528 recvfrom \u65f6\uff0c\u6070\u597d\u6709\u6570\u636e\uff0c\u5219\u7528\u6237\u8fdb\u7a0b\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u7b2c\u4e8c\u9636\u6bb5\uff0c\u8bfb\u53d6\u5e76\u5904\u7406\u6570\u636e"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u6bd4\u5982\u670d\u52a1\u7aef\u5904\u7406\u5ba2\u6237\u7aef Socket \u8bf7\u6c42\u65f6\uff0c\u5728\u5355\u7ebf\u7a0b\u60c5\u51b5\u4e0b\uff0c\u53ea\u80fd\u4f9d\u6b21\u5904\u7406\u6bcf\u4e00\u4e2a Socket \uff0c\u5982\u679c\u6b63\u5728\u5904\u7406\u7684 Socket \u6070\u597d\u672a\u5c31\u7eea(\u6570\u636e\u4e0d\u53ef\u8bfb\u6216\u4e0d\u53ef\u5199)\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u6240\u6709\u5176\u5b83\u5ba2\u6237\u7aef Socket \u90fd\u5fc5\u987b\u7b49\u5f85\uff0c\u6027\u80fd\u81ea\u7136\u4f1a\u5f88\u5dee"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u63d0\u9ad8\u6027\u80fd\u7684\u65b9\u5f0f",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u591a\u7ebf\u7a0b"),(0,i.kt)("li",{parentName:"ol"},"IO \u591a\u8def\u590d\u7528\uff08\u5355\u7ebf\u7a0b\uff09"))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6587\u4ef6\u63cf\u8ff0\u7b26")," (File Descriptor) : \u7b80\u79f0 ",(0,i.kt)("strong",{parentName:"p"},"FD"),"\uff0c\u662f\u4e00\u4e2a\u4ece 0 \u5f00\u59cb\u9012\u589e\u7684\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u7528\u6765\u5173\u8054 Linux \u4e2d\u7684\u4e00\u4e2a\u6587\u4ef6\u3002\u5728 Linux \u4e00\u5207\u7686\u6587\u4ef6\uff0c\u4f8b\u5982\u5e38\u89c4\u6587\u4ef6\u3001\u89c6\u9891\u3001\u786c\u4ef6\u8bbe\u5907\u7b49\uff0c\u5f53\u7136\u4e5f\u5305\u62ec\u7f51\u7edc\u5957\u63a5\u5b57 (Socket) \u4e2d")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"I0 \u591a\u8def\u590d\u7528")," : \u662f\u5229\u7528\u5355\u4e2a\u7ebf\u7a0b\u6765\u540c\u65f6\u76d1\u542c\u591a\u4e2a FD\uff0c\u5e76\u5728\u67d0\u4e2a FD \u53ef\u8bfb\u3001\u53ef\u5199\u65f6\u5f97\u5230\u901a\u77e5\uff0c\u4ece\u800c\u907f\u514d\u65e0\u6548\u7684\u7b49\u5f85\uff0c\u5145\u5206\u5229\u7528CPU\u8d44\u6e90"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u76d1\u542c FD \u7684\u65b9\u5f0f\u3001\u901a\u77e5\u7684\u65b9\u5f0f\u6709\u591a\u79cd\u5b9e\u73b0\uff0c\u5e38\u89c1\u7684\u6709:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"select"),(0,i.kt)("li",{parentName:"ul"},"poll"),(0,i.kt)("li",{parentName:"ul"},"epoll"))),(0,i.kt)("li",{parentName:"ul"},"\u5dee\u5f02:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"select \u548c poll \u53ea\u4f1a\u901a\u77e5\u7528\u6237\u8fdb\u7a0b\u6709 FD \u5c31\u7eea\uff0c\u4f46\u4e0d\u786e\u5b9a\u5177\u4f53\u662f\u54ea\u4e2a FD\uff0c\u9700\u8981\u7528\u6237\u8fdb\u7a0b\u9010\u4e2a\u904d\u5386FD\u6765\u786e\u8ba4"),(0,i.kt)("li",{parentName:"ul"},"epoll \u5219\u4f1a\u5728\u901a\u77e5\u7528\u6237\u8fdb\u7a0b FD \u5c31\u7eea\u7684\u540c\u65f6\uff0c\u628a\u5df2\u5c31\u7eea\u7684 FD \u5199\u5165\u7528\u6237\u7a7a\u95f4")))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240810040840485",src:n(72252).Z,width:"916",height:"466"})))),(0,i.kt)("h4",{id:"1-select"},"1. select"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"select \u662f Linux \u4e2d\u6700\u65e9\u7684 I/0 \u591a\u8def\u590d\u7528\u5b9e\u73b0\u65b9\u6848"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"//\u5b9a\u4e49\u7c7b\u578b\u522b\u540d__fd_mask\uff0c\u672c\u8d28\u662f long int\ntypedef long int __fd_mask;\n\n/*fd_set \u8bb0\u5f55\u8981\u76d1\u542c\u7684fd\u96c6\u5408\uff0c\u53ca\u5176\u5bf9\u5e94\u72b6\u6001 */\ntypedef struct {\n    // fds_bits\u662flong\u7c7b\u578b\u6570\u7ec4\uff0c\u957f\u5ea6\u4e3a 1024/32= 32\n    //\u5171 1024 \u4e2a bit \u4f4d\uff0c\u6bcf\u4e2a bit \u4f4d\u4ee3\u8868\u4e00\u4e2a fd\uff0c0 \u4ee3\u8868\u672a\u5c31\u7eea\uff0c1 \u4ee3\u8868\u5c31\u7eea\n    __fd_mask fds_bits[__FD_SETSIZE /_NFDBITS];\n    // ...\n} fd_set;\n\n// select \u51fd\u6570\uff0c\u7528\u4e8e\u76d1\u542c\u591a\u4e2a fd \u7684\u96c6\u5408\nint select(\n    int nfds\uff0c//\u8981\u76d1\u89c6\u7684fd_set\u7684\u6700\u5927fd + 1\n    fd_set *readfds,  // \u8981\u76d1\u542c\u8bfb\u4e8b\u4ef6\u7684fd\u96c6\u5408\n    fd_set *writefds, // \u8981\u76d1\u542c\u5199\u4e8b\u4ef6\u7684fd\u96c6\u5408\n    fd_set *exceptfds,// \u8981\u76d1\u542c\u5f02\u5e38\u4e8b\u4ef6\u7684fd\u96c6\u5408\n    //\u8d85\u65f6\u65f6\u95f4\uff0cnull-\u6c38\u4e0d\u8d85\u65f6;0-\u4e0d\u963b\u585e\u7b49\u5f85;\u5927\u4e8e0-\u56fa\u5b9a\u7b49\u5f85\u65f6\u95f4\n    struct timeval *timeout\n);\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240810043448890",src:n(23900).Z,width:"631",height:"459"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"select \u6a21\u5f0f\u5b58\u5728\u7684\u95ee\u9898:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u9700\u8981\u5c06\u6574\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"fd_set")," \u4ece\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0cselect \u7ed3\u675f\u8fd8\u8981\u518d\u6b21\u62f7\u8d1d\u56de\u7528\u6237\u7a7a\u95f4"),(0,i.kt)("li",{parentName:"ul"},"select \u65e0\u6cd5\u5f97\u77e5\u5177\u4f53\u662f\u54ea\u4e2a fd \u5c31\u7eea\uff0c\u9700\u8981\u904d\u5386\u6574\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"fd_set")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"fd_set")," \u76d1\u542c\u7684fd\u6570\u91cf\u4e0d\u80fd\u8d85\u8fc7 1024")))),(0,i.kt)("h4",{id:"2-poll"},"2. poll"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"poll \u6a21\u5f0f\u5bf9 select \u6a21\u5f0f\u505a\u4e86\u7b80\u5355\u6539\u8fdb\uff0c\u4f46\u6027\u80fd\u63d0\u5347\u4e0d\u660e\u663e\uff0c\u90e8\u5206\u5173\u952e\u4ee3\u7801\u5982\u4e0b:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"// pollfd \u4e2d\u7684\u4e8b\u4ef6\u7c7b\u578b\n#define POLLIN      //\u53ef\u8bfb\u4e8b\u4ef6\n#define POLLOUT     //\u53ef\u5199\u4e8b\u4ef6\n#define POLLERR     //\u9519\u8bef\u4e8b\u4ef6\n#define POLLNVAL    //fd\u672a\u6253\u5f00\n// pollfd\u7ed3\u6784\nstruct pollfd {\n    int fd;             /* \u8981\u76d1\u542c\u7684fd */\n    short int events;   /* \u5927\u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u7c7b\u578b:\u8bfb\u3001\u5199\u3001\u5f02\u5e38 */\n    short int revents;  /* \u5b9e\u9645\u53d1\u751f\u7684\u4e8b\u4ef6\u7c7b\u578b */\n};\n\n// poll\u51fd\u6570\nint poll(\n    struct pollfd *fds, // pollfd\u6570\u7ec4\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5927\u5c0f\n    nfds_t nfds,        // \u6570\u7ec4\u5143\u7d20\u4e2a\u6570\n    int timeout         //\u8d85\u65f6\u65f6\u95f4\n);\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"IO \u6d41\u7a0b"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u521b\u5efa ",(0,i.kt)("inlineCode",{parentName:"li"},"pollfd")," \u6570\u7ec4\uff0c\u5411\u5176\u4e2d\u6dfb\u52a0\u5173\u6ce8\u7684 fd \u4fe1\u606f\uff0c\u6570\u7ec4\u5927\u5c0f\u81ea\u5b9a\u4e49"),(0,i.kt)("li",{parentName:"ol"},"\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"poll")," \u51fd\u6570\uff0c\u5c06 ",(0,i.kt)("inlineCode",{parentName:"li"},"pollfd")," \u6570\u7ec4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\uff0c\u8f6c\u94fe\u8868\u5b58\u50a8\uff0c\u65e0\u4e0a\u9650"),(0,i.kt)("li",{parentName:"ol"},"\u5185\u6838\u904d\u5386 fd\uff0c\u5224\u65ad\u662f\u5426\u5c31\u7eea"),(0,i.kt)("li",{parentName:"ol"},"\u6570\u636e\u5c31\u7eea\u6216\u8d85\u65f6\u540e\uff0c\u62f7\u8d1d",(0,i.kt)("inlineCode",{parentName:"li"},"pollfd")," \u6570\u7ec4\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u8fd4\u56de\u5c31\u7eea fd \u6570\u91cf n"),(0,i.kt)("li",{parentName:"ol"},"\u7528\u6237\u8fdb\u7a0b\u5224\u65ad n \u662f\u5426\u5927\u4e8e 0"),(0,i.kt)("li",{parentName:"ol"},"\u5927\u4e8e 0 \u5219\u904d\u5386 ",(0,i.kt)("inlineCode",{parentName:"li"},"pollfd")," \u6570\u7ec4\uff0c\u627e\u5230\u5c31\u7eea\u7684 fd"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e0e select \u5bf9\u6bd4:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"select \u6a21\u5f0f\u4e2d\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"fd_set")," \u5927\u5c0f\u56fa\u5b9a\u4e3a 1024\uff0c\u800c ",(0,i.kt)("inlineCode",{parentName:"li"},"pollfd")," \u5728\u5185\u6838\u4e2d\u91c7\u7528\u94fe\u8868\uff0c\u7406\u8bba\u4e0a\u65e0\u4e0a\u9650"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"poll")," \u76d1\u542c\u7684 FD \u8d8a\u591a\uff0c\u6bcf\u6b21\u904d\u5386\u6d88\u8017\u65f6\u95f4\u4e5f\u8d8a\u4e45\uff0c\u6027\u80fd\u53cd\u800c\u4f1a\u4e0b\u964d")))),(0,i.kt)("h4",{id:"3-epoll"},"3. epoll"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"epoll \u6a21\u5f0f\u662f\u5bf9 select \u548c poll \u7684\u6539\u8fdb\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e09\u4e2a\u51fd\u6570:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"struct eventpoll {\n    //...\n    struct rb_root rbr; //\u4e00\u9897\u7ea2\u9ed1\u6811\uff0c\u8bb0\u5f55\u8981\u76d1\u542c\u7684FD\n    struct list_head rdlist;//\u4e00\u4e2a\u94fe\u8868\uff0c\u8bb0\u5f55\u5c31\u7eea\u7684FD\n    //...\n};\n\n//1.\u4f1a\u5728\u5185\u6838\u521b\u5efa eventpoll \u7ed3\u6784\u4f53\uff0c\u8fd4\u56de\u5bf9\u5e94\u7684\u53e5\u67c4epfd\nint epoll_create(int size);\n\n//2.\u5c06\u4e00\u4e2a FD \u6dfb\u52a0\u5230 epoll \u7684\u7ea2\u9ed1\u6811\u4e2d\uff0c\u5e76\u8bbe\u7f6e ep_poll_callback\n// callback \u89e6\u53d1\u65f6\uff0c\u5c31\u628a\u5bf9\u5e94\u7684 FD \u52a0\u5165\u5230 rdlist \u8fd9\u4e2a\u5c31\u7eea\u5217\u8868\u4e2d\nint epoll_ctl(\n    int epfd,epoll,     //\u5b9e\u4f8b\u7684\u53e5\u67c4\n    int op,             //\u8981\u6267\u884c\u7684\u64cd\u4f5c\uff0c\u5305\u62ec:ADD\u3001MOD\u3001DEL\n    int fd,             //\u8981\u76d1\u542c\u7684 FD\n    struct epoll_event *event   // \u8981\u76d1\u542c\u7684\u4e8b\u4ef6\u7c7b\u578b:\u8bfb\u3001\u5199\u3001\u5f02\u5e38\u7b49\n);\n\n//3.\u68c0\u67e5 rdlist \u5217\u8868\u662f\u5426\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u5219\u8fd4\u56de\u5c31\u7eea\u7684 FD \u7684\u6570\u91cf\nint epoll_wait(\n    int epfd,                       //eventpoll\u5b9e\u4f8b\u7684\u53e5\u67c4\n    struct epoll_event *events,     //\u7a7a event \u6570\u7ec4\uff0c\u7528\u4e8e\u63a5\u6536\u5c31\u7eea\u7684FD\n    int maxevents,                  //events \u6570\u7ec4\u7684\u6700\u5927\u957f\u5ea6\n    int timeout                     //\u8d85\u65f6\u65f6\u95f4\uff0c-1\u7528\u4e0d\u8d85\u65f6;\u4e0d\u963b\u585e;\u5927\u4e8e0\u4e3a\u963b\u585e\u65f6\u95f4\n);\n")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240810052151754",src:n(48426).Z,width:"636",height:"569"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"epoll \u6a21\u5f0f\u89e3\u51b3 select \u548c poll \u5b58\u5728\u7684\u95ee\u9898"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u57fa\u4e8e epoll \u5b9e\u4f8b\u4e2d\u7684\u7ea2\u9ed1\u6811\u4fdd\u5b58\u8981\u76d1\u542c\u7684 FD\uff0c\u7406\u8bba\u4e0a\u65e0\u4e0a\u9650\uff0c\u800c\u4e14\u589e\u5220\u6539\u67e5\u6548\u7387\u90fd\u975e\u5e38\u9ad8\uff0c\u6027\u80fd\u4e0d\u4f1a\u968f\u76d1\u542c\u7684 FD \u6570\u91cf\u589e\u591a\u800c\u4e0b\u964d"),(0,i.kt)("li",{parentName:"ul"},"\u6bcf\u4e2a FD \u53ea\u9700\u8981\u6267\u884c\u4e00\u6b21 ",(0,i.kt)("inlineCode",{parentName:"li"},"epoll_ctl")," \u6dfb\u52a0\u5230\u7ea2\u9ed1\u6811\uff0c\u4ee5\u540e\u6bcf\u6b21 ",(0,i.kt)("inlineCode",{parentName:"li"},"epoll_wait")," \u65e0\u9700\u4f20\u9012\u4efb\u4f55\u53c2\u6570\uff0c\u65e0\u9700\u91cd\u590d\u62f7\u8d1d FD \u5230\u5185\u6838\u7a7a\u95f4"),(0,i.kt)("li",{parentName:"ul"},"\u5185\u6838\u4f1a\u5c06\u5c31\u7eea\u7684 FD \u76f4\u63a5\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u7684\u6307\u5b9a\u4f4d\u7f6e\uff0c\u7528\u6237\u8fdb\u7a0b\u65e0\u9700\u904d\u5386\u6240\u6709 FD \u5c31\u80fd\u77e5\u9053\u5c31\u7eea\u7684 FD \u662f\u8c01")))),(0,i.kt)("h5",{id:"\u4e8b\u4ef6\u901a\u77e5\u673a\u5236"},"\u4e8b\u4ef6\u901a\u77e5\u673a\u5236"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5f53 FD \u6709\u6570\u636e\u53ef\u8bfb\u65f6\uff0c\u6211\u4eec\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"epoll_wait")," \u5c31\u53ef\u4ee5\u5f97\u5230\u901a\u77e5\u3002\u4f46\u662f\u4e8b\u4ef6\u901a\u77e5\u7684\u6a21\u5f0f\u6709\u4e24\u79cd",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"LevelTriggered"),": \u7b80\u79f0",(0,i.kt)("strong",{parentName:"li"},"LT"),"\u3002\u5f53 FD \u6709\u6570\u636e\u53ef\u8bfb\u65f6\uff0c\u4f1a\u91cd\u590d\u901a\u77e5\u591a\u6b21\uff0c\u76f4\u81f3\u6570\u636e\u5904\u7406\u5b8c\u6210\u3002\u662f epoll \u7684\u9ed8\u8ba4\u6a21\u5f0f\u3002"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"EdgeTriggered"),": \u7b80\u79f0",(0,i.kt)("strong",{parentName:"li"},"ET"),"\u3002\u5f53 FD \u6709\u6570\u636e\u53ef\u8bfb\u65f6\uff0c\u53ea\u4f1a\u88ab\u901a\u77e5\u4e00\u6b21\uff0c\u4e0d\u7ba1\u6570\u636e\u662f\u5426\u5904\u7406\u5b8c\u6210\u3002"))),(0,i.kt)("li",{parentName:"ul"},"ET \u6a21\u5f0f\u907f\u514d\u4e86 LT \u6a21\u5f0f\u53ef\u80fd\u51fa\u73b0\u7684",(0,i.kt)("strong",{parentName:"li"},"\u60ca\u7fa4\u73b0\u8c61")),(0,i.kt)("li",{parentName:"ul"},"ET \u6a21\u5f0f\u6700\u597d\u7ed3\u5408",(0,i.kt)("strong",{parentName:"li"},"\u975e\u963b\u585e I0 "),"\u8bfb\u53d6 FD \u6570\u636e\uff0c\u76f8\u6bd4LT\u4f1a\u590d\u6742\u4e00\u4e9b")),(0,i.kt)("h5",{id:"\u57fa\u4e8e-epoll-\u6a21\u5f0f\u7684-web-\u670d\u52a1\u7684\u57fa\u672c\u6d41\u7a0b"},"\u57fa\u4e8e epoll \u6a21\u5f0f\u7684 web \u670d\u52a1\u7684\u57fa\u672c\u6d41\u7a0b"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20240811075309634",src:n(9458).Z,width:"1346",height:"565"})),(0,i.kt)("h3",{id:"\u4fe1\u53f7\u9a71\u52a8-iosignal-driven-l0"},"\u4fe1\u53f7\u9a71\u52a8 IO\uff08Signal Driven l0\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4fe1\u53f7\u9a71\u52a8 I0 \u662f\u4e0e\u5185\u6838\u5efa\u7acb SIGI0 \u7684\u4fe1\u53f7\u5173\u8054\u5e76\u8bbe\u7f6e\u56de\u8c03\uff0c\u5f53\u5185\u6838\u6709 FD \u5c31\u7eea\u65f6\uff0c\u4f1a\u53d1\u51fa SIGIO \u4fe1\u53f7\u901a\u77e5\u7528\u6237\uff0c\u671f\u95f4\u7528\u6237\u5e94\u7528\u53ef\n\u4ee5\u6267\u884c\u5176\u5b83\u4e1a\u52a1\uff0c\u65e0\u9700\u963b\u585e\u7b49\u5f85"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240811075918751",src:n(91857).Z,width:"825",height:"440"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u7f3a\u70b9"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5f53\u6709\u5927\u91cf I0 \u64cd\u4f5c\u65f6\uff0c\u4fe1\u53f7\u8f83\u591a\uff0cSIGIO \u5904\u7406\u51fd\u6570\u4e0d\u80fd\u53ca\u65f6\u5904\u7406\u53ef\u80fd\u5bfc\u81f4\u4fe1\u53f7\u961f\u5217\u6ea2\u51fa"),(0,i.kt)("li",{parentName:"ul"},"\u800c\u4e14\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u9891\u7e41\u4fe1\u53f7\u4ea4\u4e92\u6027\u80fd\u4e5f\u8f83\u4f4e")))),(0,i.kt)("h3",{id:"\u5f02\u6b65-i0-asynchronous-i0"},"\u5f02\u6b65 I0 \uff08Asynchronous I0\uff09"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f02\u6b65 I0 \u7684\u6574\u4e2a\u8fc7\u7a0b\u90fd\u662f\u975e\u963b\u585e\u7684\uff0c\u7528\u6237\u8fdb\u7a0b\u8c03\u7528\u5b8c\u5f02\u6b65 API \u540e\u5c31\u53ef\u4ee5\u53bb\u505a\u5176\u5b83\u4e8b\u60c5\uff0c\u5185\u6838\u7b49\u5f85\u6570\u636e\u5c31\u7eea\u5e76\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u540e\u624d\u4f1a\u9012\u4ea4\u4fe1\u53f7\uff0c\u901a\u77e5\u7528\u6237\u8fdb\u7a0b"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240811080659245",src:n(8228).Z,width:"955",height:"470"})))),(0,i.kt)("h5",{id:"\u540c\u6b65-io-\u548c\u5f02\u6b65-io"},"\u540c\u6b65 IO \u548c\u5f02\u6b65 IO"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"I0 \u64cd\u4f5c\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65\uff0c\u5173\u952e\u770b\u6570\u636e\u5728\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684",(0,i.kt)("strong",{parentName:"p"},"\u62f7\u8d1d\u8fc7\u7a0b"),"(\u6570\u636e\u8bfb\u5199\u7684 I0 \u64cd\u4f5c)\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u9636\u6bb5\u662f\u540c\u6b65\u8fd8\u662f\u5f02\u6b65")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4e94\u4e2a I/0 \u6a21\u578b\u7684\u6bd4\u8f83"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240811081034797",src:n(10457).Z,width:"877",height:"519"})))),(0,i.kt)("h3",{id:"redis-\u7f51\u7edc\u6a21\u578b"},"Redis \u7f51\u7edc\u6a21\u578b"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u901a\u8fc7 ",(0,i.kt)("strong",{parentName:"p"},"I0 \u591a\u8def\u590d\u7528"),"\u6765\u63d0\u9ad8\u7f51\u7edc\u6027\u80fd\uff0c\u5e76\u4e14\u652f\u6301\u5404\u79cd\u4e0d\u540c\u7684\u591a\u8def\u590d\u7528\u5b9e\u73b0\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e9b\u5b9e\u73b0\u8fdb\u884c\u5c01\u88c5\uff0c\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\n\u9ad8\u6027\u80fd\u4e8b\u4ef6\u5e93 API \u5e93",(0,i.kt)("inlineCode",{parentName:"p"},"ae"),"\uff0c\u66b4\u9732\u4e86\u7edf\u4e00\u7684 IO \u591a\u8def\u590d\u7528 API"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ae_epoll.c"),"\uff1aLinux \u64cd\u4f5c\u7cfb\u7edf\u7684\u5b9e\u73b0\u65b9\u6848"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ae_evport.c"),"\uff1aSolaris \u64cd\u4f5c\u7cfb\u7edf\u7684\u5b9e\u73b0\u65b9\u6848"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ae_kqueue.c"),"\uff1a\u7c7b UNIX \u64cd\u4f5c\u7cfb\u7edf\u7684\u5b9e\u73b0\u65b9\u6848\uff08mac os\u3001FreeBSD\u3001OpenBSD\u3001NetBSD\uff09"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ae_select.c"),"\uff1a\u9664\u4e86\u4ee5\u4e0a\u64cd\u4f5c\u7cfb\u7edf\u7684\u901a\u7528\u5b9e\u73b0\u65b9\u6848")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240811083822304",src:n(46226).Z,width:"272",height:"162"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u51e0\u4e2a\u6838\u5fc3\u7684 API"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"API \u65b9\u6cd5"),(0,i.kt)("th",{parentName:"tr",align:null},"\u8bf4\u660e"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"static int aeApiCreate(aeEventLoop *eventLoop)")),(0,i.kt)("td",{parentName:"tr",align:null},"\u521b\u5efa\u591a\u8def\u590d\u7528\u7a0b\u5e8f\uff0c\u6bd4\u5982 ",(0,i.kt)("inlineCode",{parentName:"td"},"epoll_create"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"static int aeApiAddEvent(aeEventLoop *eventLoop, int fd, int mask)")),(0,i.kt)("td",{parentName:"tr",align:null},"\u6ce8\u518cFD\uff0c\u6bd4\u5982 ",(0,i.kt)("inlineCode",{parentName:"td"},"epoll_ctl"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"static void aeApiDelEvent(aeEventLoop *eventLoop, int fd, int delmask)")),(0,i.kt)("td",{parentName:"tr",align:null},"\u5220\u9664FD")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"static int aeApiPoll(aeEventLoop *eventLoop, struct timeval *tvp)")),(0,i.kt)("td",{parentName:"tr",align:null},"\u7b49\u5f85FD\u5c31\u7eea\uff0c\u6bd4\u5982 ",(0,i.kt)("inlineCode",{parentName:"td"},"epoll_wait"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"static char *aeApiName(void)")),(0,i.kt)("td",{parentName:"tr",align:null}))))))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u5355\u7ebf\u7a0b\u7f51\u7edc\u6a21\u578b\u7684\u6574\u4e2a\u6d41\u7a0b"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u6e90\u7801\u9605\u8bfb\u4ece ",(0,i.kt)("inlineCode",{parentName:"li"},"server.c"),"  \u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"main")," \u65b9\u6cd5\u5f00\u59cb",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u8c03\u7528\u4e86",(0,i.kt)("inlineCode",{parentName:"li"},"initServer();"),"\u65b9\u6cd5\uff0c\u521d\u59cb\u5316\u670d\u52a1"),(0,i.kt)("li",{parentName:"ul"},"\u8c03\u7528\u4e86 ",(0,i.kt)("inlineCode",{parentName:"li"},"aeMain(server.el);"),"\uff0c\u5f00\u59cb\u76d1\u542c\u4e8b\u4ef6\u5faa\u73af")))),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240812091711496",src:n(33161).Z,width:"1382",height:"589"}))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis 6.0 \u7248\u672c\u4e2d\u5f15\u5165\u4e86",(0,i.kt)("strong",{parentName:"p"},"\u591a\u7ebf\u7a0b"),"\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u9ad8 I0 \u8bfb\u5199\u6548\u7387"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u547d\u4ee4\u8bf7\u6c42\u5904\u7406\u5668"),"\u6d89\u53ca\u5230\u547d\u4ee4\u7684\u8bfb\u53d6\uff0c\u4f1a\u53d7\u5230\u7f51\u7edc\u72b6\u6001\u3001\u5e26\u5bbd\u7684\u5f71\u54cd\uff0c\u6027\u80fd\u76f8\u5bf9\u4f1a\u5dee\u4e9b"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u547d\u4ee4\u6062\u590d\u5904\u7406\u5668"),"\u6d89\u53ca\u5230\u628a\u7ed3\u679c\u5199\u4f1a\u5ba2\u6237\u7aef\uff0c\u4e5f\u4f1a\u53d7\u5230\u7f51\u7edc\u72b6\u6001\u3001\u5e26\u5bbd\u7684\u5f71\u54cd\uff0c\u6027\u80fd\u76f8\u5bf9\u4f1a\u5dee\u4e9b"),(0,i.kt)("li",{parentName:"ul"},"\u56e0\u6b64\u5728",(0,i.kt)("strong",{parentName:"li"},"\u89e3\u6790\u5ba2\u6237\u7aef\u547d\u4ee4"),"\u3001",(0,i.kt)("strong",{parentName:"li"},"\u5199\u54cd\u5e94\u7ed3\u679c"),"\u65f6\u91c7\u7528\u4e86\u591a\u7ebf\u7a0b\u3002\u6838\u5fc3\u7684\u547d\u4ee4\u6267\u884c I0 \u591a\u8def\u590d\u7528\u6a21\u5757\u4f9d\u7136\u662f\u7531\u4e3b\u7ebf\u7a0b\u6267\u884c")),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240812092722397",src:n(51608).Z,width:"1414",height:"577"})))),(0,i.kt)("h5",{id:"redis-\u5230\u5e95\u662f\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b"},"Redis \u5230\u5e95\u662f\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b?"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u4ec5\u4ec5\u804a Redis \u7684\u6838\u5fc3\u4e1a\u52a1\u90e8\u5206(\u547d\u4ee4\u5904\u7406)\uff0c\u7b54\u6848\u662f\u5355\u7ebf\u7a0b"),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u662f\u804a\u6574\u4e2a Redis\uff0c\u90a3\u4e48\u7b54\u6848\u5c31\u662f\u591a\u7ebf\u7a0b"),(0,i.kt)("li",{parentName:"ul"},"\u5728Redis\u7248\u672c\u8fed\u4ee3\u8fc7\u7a0b\u4e2d\uff0c\u5728\u4e24\u4e2a\u91cd\u8981\u7684\u65f6\u95f4\u8282\u70b9\u4e0a\u5f15\u5165\u4e86\u591a\u7ebf\u7a0b\u7684\u652f\u6301:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Redis v4.0:\u5f15\u5165\u591a\u7ebf\u7a0b\u5f02\u6b65\u5904\u7406\u4e00\u4e9b\u8017\u65f6\u8f83\u957f\u7684\u4efb\u52a1\uff0c\u4f8b\u5982\u5f02\u6b65\u5220\u9664\u547d\u4ee4unlink"),(0,i.kt)("li",{parentName:"ul"},"Redis v6.0:\u5728\u6838\u5fc3\u7f51\u7edc\u6a21\u578b\u4e2d\u5f15\u5165\u591a\u7ebf\u7a0b\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u5bf9\u4e8e\u591a\u6838CPU\u7684\u5229\u7528\u7387"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u4e3a\u4ec0\u4e48 Redis \u8981\u9009\u62e9\u5355\u7ebf\u7a0b?"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u629b\u5f00\u6301\u4e45\u5316\u4e0d\u8c08\uff0cRedis \u662f\u7eaf\u5185\u5b58\u64cd\u4f5c\uff0c\u6267\u884c\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5b83\u7684\u6027\u80fd\u74f6\u9888\u662f\u7f51\u7edc\u5ef6\u8fdf\u800c\u4e0d\u662f\u6267\u884c\u901f\u5ea6\uff0c\u56e0\u6b64\u591a\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u5e26\u6765\u5de8\u5927\u7684\u6027\u80fd\u63d0\u5347\u3002"),(0,i.kt)("li",{parentName:"ul"},"\u591a\u7ebf\u7a0b\u4f1a\u5bfc\u81f4\u8fc7\u591a\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u5f00\u9500"),(0,i.kt)("li",{parentName:"ul"},"\u5f15\u5165\u591a\u7ebf\u7a0b\u4f1a\u9762\u4e34\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\uff0c\u5fc5\u7136\u8981\u5f15\u5165\u7ebf\u7a0b\u9501\u8fd9\u6837\u7684\u5b89\u5168\u624b\u6bb5\uff0c\u5b9e\u73b0\u590d\u6742\u5ea6\u589e\u9ad8\uff0c\u800c\u4e14\u6027\u80fd\u4e5f\u4f1a\u5927\u6253\u6298\u6263")))),(0,i.kt)("h2",{id:"\u4e09\u901a\u4fe1\u534f\u8bae"},"\u4e09\u3001\u901a\u4fe1\u534f\u8bae"),(0,i.kt)("h3",{id:"resp-\u534f\u8bae"},"RESP \u534f\u8bae"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Redis \u662f\u4e00\u4e2a CS \u67b6\u6784\u7684\u8f6f\u4ef6\uff0c\u901a\u4fe1\u4e00\u822c\u5206\u4e24\u6b65(\u4e0d\u5305\u62ec ",(0,i.kt)("inlineCode",{parentName:"li"},"pipeline")," \u548c ",(0,i.kt)("inlineCode",{parentName:"li"},"PubSub"),")",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u5ba2\u6237\u7aef(client)\u5411\u670d\u52a1\u7aef(server)\u53d1\u9001\u4e00\u6761\u547d\u4ee4"),(0,i.kt)("li",{parentName:"ol"},"\u670d\u52a1\u7aef\u89e3\u6790\u5e76\u6267\u884c\u547d\u4ee4\uff0c\u8fd4\u56de\u54cd\u5e94\u7ed3\u679c\u7ed9\u5ba2\u6237\u7aef"))),(0,i.kt)("li",{parentName:"ul"},"\u56e0\u6b64\u5ba2\u6237\u7aef\u53d1\u9001\u547d\u4ee4\u7684\u683c\u5f0f\u3001\u670d\u52a1\u7aef\u54cd\u5e94\u7ed3\u679c\u7684\u683c\u5f0f\u5fc5\u987b\u6709\u4e00\u4e2a\u89c4\u8303\uff0c\u8fd9\u4e2a\u89c4\u8303\u5c31\u662f\u901a\u4fe1\u534f\u8bae",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u800c\u5728 Redis \u4e2d\u91c7\u7528\u7684\u662f RESP(Redis Serialization Protocol) \u534f\u8bae:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Redis 1.2 \u7248\u672c\u5f15\u5165\u4e86 RESP \u534f\u8bae"),(0,i.kt)("li",{parentName:"ul"},"Redis 2.0 \u7248\u672c\u4e2d\u6210\u4e3a\u4e0eRedis\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u6807\u51c6\uff0c\u79f0\u4e3a RESP2"),(0,i.kt)("li",{parentName:"ul"},"Redis 6.0 \u7248\u672c\u4e2d\uff0c\u4ece RESP2 \u5347\u7ea7\u5230\u4e86 RESP3 \u534f\u8bae\uff0c\u589e\u52a0\u4e86\u66f4\u591a\u6570\u636e\u7c7b\u578b\u5e76\u4e14\u652f\u6301 6.0 \u7684\u65b0\u7279\u6027--\u5ba2\u6237\u7aef\u7f13\u5b58"))),(0,i.kt)("li",{parentName:"ul"},"\u4f46\u76ee\u524d\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u4f9d\u7136\u662f RESP2 \u534f\u8bae")))),(0,i.kt)("h3",{id:"resp-\u6570\u636e\u7c7b\u578b"},"RESP \u6570\u636e\u7c7b\u578b"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728 RESP \u4e2d\uff0c\u901a\u8fc7",(0,i.kt)("strong",{parentName:"p"},"\u9996\u5b57\u8282\u7684\u5b57\u7b26"),"\u6765\u533a\u5206\u4e0d\u540c\u6570\u636e\u7c7b\u578b\uff0c\u5e38\u7528\u7684\u6570\u636e\u7c7b\u578b\u5305\u62ec5\u79cd"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5355\u884c\u5b57\u7b26\u4e32"),": \u9996\u5b57\u8282\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"+"),"\uff0c\u540e\u9762\u8ddf\u4e0a\u5355\u884c\u5b57\u7b26\u4e32\uff0c\u4ee5",(0,i.kt)("inlineCode",{parentName:"p"},'CRLF("\\r\\n")'),'\u7ed3\u5c3e\u3002\u4f8b\u5982\u8fd4\u56de "OK": ',(0,i.kt)("inlineCode",{parentName:"p"},"+OK\\r\\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u9519\u8bef(Errors)"),": \u9996\u5b57\u8282\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"-"),"\uff0c\u4e0e\u5355\u884c\u5b57\u7b26\u4e32\u683c\u5f0f\u4e00\u6837\uff0c\u53ea\u662f\u5b57\u7b26\u4e32\u662f\u5f02\u5e38\u4fe1\u606f\uff0c\u4f8b\u5982: ",(0,i.kt)("inlineCode",{parentName:"p"},"-Error message\\r\\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6570\u503c"),": \u9996\u5b57\u8282\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},":"),"\uff0c\u540e\u9762\u8ddf\u4e0a\u6570\u5b57\u683c\u5f0f\u7684\u5b57\u7b26\u4e32\uff0c\u4ee5 ",(0,i.kt)("inlineCode",{parentName:"p"},"CRLF")," \u7ed3\u5c3e\u3002\u4f8b\u5982: ",(0,i.kt)("inlineCode",{parentName:"p"},":10\\r\\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u591a\u884c\u5b57\u7b26\u4e32"),": \u9996\u5b57\u8282\u662f",(0,i.kt)("inlineCode",{parentName:"p"},"$"),"\uff0c\u8868\u793a\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\u5b57\u7b26\u4e32\uff0c\u6700\u5927\u652f\u6301512MB:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240819192955202",src:n(52348).Z,width:"471",height:"156"})),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u5b57\u7b26\u4e32\u5927\u5c0f\u4e3a 0\uff0c\u5219\u4ee3\u8868\u7a7a\u5b57\u7b26\u4e32: ",(0,i.kt)("inlineCode",{parentName:"li"},"$0\\r\\n\\r\\n")),(0,i.kt)("li",{parentName:"ul"},"\u5982\u679c\u5b57\u7b26\u4e32\u5927\u5c0f\u4e3a -1\uff0c\u5219\u4ee3\u8868\u4e0d\u5b58\u5728: ",(0,i.kt)("inlineCode",{parentName:"li"},"$-r\\n")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u6570\u7ec4"),": \u9996\u5b57\u8282\u662f ",(0,i.kt)("inlineCode",{parentName:"p"},"*"),"\uff0c\u540e\u9762\u8ddf\u4e0a\u6570\u7ec4\u5143\u7d20\u4e2a\u6570\uff0c\u518d\u8ddf\u4e0a\u5143\u7d20\uff0c\u5143\u7d20\u6570\u636e\u7c7b\u578b\u4e0d\u9650:"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240819193322169",src:n(19424).Z,width:"630",height:"225"})))))),(0,i.kt)("h3",{id:"\u6a21\u62df-redis-\u5ba2\u6237\u7aef"},"\u6a21\u62df Redis \u5ba2\u6237\u7aef"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u4f7f\u7528 Java \u6839\u636e resp \u534f\u8bae\u6a21\u62df\u4e00\u4e2a Redis \u5ba2\u6237\u7aef")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u57fa\u672c\u6d41\u7a0b"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u5efa\u7acb\u8fde\u63a5"),(0,i.kt)("li",{parentName:"ol"},"\u83b7\u53d6\u8f93\u5165\u6d41\u3001\u8f93\u51fa\u6d41"),(0,i.kt)("li",{parentName:"ol"},"\u53d1\u51fa\u8bf7\u6c42\uff08redis \u547d\u4ee4\uff09"),(0,i.kt)("li",{parentName:"ol"},"\u89e3\u6790\u54cd\u5e94"),(0,i.kt)("li",{parentName:"ol"},"\u91ca\u653e\u8fde\u63a5")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-java"},'public class Main {\n    static String host = "192.168.136.xxx";\n    static int port = 6379;\n    static Socket socket;\n    static PrintWriter writer;\n    static BufferedReader reader;\n    public static void main(String[] args) {\n\n        try {\n            //1. \u5efa\u7acb\u8fde\u63a5\n            socket = new Socket(host, port);\n            System.out.println("\u8fde\u63a5\u6210\u529f");\n            //2. \u83b7\u53d6\u8f93\u5165\u6d41\u3001\u8f93\u51fa\u6d41\n            writer = new PrintWriter(new OutputStreamWriter(socket.getOutputStream(), StandardCharsets.UTF_8));\n            // \u6b64\u5904\u76ee\u7684\u662f\u5b9e\u73b0 resp \u534f\u8bae\uff0c\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528\u5b57\u7b26\u6d41\u6309\u884c\u8bfb\u53d6\uff1b\u6309\u7406\u6765\u8bf4\u5e94\u8be5\u4f7f\u7528\u5b57\u8282\u6d41\uff0c\u56e0\u4e3a\u8fd4\u56de\u7684\u7ed3\u679c\u662f\u4e8c\u8fdb\u5236\u5b89\u5168\u7684\uff0c\u9700\u8981\u6309\u5b57\u8282\u8bfb\u53d6\n            reader = new BufferedReader(new InputStreamReader(socket.getInputStream(), StandardCharsets.UTF_8));\n\n            //3. \u53d1\u51fa\u8bf7\u6c42\uff08redis \u547d\u4ee4\uff09\n            sendRequest("auth","222333");\n            System.out.println("\u5bc6\u7801\u9a8c\u8bc1");\n            //4. \u89e3\u6790\u54cd\u5e94\n            Object o = handelResponse();\n            System.out.println(o);\n\n            sendRequest("set","name","lhk");\n            o = handelResponse();\n            System.out.println(o);\n\n            sendRequest("get","name");\n            o = handelResponse();\n            System.out.println(o);\n\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }finally {\n            //5. \u91ca\u653e\u8fde\u63a5\n           if (socket != null) {\n               try {\n                   socket.close();\n               } catch (IOException e) {\n                   throw new RuntimeException(e);\n               }\n           }\n           if (reader != null) {\n               try {\n                   reader.close();\n               } catch (IOException e) {\n                   throw new RuntimeException(e);\n               }\n           }\n           if (writer != null) writer.close();\n        }\n\n    }\n\n    private static Object handelResponse() throws IOException {\n        int firstByte = reader.read();\n        switch (firstByte) {\n            case \'+\':\n                // \u5355\u884c\u5b57\u7b26\u4e32\uff0c\u76f4\u63a5\u8bfb\u4e00\u884c\n                return reader.readLine();\n            case \'-\':\n                // \u9519\u8bef\u4fe1\u606f, \u76f4\u63a5\u8bfb\u4e00\u884c\u5e76\u629b\u51fa\n                throw new RuntimeException(reader.readLine());\n            case \':\':\n                // \u6570\u5b57\n                return Long.parseLong(reader.readLine());\n            case \'$\' :\n                // \u591a\u884c\u5b57\u7b26\u4e32\uff0c\u5148\u8bfb\u957f\u5ea6\uff0c\u518d\u8bfb\u6570\u636e\n                int len = Integer.parseInt(reader.readLine());\n                if (len == -1) return null;\n                if (len == 0) return "";\n                return reader.readLine();\n            case \'*\' :\n                // \u6570\u7ec4\n                return readBulkString();\n            default:\n                throw new RuntimeException("\u534f\u8bae\u9519\u8bef");\n        }\n    }\n\n    private static List<Object> readBulkString() throws IOException {\n        //\u83b7\u53d6\u6570\u7ec4\u5927\u5c0f\n        int len = Integer.parseInt(reader.readLine());\n        if (len <= 0) return null;\n        ArrayList<Object> objects = new ArrayList<>();\n        for (int i = 0; i < len; i++) {\n            objects.add(handelResponse());\n        }\n        return objects;\n    }\n\n    private static void sendRequest(String ... args) throws IOException {\n        int length = args.length;\n        writer.println("*" + length);   // \u6570\u7ec4\u957f\u5ea6\n        for (String arg : args) {\n            writer.println("$" + arg.getBytes(StandardCharsets.UTF_8).length);  // \u6bcf\u4e2a\u547d\u4ee4\u5b57\u7b26\u4e32\u5b57\u8282\u957f\u5ea6\n            writer.println(arg);    // \u547d\u4ee4\u5b57\u7b26\u4e32\n        }\n        writer.flush();     // \u5199\u51fa\u6570\u636e\n    }\n}\n\n')))),(0,i.kt)("h2",{id:"\u56db\u5185\u5b58\u7b56\u7565"},"\u56db\u3001\u5185\u5b58\u7b56\u7565"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u4e4b\u6240\u4ee5\u6027\u80fd\u5f3a\uff0c\u6700\u4e3b\u8981\u7684\u539f\u56e0\u5c31\u662f\u57fa\u4e8e\u5185\u5b58\u5b58\u50a8\u3002\u7136\u800c\u5355\u8282\u70b9\u7684 Redis \u5176\u5185\u5b58\u5927\u5c0f\u4e0d\u5b9c\u8fc7\u5927\uff0c\u4f1a\u5f71\u54cd\u6301\u4e45\u5316\u6216\u4e3b\u4ece\u540c\u6b65\u6027\u80fd")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u6765\u8bbe\u7f6e Redis \u7684\u6700\u5927\u5185\u5b58"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"maxmemory 1gb\n")))),(0,i.kt)("h3",{id:"\u8fc7\u671f\u7b56\u7565"},"\u8fc7\u671f\u7b56\u7565"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u53ef\u4ee5\u901a\u8fc7 ",(0,i.kt)("inlineCode",{parentName:"p"},"expire")," \u547d\u4ee4\u7ed9 Redis \u7684 key \u8bbe\u7f6e TTL (\u5b58\u6d3b\u65f6\u95f4)"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5f53 key \u7684 TTL \u5230\u671f\u4ee5\u540e\uff0c\u518d\u6b21\u8bbf\u95ee key \u8fd4\u56de\u7684\u662f ",(0,i.kt)("inlineCode",{parentName:"li"},"nil"),"\uff0c\u8bf4\u660e\u8fd9\u4e2a key \u5df2\u7ecf\u4e0d\u5b58\u5728\u4e86\uff0c\u5bf9\u5e94\u7684\u5185\u5b58\u4e5f\u5f97\u5230\u91ca\u653e\u3002\u4ece\u800c\u8d77\u5230\u5185\u5b58\u56de\u6536\u7684\u76ee\u7684"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u8003\u8651\u4e24\u4e2a\u95ee\u9898"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Redis \u662f\u5982\u4f55\u77e5\u9053\u4e00\u4e2a key \u662f\u5426\u8fc7\u671f\u5462",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5229\u7528\u4e24\u4e2aDict\u5206\u522b\u8bb0\u5f55key-value\u5bf9\u53cakey-TTL\u5bf9",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"expires"),"\u8fd9\u4e2a\u5b57\u5178\u91cc\u9762\u8bb0\u5f55\u4e86 key-TTL"))))),(0,i.kt)("li",{parentName:"ul"},"\u662f\u4e0d\u662fTTL\u5230\u671f\u5c31\u7acb\u5373\u5220\u9664\u4e86\u5462",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u60f0\u6027\u5220\u9664"),(0,i.kt)("li",{parentName:"ul"},"\u5468\u671f\u5220\u9664")))))),(0,i.kt)("h4",{id:"reids-\u7684-db-\u7ed3\u6784"},"reids \u7684 DB \u7ed3\u6784"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Redis \u672c\u8eab\u662f\u4e00\u4e2a\u5178\u578b\u7684 key-value \u5185\u5b58\u5b58\u50a8\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u6240\u6709\u7684 key\u3001value \u90fd\u4fdd\u5b58\u5728\u4e4b\u524d\u5b66\u4e60\u8fc7\u7684 ",(0,i.kt)("inlineCode",{parentName:"li"},"Dict")," \u7ed3\u6784\u4e2d\u3002\u4e0d\u8fc7\u5728\u5176 database \u7ed3\u6784\u4f53\u4e2d\uff0c\u6709\u4e24\u4e2a ",(0,i.kt)("inlineCode",{parentName:"li"},"Dict")," :",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u4e00\u4e2a\u7528\u6765\u8bb0\u5f55 key-value"),(0,i.kt)("li",{parentName:"ul"},"\u53e6\u4e00\u4e2a\u7528\u6765\u8bb0\u5f55 key-TTL")))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-c"},"/* Redis database representation. There are multiple databases identified\n * by integers from 0 (the default database) up to the max configured\n * database. The database number is the 'id' field in the structure. */\ntypedef struct redisDb {\n    /*\u5b58\u653e\u6240\u6709key\u53cavalue\u7684\u5730\u65b9\uff0c\u4e5f\u88ab\u79f0\u4e3akeyspace*/\n    dict *dict;                 /* The keyspace for this DB */\n    /*\u5b58\u653e\u6bcf\u4e00\u4e2akey\u53ca\u5176\u5bf9\u5e94\u7684TTL\u5b58\u6d3b\u65f6\u95f4\uff0c\u53ea\u5305\u542b\u8bbe\u7f6e\u4e86TTL\u7684key*/\n    dict *expires;              /* Timeout of keys with a timeout set */\n    dict *blocking_keys;        /* Keys with clients waiting for data (BLPOP)*/\n    dict *ready_keys;           /* Blocked keys that received a PUSH */\n    dict *watched_keys;         /* WATCHED keys for MULTI/EXEC CAS */\n    int id;                     /* Database ID */\n    /* \u8bb0\u5f55\u5e73\u5747TTL\u65f6\u957f */\n    long long avg_ttl;          /* Average TTL, just for stats */\n    /* expire\u68c0\u67e5\u65f6\u5728dict\u4e2d\u62bd\u6837\u7684\u7d22\u5f15\u4f4d\u7f6e */\n    unsigned long expires_cursor; /* Cursor of the active expire cycle. */\n    /* \u7b49\u5f85\u788e\u7247\u6574\u7406\u7684key\u5217\u8868 */\n    list *defrag_later;         /* List of key names to attempt to defrag one by one, gradually. */\n} redisDb;\n")),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"image-20240825033403204",src:n(55265).Z,width:"1086",height:"526"})),(0,i.kt)("h4",{id:"\u60f0\u6027\u5220\u9664"},"\u60f0\u6027\u5220\u9664"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u60f0\u6027\u5220\u9664"),": \u987e\u660e\u601d\u8bae\u5e76\u4e0d\u662f\u5728 TTL \u5230\u671f\u540e\u5c31\u7acb\u523b\u5220\u9664\uff0c\u800c\u662f\u5728\u8bbf\u95ee\u4e00\u4e2a key \u7684\u65f6\u5019\uff0c\u68c0\u67e5\u8be5 key \u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u5982\u679c\u5df2\u7ecf\u8fc7\u671f\u624d\u6267\u884c\u5220\u9664",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"\u5b58\u5728\u4f1a\u6709\u4e00\u4e9b\u8fc7\u671f\u4e86\u4f46\u662f\u672a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u4e00\u76f4\u672a\u88ab\u5220\u9664")))),(0,i.kt)("h4",{id:"\u5468\u671f\u5220\u9664"},"\u5468\u671f\u5220\u9664"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"\u5468\u671f\u5220\u9664"),": \u987e\u660e\u601d\u8bae\u662f\u901a\u8fc7\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u5468\u671f\u6027\u7684\u62bd\u6837\u90e8\u5206\u8fc7\u671f\u7684 key\uff0c\u7136\u540e\u6267\u884c\u5220\u9664\u3002\u6267\u884c\u5468\u671f\u6709\u4e24\u79cd:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"Redis \u521d\u59cb\u5316\u65f6\u4f1a\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u4f4f\u52a1 ",(0,i.kt)("inlineCode",{parentName:"li"},"serverCron()"),"\uff0c\u6309\u7167 ",(0,i.kt)("inlineCode",{parentName:"li"},"server.hz")," \u7684\u9891\u7387\u6765\u6267\u884c\u8fc7\u671f key \u6e05\u7406\uff0c\u6a21\u5f0f\u4e3a ",(0,i.kt)("strong",{parentName:"li"},"SLOW")),(0,i.kt)("li",{parentName:"ol"},"Redis \u7684\u6bcf\u4e2a\u4e8b\u4ef6\u5faa\u73af\u524d\u4f1a\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"li"},"beforeSleep()")," \u51fd\u6570\uff0c\u6267\u884c\u8fc7\u671f key \u6e05\u7406\uff0c\u6a21\u5f0f\u4e3a ",(0,i.kt)("strong",{parentName:"li"},"FAST")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"SLOW")," \u6a21\u5f0f\u89c4\u5219:",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u6267\u884c\u9891\u7387\u53d7 ",(0,i.kt)("inlineCode",{parentName:"li"},"server.hz")," \u5f71\u54cd\uff0c\u9ed8\u8ba4\u4e3a 10\uff0c\u5373\u6bcf\u79d2\u6267\u884c 10 \u6b21\uff0c\u6bcf\u4e2a\u6267\u884c\u5468\u671f 100ms"),(0,i.kt)("li",{parentName:"ol"},"\u6267\u884c\u6e05\u7406\u8017\u65f6\u4e0d\u8d85\u8fc7\u4e00\u6b21\u6267\u884c\u5468\u671f\u7684 25%."),(0,i.kt)("li",{parentName:"ol"},"\u9010\u4e2a\u904d\u5386 db\uff0c\u9010\u4e2a\u8ffd\u5386 db \u4e2d\u7684 bucket\uff0c\u62bd\u53d6 20 \u4e2a key \u5224\u65ad\u662f\u5426\u8fc7\u671f\uff0c\u8fc7\u671f\u5219\u5220\u9664\uff0c\u672a\u8fc7\u671f\u5219\u8df3\u8fc7"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u8fbe\u5230\u65f6\u95f4\u4e0a\u9650(25ms)\u5e76\u4e14\u5168\u5c40\u8fc7\u671f key \u6bd4\u4f8b\u5927\u4e8e 10%\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u62bd\u6837\uff0c\u5426\u5219\u7ed3\u675f"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"FAST")," \u6a21\u5f0f\u89c4\u5219(\u8fc7\u671f key \u6bd4\u4f8b\u5c0f\u4e8e10%\u4e0d\u6267\u884c):",(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u6267\u884c\u9891\u7387\u53d7 ",(0,i.kt)("inlineCode",{parentName:"li"},"beforeSleep()")," \u8c03\u7528\u9891\u7387\u5f71\u54cd\uff0c\u4f46\u4e24\u6b21 FAST \u6a21\u5f0f\u95f4\u9694\u4e0d\u4f4e\u4e8e 2ms"),(0,i.kt)("li",{parentName:"ol"},"\u6267\u884c\u6e05\u7406\u8017\u65f6\u4e0d\u8d85\u8fc71ms"),(0,i.kt)("li",{parentName:"ol"},"\u9010\u4e2a\u904d\u5386db\uff0c\u9010\u4e2a\u904d\u5386 db \u4e2d\u7684 bucket\uff0c\u62bd\u53d6 20 \u4e2a key \u5224\u65ad\u662f\u5426\u8fc7\u671f\uff0c\u8fc7\u671f\u5219\u5220\u9664\uff0c\u672a\u8fc7\u671f\u5219\u8df3\u8fc7"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c\u6ca1\u8fbe\u5230\u65f6\u95f4\u4e0a\u9650 (1ms) \u5e76\u4e14\u5168\u5c40\u8fc7\u671f key \u6bd4\u4f8b\u5927\u4e8e 10%\uff0c\u518d\u8fdb\u884c\u4e00\u6b21\u62bd\u6837\uff0c\u5426\u5219\u7ed3\u675f")))),(0,i.kt)("h3",{id:"\u6dd8\u6c70\u7b56\u7565"},"\u6dd8\u6c70\u7b56\u7565"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5f53 Redis\u7684\u6570\u636e\u91cf\u5341\u5206\u5e9e\u5927\u65f6\uff0c\u4ec5\u901a\u8fc7\u6e05\u9664\u8fc7\u671f\u6570\u636e\u53ef\u80fd\u4e5f\u4f1a\u8fbe\u5230 Redis\u5185\u5b58\u7684\u4e0a\u9650")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"\u5185\u5b58\u6dd8\u6c70"),": \u5c31\u662f\u5f53 Redis \u5185\u5b58\u4f7f\u7528\u8fbe\u5230\u8bbe\u7f6e\u7684\u95fd\u503c\u65f6\uff0cRedis \u4e3b\u52a8\u6311\u9009\u90e8\u5206 key \u5220\u9664\u4ee5\u91ca\u653e\u66f4\u591a\u5185\u5b58\u7684\u6d41\u7a0b")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u652f\u6301 8 \u79cd\u4e0d\u540c\u7b56\u7565\u6765\u9009\u62e9\u8981\u5220\u9664\u7684 key:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"noeviction"),":\u4e0d\u6dd8\u6c70\u4efb\u4f55 key\uff0c\u4f46\u662f\u5185\u5b58\u6ee1\u65f6\u4e0d\u5141\u8bb8\u5199\u5165\u65b0\u6570\u636e\uff0c\u9ed8\u8ba4\u5c31\u662f\u8fd9\u79cd\u7b56\u7565\u3002"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"volatile-ttl"),": \u5bf9\u8bbe\u7f6e\u4e86 TTL \u7684 key\uff0c\u6bd4\u8f83 key \u7684\u5269\u4f59 TTL \u503c\uff0cTTL \u8d8a\u5c0f\u8d8a\u5148\u88ab\u6dd8\u6c70"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"allkeys-random"),": \u5bf9\u5168\u4f53 key\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u968f\u673a"),"\u8fdb\u884c\u6dd8\u6c70\u3002\u4e5f\u5c31\u662f\u76f4\u63a5\u4ece ",(0,i.kt)("inlineCode",{parentName:"li"},"db->dict")," \u4e2d\u968f\u673a\u6311\u9009"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"volatile-random"),": \u5bf9\u8bbe\u7f6e\u4e86 TTL \u7684 key\uff0c",(0,i.kt)("strong",{parentName:"li"},"\u968f\u673a"),"\u8fdb\u884c\u6dd8\u6c70\u3002\u4e5f\u5c31\u662f\u4ece ",(0,i.kt)("inlineCode",{parentName:"li"},"db->expires")," \u4e2d\u968f\u673a\u6311\u9009\u3002"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"allkeys-lru"),": \u5bf9\u5168\u4f53key\uff0c\u57fa\u4e8e ",(0,i.kt)("strong",{parentName:"li"},"LRU \u7b97\u6cd5"),"\u8fdb\u884c\u6dd8\u6c70"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"volatile-lru"),":\u5bf9\u8bbe\u7f6e\u4e86 TTL \u7684 key\uff0c\u57fa\u4e8e ",(0,i.kt)("strong",{parentName:"li"},"LRU \u7b97\u6cd5"),"\u8fdb\u884c\u6dd8\u6c70"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"allkeys-lfu"),": \u5bf9\u5168\u4f53 key\uff0c\u57fa\u4e8e ",(0,i.kt)("strong",{parentName:"li"},"LFU \u7b97\u6cd5"),"\u8fdb\u884c\u6dd8\u6c70"),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("inlineCode",{parentName:"li"},"volatile-lfu"),": \u5bf9\u8bbe\u7f6e\u4e86 TTL \u7684 key\uff0c\u57fa\u4e8e ",(0,i.kt)("strong",{parentName:"li"},"LFU \u7b97\u6cd5"),"\u8fdb\u884c\u6dd8\u6c70"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"LRU"),"(Least Recently Used)\uff0c\u6700\u5c11\u6700\u8fd1\u4f7f\u7528\u3002\u7528\u5f53\u524d\u65f6\u95f4\u51cf\u53bb\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u8fd9\u4e2a\u503c\u8d8a\u5927\u5219\u6dd8\u6c70\u4f18\u5148\u7ea7\u8d8a\u9ad8\n",(0,i.kt)("strong",{parentName:"p"},"LFU"),"(Least Frequently Used)\uff0c\u6700\u5c11\u9891\u7387\u4f7f\u7528\u3002\u4f1a\u7edf\u8ba1\u6bcf\u4e2a key \u7684\u8bbf\u95ee\u9891\u7387\uff0c\u503c\u8d8a\u5c0f\u6dd8\u6c70\u4f18\u5148\u7ea7\u8d8a\u9ad8")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u6dd8\u6c70\u7b56\u7565"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# The default is:\n#\n# maxmemory-policy noeviction\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"\u5728 ",(0,i.kt)("inlineCode",{parentName:"p"},"redisObject")," \u7ed3\u6784\u4e2d\uff0c\u6709\u8bb0\u5f55\u5185\u5b58\u6dd8\u6c70\u7b97\u6cd5\u7684\u5b57\u6bb5",(0,i.kt)("inlineCode",{parentName:"p"},"lru:LRU_BITS")),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-c"},"typedef struct redisObject {\n    // \u5bf9\u8c61\u7c7b\u578b\uff0c\u5206\u522b\u662f string\u3001hash\u3001list\u3001set \u548c zset\uff0c\u53604\u4e2abit\u4f4d\n    unsigned type:4;\n    // \u5e95\u5c42\u7f16\u7801\u65b9\u5f0f\uff0c\u5171\u670911\u79cd\uff0c\u53604\u4e2abit\u4f4d\n    unsigned encoding:4;\n    // LRU:\u4ee5\u79d2\u4e3a\u5355\u4f4d\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u957f\u5ea6 24bit\u3002\u4fbf\u4e8e\u5224\u65ad\u7a7a\u95f2\u65f6\u95f4\u592a\u4e45\u7684 key\n    // LFU:\u9ad816\u4f4d\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\u8bb0\u5f55\u6700\u8fd1\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\uff0c\u4f4e 8 \u4f4d\u8bb0\u5f55\u903b\u8f91\u8bbf\u95ee\u6b21\u6570\n    unsigned lru:LRU_BITS; /* LRU time (relative to global lru_clock) or\n                            * LFU data (least significant 8 bits frequency\n                            * and most significant 16 bits access time). */\n    // \u5bf9\u8c61\u5f15\u7528\u8ba1\u6570\u5668\uff0c\u8ba1\u6570\u5668\u4e3a 0 \u5219\u8bf4\u660e\u5bf9\u8c61\u65e0\u4eba\u5f15\u7528\uff0c\u53ef\u4ee5\u88ab\u56de\u6536\n    int refcount;\n    // \u6307\u9488\uff0c\u6307\u5411\u5b58\u653e\u5b9e\u9645\u6570\u636e\u7684\u7a7a\u95f4\n    void *ptr;\n} robj;\n"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"LFU")," \u7684\u8bbf\u95ee\u6b21\u6570\u4e4b\u6240\u4ee5\u53eb\u505a",(0,i.kt)("strong",{parentName:"p"},"\u903b\u8f91\u8bbf\u95ee\u6b21\u6570"),"\uff0c\u662f\u56e0\u4e3a\u5e76\u4e0d\u662f\u6bcf\u6b21 key \u88ab\u8bbf\u95ee\u90fd\u8ba1\u6570\uff0c\u800c\u662f\u901a\u8fc7\u8fd0\u7b97:"),(0,i.kt)("ol",{parentName:"li"},(0,i.kt)("li",{parentName:"ol"},"\u751f\u6210 0~1 \u4e4b\u95f4\u7684\u968f\u673a\u6570 R"),(0,i.kt)("li",{parentName:"ol"},"\u8ba1\u7b97 1/(\u65e7\u6b21\u6570*lfu_log_factor + 1)\uff0c\u8bb0\u5f55\u4e3a P\uff0clfu_log_factor \u9ed8\u8ba4\u4e3a 10"),(0,i.kt)("li",{parentName:"ol"},"\u5982\u679c R < P\uff0c\u5219\u8ba1\u6570\u5668 +1\uff0c\u4e14\u6700\u5927\u4e0d\u8d85\u8fc7255"),(0,i.kt)("li",{parentName:"ol"},"\u8bbf\u95ee\u6b21\u6570\u4f1a\u968f\u65f6\u95f4\u8870\u51cf\uff0c\u8ddd\u79bb\u4e0a\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u6bcf\u9694 lfu_decay_time \u5206\u949f(\u9ed8\u8ba41)\uff0c\u8ba1\u6570\u5668 -1"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Redis \u4f1a\u5728\u5904\u7406\u5ba2\u6237\u7aef\u547d\u4ee4\u7684\u65b9\u6cd5 ",(0,i.kt)("inlineCode",{parentName:"p"},"processCommand()")," \u4e2d\u8c03\u7528 ",(0,i.kt)("inlineCode",{parentName:"p"},"performEvictions()")," \u65b9\u6cd5\u5c1d\u8bd5\u505a\u5185\u5b58\u6dd8\u6c70\uff0c\u5177\u4f53\u6d41\u7a0b"),(0,i.kt)("p",{parentName:"li"},(0,i.kt)("img",{alt:"image-20240825061015617",src:n(30038).Z,width:"1076",height:"549"})))))}k.isMDXComponent=!0},78997:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240719010039756-c92b0cd9545df39af8e61ec211e8ae6a.png"},16432:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240719010813672-75e844271e55dce96d7436b400b43970.png"},42496:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240719011010853-24830513f2417b925ea35ff92e562db2.png"},86671:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240719044415982-7ed4ded45058d5363b172b50df635977.png"},75322:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240720092327897-1fb3c78dcf67468c6ac4638d70370633.png"},38078:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240721080636696-78dac242158aa737c05acb1806ba67af.png"},32904:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240721081811431-5a0c9a51dbff5d5b2dd5ec02786231fb.png"},93577:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240721104050853-24222b6f412a35293bc9f63ebaea5e35.png"},24434:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240723115727308-5fcb0f5c882a5512286f71be5179670b.png"},60937:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240723124255082-5c48d314ae647a0eb22d856d20d0cd2f.png"},17687:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240723140420158-fe66ea22f1b9315113ac049ed936c799.png"},13983:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240723171240294-0b9e8d124dfaea54b15df428d841cf8c.png"},1491:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240723172924590-f6d177686f9a866ae7c5dc5b68795097.png"},87580:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240727180506033-f2a6506a3c353164ba000b765b88fd1d.png"},49599:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240727180610225-0a980fd18f8e626fcf3cbe4b591ca731.png"},50229:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240727182420751-f14a6fbf17113120471374e99ac1c199.png"},33948:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240802182114392-6f3a14f3728a7dbb33a1747d83e68e35.png"},53744:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240802193458287-6a37141637c68ac0a0c4ec3fef37e8db.png"},50048:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240802193703900-ea0da47607863cb11fc1900dc6fcf304.png"},79786:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809012303548-214ae07601498b072873fd086bd2686e.png"},65105:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809021156736-2bf3df45cbba51bb9bb62d80e68ce0f5.png"},22252:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809021916855-f4d1dc3d9fe7807c232fa4ae2d6f5bd9.png"},12969:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809022429531-f1827c81188a0a13c884b221369e2054.png"},24154:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809030020951-23be2f3d62b63fdccbc2ec8606204ec9.png"},24894:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809032446235-14d7d1b73ef5a4bed544ebe4a30c130a.png"},94329:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809033223493-616a3a3c7e248f1ca91c03473e9791f3.png"},50914:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809045524078-3b2278b3510e03aca182d72a7ecd23c2.png"},15700:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809050522189-30761d0c69fbfa0d1975bb0253d1e4c9.png"},90907:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240809050826799-4ac71812745979bf54aa76b3f1d65504.png"},72252:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240810040840485-ba61cffaf5e28b0b2afc0b182b1f8825.png"},23900:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240810043448890-3f64ab5a3cea9e4d8f33b609e6fc9b5f.png"},48426:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240810052151754-904e26c8e3a4b0a8162fc2188e781678.png"},9458:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240811075309634-ee376f8084f5cd983fea4331570e5bfe.png"},91857:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240811075918751-6e5e50f0619fdf95252d7b2f3df29fcf.png"},8228:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240811080659245-edff54e3d4714e789416b841dcff8768.png"},10457:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240811081034797-cd810c1cd9c704bb61d9c731bed83206.png"},46226:(e,t,n)=>{n.d(t,{Z:()=>a});const a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARAAAACiCAYAAACJf5LfAAAS50lEQVR4nO3df2yT950H8HdZaZupiZPR2RRXaVTiXLJBBIS0RQkom3UCt52uJV0mk0xKqjtZMHQhVypx15zly5Au0qWXtGJEvjsdVCVYy0qKNKg7Ve4ssNWu4AYBajg7QyHCTeyxYYfdorYbd3/41/dxbOLnGyc48H5JkfzY3+fzfI30fPz9fp+H5/PAAw8W/R/SVDxViYmr4+lvExEprLjbHSCi5YsJhIikMYEQkTQmECKSxgRCRNKYQIhIGhMIEUl7UHrPh2ux5qVW/NUz1dA8HH/v9lf40/Ql/M+wHdf8ofz0kIgKltwIZE0HtvT+FE9vE5IHAKx4CN9cU4eNz23LT++WI309prp3wanPsk10D1E/AlmxDev+/kXo4onj6+sfY/TdYfzhJoCHn4BuRxtqHr5jBCK6R6hOIN8wvoTKkvjG78/gTO8buHU78elVXPuvM7i24qG8dZCICpfqKcxjVU8lX4c8/y0kD8HtrxbSJyJaJlSOQOpQujrx+ib+4L+Zt450mnaht644uR3xDeNxpzL+YJsF7RWJrVtwHzkOU1Au/hWnHRt98Q19PaY6DLhwxAm81IKm0vj7Ey4UHUv7T4V1JsyaylPbkc9w4NA5vJlbNzJbjJhES0D+KkxeVaJ91acoOhg/WfX1mOpowWg4dZIPtlnQDleqTZ0Jsx274MwhiXSadqF3bQAHDsZPSn09pjosGIWQRFCMpg4T3EfsKArG+jTabcRsG5JJJJaEAPcRe/KYg20W9HY/huqDTuyW+OZzY5bB2VYpEYlo6amcwvgQmU68LsO3qsry1I1xbBR/6YPjuBABVmvj8fX1eLFiEkfFNr5P4I4UY0PtfH2oRHsd4H5P+EUPnsPJCaC6RnmiXnGKyWgcG52TQIUBg8k4xWltgN3HXLiCcjxbp/IrZ415E6ZjHH3Q8qB6BHLDfxX4bmwdRNf4Coo/fGPuOsiKhyTWQWK/+NXCO5HEi9WPoRTlaO+2oD1trwjmoS/DahSjusOC2fTPJsSNW5ieTvt8+gYiMKBCDwBlWI1JnPSltcE4Ppkw4kVtGQCVUzp9tphEy4PqBPIX13sYN74auxKzahu2HViZ4TLuh/jgZ7/IOWZifeKK044iHwCUwbm3BRvERgtaF5jEUckpBhFlp34N5PYZXH5rLYpfi90LsvKJLXh63xZlG7+6kDvWFiPiGxbWI9JM30Ck1IAd+nN4M8dF06TgTUxjU2yKofKXvrPWgNJIAB8EASBbnEo8WwFMj0ksKC+gb0SFQO5O1C+O4OMD/4zzv7mO6JfC+7e/wq0vfBh9/4yqcBMRoHTVquR2p8mUuhICxNdEitH0Uj06hbcH20zx9Yk7GccnE0C1Sdm202RKuzs0toiabKOvx4G6YkR+Ox4f9YzjqO8Wqk3Ku0oH24yojnyGozkmgE7TLsx2J46TKWYZnG3K70lUqOSvwnx5Edff/gmuv73wTuw+5sKz3UbMdhsBABGfC+6IUZjC3ITp0DCce1vQ270JvfF3I75hPJ5TfDvQZlGuoUy44ldbEm7B7byBF4U26ZeS33QeB7ALveJ6yoQLRYfknx+bKWbENwyTdESipfMAH6oM4T6Q3O8rIaKCuQ9kYZQ3mIm4eEq0mO6JBLL7mJ1Jgugu4AOFiEga10CISBpHIEQkjQmEiKQxgRCRNCYQIpLGBEJE0phAiEgaEwgRSWMCISJpTCBEJI2lLYlImlwCWdOBLa+lqtMlCaUtr/lzf6QhES1PLG1JRNJY2rJQDHgQNAMOXSP23+2+EOWIpS2JSJrKBLJ4pS0tIwEEQ+Hk39jInjlt+jxhoU0Awxb5+O6BxAcnMJYp1oAHwZAHfYrX/XDP08f04wQ9/ZnjDnhin/tP4JQnjKC5CkAVzKFw6riZJPZL/PlPQMU/A1FeFchl3H6Ytaeg12ljf9azQIMtdZIjljzMGEq1cYTQ0JNbErGMBGBddxE9QnydOZ5E7C5cimqwfruYDPZg+LkqzHiPC9OJKphD9Tif1kcxifR5wrA2hOBItNHZ4NW2ZjjJq2DefC7WpqoZLzRqoXf4Afjj+2aexlhGAgiadfBahfjhnP6BiRZFgZS27EJTY1dq0+7CpSigK4+fnJYTeN7gh0Nss+84vHNO/Ez6YW4AvG80w56M34zTAcCwuR/AYbguR1Gyzpg6yS1GrNdEcelXh4U4UXitwoltb8aAV9jPcgLPG9La4DBa3jiLGU0tjIoMEoX3nS6o0w9zgwYBhwEtyS9yGC2NwvciWmKqRyA3/FeTr3WNr6A4UwSpRVRxemBDg0b4qEaHkuTwPkubbCzl0EGDhp6wYuhvNqSa2HeeQkA4yS3ba1ESOCWcqAAQwmTamWqfDAEaHQyJPkYvwpV+NsdHONqaO8fK7Xv4cX6fyv2IFlFBlLa0jARgbdAg4NBCvw8A9mDYb8N6sVH0LHqqZH9t/fNc3ejC+UArnt++B7ADxnUaBN5XO0Iguv+oXwO5fQaX3zqJULwiXay0ZT92/Es/dvzTq9i4SYdHVqoLaVynwYzXhqZsv65joQzTgBzZJxFCFTYP3LnZ/vP+2HTEYsR6TW6/9H2bq4DAuVhiytbH+HQoPCbRd1GO34NoKRVEacvJMFCiTc0pLCNdyulJfBrQ8KpyMbLPc4erFUldOB8ADGZlW8uIR7kAu+84vKiF+ce1gGLxNKEKZnExdMADswEInI+PVOzNOB3QoKFHPM4eDL+6NcN0KIOxEGagQ7nQp9gVnUS8Lji8URjM4sLxHgx7eBWG7p6CKG25v3EIm0OtCIZaAQAz3iF4o63CFOYwWqqAYb8N1lAY1vi7M14bajLEmxtfC3jCMIfCMCfeDAxBrzipD8N1uQvWBsD7zuG5QeCH432d4vgBh1Yxasp0nBmvDfqdmeKlsTfj9I/DMPeEEeyJTbkC6U12GoCRAKw9YQR7UvFb5o9OtChY1iEXvEuUKKN7ojJdn0d5VSVlvsVTIlqIeyKB7G/UMkkQ3QUFcicqES1HXAMhImkcgRCRNCYQIpLGBEJE0phAiEgaEwgRSWMCISJpTCBEJI0JhIikMYEQkTQmECKSxtq4RCRNbgSypgNben+Kp7cJyQNQ1MYtJH2eDPVZiGjBWBuXiKSxNi4RSWNtXCKSdt/Uxs10LPEYyuMHMDyQXjO3H+4Mx8y0vnKnflpGAnPXYzLW51XW4Z2/Bu4eDPuVxbPcLAFBi6xALuMubm1chQFP7MnrVi1q4k9LjxW2EmvanoLWvBUl84TKJD/97Ic71Ao4tMk4jvBWWLMmkX64QzY0hMXj+iV6T6TOfVAbVzDgQdBclVZfNlFzVnz4chearGcxo/Zr5KmflpEXYAgMKUtGvJOpxq7QPnoWPYrjNmYv1EWUJ6oXUW/4rwLfja2D6BpfQfGHb8xdB1nxkMQ6SOxXV3y4evIEFmrjmtP2yvkk176AMbNmTi2XRM3Z0/k42fLRTwAGrQYwpOrkpESztp+57GKRbVpy90lt3JTYqCaHQk+y8tTPGa8tOcUiKlT3fm3chPAp1MTXVuYu0GaoOVujy7AGooFWUQpvD8q1Ev3UlivXMtKOFQhHY3V65wkj254oX+6D2rhinOa5ScTejNNzauf2w22uSts5XmP3uVQfZPpp/9VFzGi2wpxMWHOPlWizT5Ho+uFOXr2JXaFJfAf7zlMIaLbCKl7dGfDwKgwtuvuiNq6CvRk1NR4EzTYE/Ub0VDVnqGnrh8N6Frqe2oz9TPRhxmuDI2AT1jty6Ke9GQPbA7CawwiasxzL3owanMBYjw3BkC3+ZhRea8byewC60KQD3CFx3cQPh07tPw6ROqwLk43lBMZ6anHJKl6xISLRPVHakrVxie6OeyKBsDYu0d1RIHeiEtFyxDUQIpLGEQgRSWMCISJpTCBEJI0JhIikMYEQkTQmECKSxgRCRNKYQIhIGhMIEUljaUsiknZflLZcEH09prp3wam/2x0hKjwsbUlE0ljacslVYrTbCDjt2Oi7230hWhiWtiQiaSpHIItX2rLTtAu9dcXJ7YhvGI87lfEH2yxor0hs3YL7yHGYgjkE19djqmMTSpPBP8OBQ+fwZpZjX5lvdJAeb8KFomPKxx+kx8SEC0VjBsyaymPbJgtmTXc6VmykUp3cVvF9iZZIgTyRrBLtqz5F0cH4Saivx1RHC0bDqZNrsM2CdrhSbepMmO3YBee8J1UlRjs2Ydppx+M+ACiDs60y+WmnaRd61wZw4GA8oejrMdVhwSiynNj6ekx1GHDhiD1+3DI497Zgtg3JJBJLdJM4evA4dif60AbA50SRL4cpTDxBwTeMongS7TSZsGOef0WipVYgpS3HsVH8BQ+O40IEWK2Nx9fX48WKSRwV2/g+gTtSjA218/RBX4bVuIXpZL9vwnQsMfqoRHsd4H4vNRpB8BxOTgDVNZUZggGD39sE+JxC0roJ08eTQIUBg8m+3oL7iDOePDJ8v3kMfm8TSidcihHYm04nRx9UcAqotGX6kB2IJF6sfgylKEd7twXtaXtFMI/gOZyc2IT2Dgtm06ca+jKsRjGqOyyYTd9vIlOwMlSUAqUVLZitS/9sMtXXSAAfSJ/ssWNc+ZhPhKPCVxClLRPrBVecdhQlphl7W7BBbJS2bqHG7mN27E5MNbqNaWsWkzh6UBwtzG/eNRKi+0RBlLbcsbYYEd9w9pNy+gYipQbsWNDNXDdhOmRHkVOYbgRvYhrleHbOaCJ7jIlI9ulNfvqawzGICkRBlLaciAClq1YltztNJjSVCg2C47gQKUbTS/XoFN4ebDPFEsGd6Osxasq2TjKOTyaAapMyTqfJlPXO091jk0CFEaNi0hGPETyHkxPFaOoQY1ZiNLlw+3tMi+s78f2nui3JmLt//RkiFUZMCf2+U5+I7pYCeSq7cv0j4nPhwlojNvxWvJQbm4KIiSXTpd450i+5ZpiyKC8PQznFSV51Ea721JlSl2NzjKmY9gj7X3HasXE61sdpsc08l56JCkGBJBAiWo4K5D6QhZkzgkhSv0BKRLnjCISIpPGBQkQkjQmEiKQxgRCRNCYQIpLGBEJE0phAiEgaEwgRSWMCISJpTCBEJI0JhIikMYEQkTQmECKSxtq4RCRNLoGs6cCW11LlLZOE2rjX/Lk/E5WIlifWxiUiaayNS0TSWBuXiKSpTCCLVxvXMhJAMBRO/o2N7JnTps8TFtoEMGxRFzPo6c9bf4moYC7j9sOsPQW9Thv7s54FGmxwD6Ra9HnCMGMo1cYRQkNP9iTS5wnD2hCCI9FeN4TA0nwZovtGgdTG7UJTY1dq0+7CpSigK4+PQiwn8LzBD4fYZt9xeKMarN8+d6QSax+F19qI/dmOQUQLVkC1cfvhDrXCILwzk3hRo0MJqmAOhWFO22sGGdToUBK9CJddZReISBXVU5i/uN7DeOKsXbUN2w4cwJqqp/DIt5/CI09sw5N/+x/YsftvVMWMrVW0Ao7EdMMGbzStUfQsepLTkdRfzc7Dar8CEeWJ+vtAbp/B5bfWojh+I1msNu4WZRu/upDGdRrMeG1o2pelwVgIM+ZaGC2APZdRhdr2RCSlIGrjToaBEm1q8mIZ6UKDRmhgd+FSVIOGV09AXDPt83jQl3wdRtAf/9zejNMBDRp6Up8D/XDzKgxRXsn/X5gvL+L62z/B9bcX3on9jUPYHGqNTWMAzHiH4I22Yn2yxWG0VAHDfhusoTCs8XdnvDbUZI2pBTxhxbpJwKFdeGeJKImV6YhIWoHcB0JEyxETCBFJYwIhImlMIEQkjQmEiKQxgRCRNCYQIpLGBEJE0phAiEgaEwgRSWMCISJpTCBEJI0JhIikyf93/ge/jx8804qtteX4drK0JfCn332OMx/Z8fPQ5/npIREVLKkRyMrSf4Dt7/4RO+uF5BGP9k3dd7Djma156p6sPRj2Zy4NQUT5I1Ha8mXsfdmEJxOlLacu4JfuIVz8XwAPVeLZuh/CyNKWRPcF1QlE8x0Tah+Nb0Q+xaFfvI6LyaeyX8C1D9/FyIpHs+xNRPcS1VOYLRXlyddffGYXkkfK17f/uKBOEdHyoDKBfB9PPpZ4/UdMBifz1pHFKG05Zx+/8qHMRLQwBXIZN/+lLQGgpMGGzeeF0paardjHhVWivFGZQD7CtRuJ14+iXF9+p8Yq5Lm0ZUJgSKg10wWHN4qSdUaOQojyRPUi6scTk/hRZSxxrNlkQe3l1+esg6xc8ajEOkgeS1smPguznDbRYlI9hYl+7sTFRG4ofRp7f/hv+IFuA558dAOe/NbL+NFf/xw/e65VVUyWtiRaniRKW76LQ++W43Vz7F6QlY9vwE7zBuwU21xVFzLvpS2JaElILaJ+Hfl32P7zX/HLC5P4nVja8s9fIRr6HB/85qyqeHkvbUlES0L+/8L8+SOMuD/CiHvhnViM0pZEtPhY2pKIpBXIfSBEtBwxgRCRNCYQIpL2/8G6f/5w2pKLAAAAAElFTkSuQmCC"},33161:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240812091711496-8171737a2a13b5318411238e5ea5aa09.png"},51608:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240812092722397-fec22be8999e2f03f30af4c3fd59a32e.png"},52348:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240819192955202-09cafb4203022585c3020eb3bdb72896.png"},19424:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240819193322169-c08afe73df55d7df76cce83df7bd8cc4.png"},55265:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240825033403204-6b51845c38346c56312ae79ab9c59e5f.png"},30038:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/image-20240825061015617-bf2f20112f8dfcdf3ce9d6770f48e4c8.png"}}]);